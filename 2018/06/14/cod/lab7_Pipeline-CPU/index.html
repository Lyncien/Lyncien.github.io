<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="Lyncien">



<meta name="description" content="实验目的设计一个MIPS指令集的CPU，1、    基本要求：a)    多周期 b)    包含16条指令     i.    add addi addu sub subu      ii.    and andi or nor xor     iii. bgtz bne j jr     iv.    lw sw 2、    扩展要求a)    在16条的基础上，增加其他指令 b)    实现">
<meta name="keywords" content="Verilog,COD">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机组成原理上机实验7 流水线CPU">
<meta property="og:url" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/index.html">
<meta property="og:site_name" content="Lyncien&#39;s homepage">
<meta property="og:description" content="实验目的设计一个MIPS指令集的CPU，1、    基本要求：a)    多周期 b)    包含16条指令     i.    add addi addu sub subu      ii.    and andi or nor xor     iii. bgtz bne j jr     iv.    lw sw 2、    扩展要求a)    在16条的基础上，增加其他指令 b)    实现">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic1.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic2.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic3.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic4.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic5.jpg">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic6.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic7.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic8.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic9.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic10.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic11.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic12.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic13.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic14.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic15.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic16.png">
<meta property="og:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic17.png">
<meta property="og:updated_time" content="2019-03-14T12:18:35.934Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="计算机组成原理上机实验7 流水线CPU">
<meta name="twitter:description" content="实验目的设计一个MIPS指令集的CPU，1、    基本要求：a)    多周期 b)    包含16条指令     i.    add addi addu sub subu      ii.    and andi or nor xor     iii. bgtz bne j jr     iv.    lw sw 2、    扩展要求a)    在16条的基础上，增加其他指令 b)    实现">
<meta name="twitter:image" content="https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic1.png">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Lyncien&#39;s homepage" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>计算机组成原理上机实验7 流水线CPU | Lyncien&#39;s homepage</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<script src="/js/head-pic.js" ></script> <!-- head-pic-flash by Lyncien -->
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic" id="head-pic"> <!-- head-pic-flash by Lyncien -->
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Lyncien</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:Lyncien@126.com" title="Email"></a>
                            
                                <a class="fa Leetcode" href="https://leetcode-cn.com/lyncien/" title="Leetcode"></a>
                            
                                <a class="fa Github" href="https://github.com/Lyncien" title="Github"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/COD/">COD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Compiler/">Compiler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/">DP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DS/">DS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hackergame2018/">Hackergame2018</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MCPS/">MCPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Makefile/">Makefile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PC/">PC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Verilog/">Verilog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/parallel-computing/">parallel computing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感想/">感想</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/置顶/">置顶</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">林深见鹿</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Lyncien</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic" id="head-pic-mobile"> <!-- head-pic-flash by Lyncien -->
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Lyncien</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:Lyncien@126.com" title="Email"></a>
                            
                                <a class="fa Leetcode" target="_blank" href="https://leetcode-cn.com/lyncien/" title="Leetcode"></a>
                            
                                <a class="fa Github" target="_blank" href="https://github.com/Lyncien" title="Github"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-cod/lab7_Pipeline-CPU" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/14/cod/lab7_Pipeline-CPU/" class="article-date">
      <time datetime="2018-06-13T16:00:00.000Z" itemprop="datePublished">2018-06-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      计算机组成原理上机实验7 流水线CPU
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/COD/">COD</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Verilog/">Verilog</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><h3 id="设计一个MIPS指令集的CPU，"><a href="#设计一个MIPS指令集的CPU，" class="headerlink" title="设计一个MIPS指令集的CPU，"></a>设计一个MIPS指令集的CPU，</h3><h4 id="1、-基本要求："><a href="#1、-基本要求：" class="headerlink" title="1、    基本要求："></a>1、    基本要求：</h4><pre><code>a)    多周期
b)    包含16条指令
    i.    add addi addu sub subu 
    ii.    and andi or nor xor
    iii. bgtz bne j jr
    iv.    lw sw
</code></pre><h4 id="2、-扩展要求"><a href="#2、-扩展要求" class="headerlink" title="2、    扩展要求"></a>2、    扩展要求</h4><pre><code>a)    在16条的基础上，增加其他指令
b)    实现中断功能
c)    实现流水
d)    实现下载
</code></pre><h2 id="实验平台"><a href="#实验平台" class="headerlink" title="实验平台"></a>实验平台</h2><h4 id="EDA工具为ISE14-7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6-XC6SLX16-CS324。"><a href="#EDA工具为ISE14-7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6-XC6SLX16-CS324。" class="headerlink" title="EDA工具为ISE14.7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6 XC6SLX16-CS324。"></a>EDA工具为ISE14.7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6 XC6SLX16-CS324。</h4><h2 id="使用部件"><a href="#使用部件" class="headerlink" title="使用部件"></a>使用部件</h2><h4 id="开发板上的开关，7段数码管和按钮。"><a href="#开发板上的开关，7段数码管和按钮。" class="headerlink" title="开发板上的开关，7段数码管和按钮。"></a>开发板上的开关，7段数码管和按钮。</h4><h2 id="最终实现功能"><a href="#最终实现功能" class="headerlink" title="最终实现功能"></a>最终实现功能</h2><h4 id="1、实现五段流水线"><a href="#1、实现五段流水线" class="headerlink" title="1、实现五段流水线"></a>1、实现五段流水线</h4><h4 id="2、实现完全转发和冒险检测"><a href="#2、实现完全转发和冒险检测" class="headerlink" title="2、实现完全转发和冒险检测"></a>2、实现完全转发和冒险检测</h4><h4 id="3、实现36条指令"><a href="#3、实现36条指令" class="headerlink" title="3、实现36条指令"></a>3、实现36条指令</h4><h4 id="4、实现下载并在数码管上动态显示内存"><a href="#4、实现下载并在数码管上动态显示内存" class="headerlink" title="4、实现下载并在数码管上动态显示内存"></a>4、实现下载并在数码管上动态显示内存</h4><a id="more"></a>
<h2 id="详细设计过程"><a href="#详细设计过程" class="headerlink" title="详细设计过程"></a>详细设计过程</h2><h3 id="1、-MIPS指令格式"><a href="#1、-MIPS指令格式" class="headerlink" title="1、    MIPS指令格式"></a>1、    MIPS指令格式</h3><p>MIPS-IV指令集标准下的指令长度为32位，分为R型、I型和J型指令</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic1.png" alt=""><br>R-Tpye<br><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic2.png" alt=""><br>I-Tpye<br><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic3.png" alt=""><br>J-Tpye</p>
<p>它们的共同部分是26-31位的Op码，用来区分不同的指令，其中</p>
<p>（1）R-Type的指令Op=000000，再根据0-5位的Funct部分区分不同指令</p>
<p>（2）I-Type的指令0-15位为立即数，位扩展后用于直接计算或者访存和跳转偏移地址。Op=000001的I-Type指令，根据Rt的不同来区分。</p>
<p>（3）J-Type的指令除了Op之外，0-25位为立即数，位扩展后作为跳转地址偏移。<br>本次实现的36条指令，详细格式如下表</p>
<table>
<thead>
<tr>
<th><strong>Instr</strong></th>
<th><strong>31-26</strong></th>
<th><strong>25-21</strong></th>
<th><strong>20-16</strong></th>
<th><strong>15-11</strong></th>
<th><strong>10-6</strong></th>
<th><strong>5-0</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>op</strong></td>
<td><strong>rs</strong></td>
<td><strong>rt</strong></td>
<td><strong>rd</strong></td>
<td><strong>shamt</strong></td>
<td><strong>func</strong></td>
</tr>
<tr>
<td>SLL</td>
<td>000000</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000000</td>
<td><code>$1</code>=<code>$2</code>&lt;&lt;shamt</td>
</tr>
<tr>
<td>SRL</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000010</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;shamt</td>
</tr>
<tr>
<td>SRA</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000011</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;&gt;shamt</td>
</tr>
<tr>
<td>SLLV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000100</td>
<td><code>$1</code>=<code>$2</code>&lt;&lt;<code>$3</code></td>
</tr>
<tr>
<td>SRLV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000110</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;<code>$3</code></td>
</tr>
<tr>
<td>SRAV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000111</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;&gt;<code>$3</code></td>
</tr>
<tr>
<td>JR</td>
<td><code>$1</code></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>001000</td>
<td>PC=<code>$1</code></td>
</tr>
<tr>
<td>MOVZ</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td></td>
<td>001010</td>
<td>Set <code>$t1</code> = <code>$t2</code> if <code>$t3</code> is zero</td>
</tr>
<tr>
<td>MOVN</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td></td>
<td>001011</td>
<td>Set <code>$t1</code> = <code>$t2</code> if <code>$t3</code> is not zero</td>
</tr>
<tr>
<td>ADD</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100000</td>
<td><code>$1</code>=<code>$2</code>+<code>$3</code></td>
</tr>
<tr>
<td>ADDU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100001</td>
<td><code>$1</code>=<code>$2</code>+<code>$3</code>(unsigned)</td>
</tr>
<tr>
<td>SUB</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100010</td>
<td><code>$1</code>=<code>$2</code>-<code>$3</code></td>
</tr>
<tr>
<td>SUBU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100011</td>
<td><code>$1</code>=<code>$2</code>-<code>$3</code>(unsigned)</td>
</tr>
<tr>
<td>AND</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100100</td>
<td><code>$1</code>=<code>$2</code> and <code>$3</code></td>
</tr>
<tr>
<td>OR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100101</td>
<td><code>$1</code>=<code>$2</code> or <code>$3</code></td>
</tr>
<tr>
<td>XOR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100110</td>
<td><code>$1</code>=<code>$2</code> xor <code>$3</code></td>
</tr>
<tr>
<td>NOR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100111</td>
<td><code>$1</code>=<code>$2</code> nor <code>$3</code></td>
</tr>
<tr>
<td>SLT</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>101010</td>
<td>if(<code>$2</code>&lt;<code>$3</code>) <code>$1</code>=1 else <code>$1</code>=0</td>
</tr>
<tr>
<td>SLTU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>101011</td>
<td>if(<code>$2</code>&lt;<code>$3</code>) <code>$1</code>=1 else <code>$1</code>=0(unsigned)</td>
</tr>
<tr>
<td>BLTZ</td>
<td>000001</td>
<td><code>$1</code></td>
<td>00000</td>
<td>offset</td>
<td>if(<code>$1</code>&lt;0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>BGEZ</td>
<td><code>$1</code></td>
<td>00001</td>
<td>offset</td>
<td>if(<code>$1</code>&gt;=0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>J</td>
<td>000010</td>
<td>immediate</td>
<td>PC=PC[31:28]+immediate&lt;&lt;2</td>
</tr>
<tr>
<td>BEQ</td>
<td>000100</td>
<td><code>$1</code></td>
<td><code>$2</code></td>
<td>offset</td>
<td>if(<code>$1</code>==<code>$2</code>) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>BNE</td>
<td>000101</td>
<td><code>$1</code></td>
<td><code>$2</code></td>
<td>offset</td>
<td>if(<code>$1</code>!=<code>$2</code>) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>BLEZ</td>
<td>000110</td>
<td><code>$1</code></td>
<td>-</td>
<td>offset</td>
<td>if(<code>$1</code>&lt;=0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>BGTZ</td>
<td>000111</td>
<td><code>$1</code></td>
<td>-</td>
<td>offset</td>
<td>if(<code>$1</code>&gt;0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
</tr>
<tr>
<td>ADDI</td>
<td>001000</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code>+(sign-extend)immediate</td>
</tr>
<tr>
<td>ADDIU</td>
<td>001001</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>(unsigned)=<code>$2</code>+(sign-extend)immediate</td>
</tr>
<tr>
<td>SLTI</td>
<td>001010</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>if(<code>$2</code>&lt;(sign-extend)immediate) <code>$1</code>=1 else <code>$1</code>=0</td>
</tr>
<tr>
<td>SLTIU</td>
<td>001011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>if(<code>$2</code>&lt;(sign-extend)immediate) <code>$1</code>=1 else <code>$1</code>=0</td>
</tr>
<tr>
<td>ANDI</td>
<td>001100</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> and (zero-extend)immediate</td>
</tr>
<tr>
<td>ORI</td>
<td>001101</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> or (zero-extend)immediate</td>
</tr>
<tr>
<td>XORI</td>
<td>001110</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> xor (zero-extend)immediate</td>
</tr>
<tr>
<td>LUI</td>
<td>001111</td>
<td>-</td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=immediate*65536</td>
</tr>
<tr>
<td>LW</td>
<td>100011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=memory[<code>$2</code>+10]</td>
</tr>
<tr>
<td>SW</td>
<td>101011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>memory[<code>$2</code>+10]=<code>$1</code></td>
</tr>
</tbody>
</table>
<h3 id="2、-整体设计"><a href="#2、-整体设计" class="headerlink" title="2、    整体设计"></a>2、    整体设计</h3><h4 id="1-分为五个流水段IF、ID、EX、MEM、WB。"><a href="#1-分为五个流水段IF、ID、EX、MEM、WB。" class="headerlink" title="(1)    分为五个流水段IF、ID、EX、MEM、WB。"></a>(1)    分为五个流水段IF、ID、EX、MEM、WB。</h4><h4 id="2-clk上升沿为每段的开始，每段长度为一个clk。"><a href="#2-clk上升沿为每段的开始，每段长度为一个clk。" class="headerlink" title="(2)    clk上升沿为每段的开始，每段长度为一个clk。"></a>(2)    clk上升沿为每段的开始，每段长度为一个clk。</h4><h4 id="3-每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。"><a href="#3-每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。" class="headerlink" title="(3)    每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。"></a>(3)    每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。</h4><h4 id="4-甘特图如下"><a href="#4-甘特图如下" class="headerlink" title="(4)    甘特图如下"></a>(4)    甘特图如下</h4><p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic4.png" alt=""></p>
<h4 id="5-详细数据通路图如下"><a href="#5-详细数据通路图如下" class="headerlink" title="(5)详细数据通路图如下"></a>(5)详细数据通路图如下</h4><p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic5.jpg" alt=""></p>
<h3 id="3、-各模块设计，主要有以下几个模块"><a href="#3、-各模块设计，主要有以下几个模块" class="headerlink" title="3、    各模块设计，主要有以下几个模块"></a>3、    各模块设计，主要有以下几个模块</h3><h4 id="a-alu模块——算术逻辑单元"><a href="#a-alu模块——算术逻辑单元" class="headerlink" title="a)    alu模块——算术逻辑单元"></a>a)    alu模块——算术逻辑单元</h4><table>
<thead>
<tr>
<th>alu.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>alu_a</td>
<td>无符号型的操作数a，如果有负数，是以补码存储</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>alu_b,</td>
<td>无符号型的操作数b，如果有负数，是以补码存储</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>alu_op,</td>
<td>运算类型</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>alu_out</td>
<td>无符号型的运算结果，如果有负数，是以补码存储</td>
</tr>
</tbody>
</table>
<p>alu模块完成大部分R型指令的计算，case判断alu_op的值，使用使用verilog语言中的各运算符完成运算。</p>
<p> 这里应该注意的是add和addu的实现是一样的，这是因为当操作数都是补码表示时，符号可以直接参与运算，两条指令的区别在于，add视结果为有符号，因此如果要实现中断功能，就需要判断是否溢出。具体方法是alu_a与alu_b符号同号时，alu_out与它们异号，则表示溢出。</p>
<p> 另外，还需要注意slt的实现，比较大小时，不能使用alu_a-alu_b&gt;0，因为它们都是无符号数，相减结果认为无符号数，而无符号数&gt;0是恒成立的。</p>
<h4 id="b-regfile模块——寄存器文件"><a href="#b-regfile模块——寄存器文件" class="headerlink" title="b) regfile模块——寄存器文件"></a>b) regfile模块——寄存器文件</h4><table>
<thead>
<tr>
<th>regfile.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>rst_n</td>
<td>复位信号，低电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>rAddr1</td>
<td>读地址1</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>rDout1</td>
<td>读数据1</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>rAddr2</td>
<td>读地址2</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>rDout2</td>
<td>读数据2</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>wAddr</td>
<td>写地址</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>wDin</td>
<td>写数据</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>wEna</td>
<td>写使能，高电平有效</td>
</tr>
</tbody>
</table>
<p>这个模块实现了一个32个32位宽的寄存器组，有两个读端口，一个写端口，读取数据为异步读，写入数据在时钟上升沿且写使能有效，使用非阻塞赋值。</p>
<h4 id="c-mux模块和mux4模块——2路和4路选择器"><a href="#c-mux模块和mux4模块——2路和4路选择器" class="headerlink" title="c) mux模块和mux4模块——2路和4路选择器"></a>c) mux模块和mux4模块——2路和4路选择器</h4><table>
<thead>
<tr>
<th>mux.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>sel</td>
<td>选择信号</td>
</tr>
<tr>
<td>input</td>
<td>[WIDTH-1:0]</td>
<td>d0</td>
<td>选择数据1</td>
</tr>
<tr>
<td>input</td>
<td>[WIDTH-1:0]</td>
<td>d1</td>
<td>选择数据2</td>
</tr>
<tr>
<td>output</td>
<td>[WIDTH-1:0]</td>
<td>out</td>
<td>输出</td>
</tr>
</tbody>
</table>
<h4 id="d-IP核生成的DMem模块和IMem模块——存放数据段和代码段"><a href="#d-IP核生成的DMem模块和IMem模块——存放数据段和代码段" class="headerlink" title="d) IP核生成的DMem模块和IMem模块——存放数据段和代码段"></a>d) IP核生成的DMem模块和IMem模块——存放数据段和代码段</h4><p>Mem是同步读，同步写，且由指定coe文件初始化，coe文件的内容是16进制文本，由Mars编译汇编代码生成。</p>
<h4 id="e-IFID模块——IF段和ID段之间的寄存器"><a href="#e-IFID模块——IF段和ID段之间的寄存器" class="headerlink" title="e) IFID模块——IF段和ID段之间的寄存器"></a>e) IFID模块——IF段和ID段之间的寄存器</h4><table>
<thead>
<tr>
<th>IFID.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>en</td>
<td>使能信号，高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>flush</td>
<td>清空信号，高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>PCPlus_in</td>
<td>IF段的PC+4</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>IMemout_in</td>
<td>IF段的Imem输出</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>PCPlus_out</td>
<td>ID段的PC+4</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>IMemout_out</td>
<td>ID段的Imem输出</td>
</tr>
</tbody>
</table>
<h4 id="f-IDEX模块——ID段和EX段之间的寄存器"><a href="#f-IDEX模块——ID段和EX段之间的寄存器" class="headerlink" title="f) IDEX模块——ID段和EX段之间的寄存器"></a>f) IDEX模块——ID段和EX段之间的寄存器</h4><table>
<thead>
<tr>
<th>IDEX.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>en</td>
<td>使能信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>flush</td>
<td>清空信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>PCPlus_in</td>
<td>ID段的PCPlus</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>RegRdout1_in</td>
<td>ID段的RegRdout1</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>RegRdout2_in</td>
<td>ID段的RegRdout2</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>IMMSignExtended_in</td>
<td>ID段的IMMSignExtended</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>IMMZeroExtended_in</td>
<td>ID段的IMMZeroExtended</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>ShamtZeroExtended_in</td>
<td>ID段的ShamtZeroExtended</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rs_in</td>
<td>ID段的Rs</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rt_in</td>
<td>ID段的Rt</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_in</td>
<td>ID段的RegWtaddr</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>PCPlus_out</td>
<td>EX段的PCPlus</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>RegRdout1_out</td>
<td>EX段的RegRdout1</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>RegRdout2_out</td>
<td>EX段的RegRdout2</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>IMMSignExtended_out</td>
<td>EX段的IMMSignExtended</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>IMMZeroExtended_out</td>
<td>EX段的IMMZeroExtended</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>ShamtZeroExtended_out</td>
<td>EX段的ShamtZeroExtended</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>Rs_out</td>
<td>EX段的Rs</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>Rt_out</td>
<td>EX段的Rt</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>RegWtaddr_out</td>
<td>EX段的RegWtaddr</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegDst_in</td>
<td>ID段的RegDst</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>ALUSrcASel_in</td>
<td>ID段的ALUSrcASel</td>
</tr>
<tr>
<td>input</td>
<td>[1:0]</td>
<td>ALUSrcBSel_in</td>
<td>ID段的ALUSrcBSel</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>ALUControl_in</td>
<td>ID段的ALUControl</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemRead_in</td>
<td>ID段的DMemRead</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemWrite_in</td>
<td>ID段的DMemWrite</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemtoReg_in</td>
<td>ID段的DMemtoReg</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegWrite_in</td>
<td>ID段的RegWrite</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegDst_out</td>
<td>EX段的RegDst</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>ALUSrcASel_out</td>
<td>EX段的ALUSrcASel</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>ALUSrcBSel_out</td>
<td>EX段的ALUSrcBSel</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>ALUControl_out</td>
<td>EX段的ALUControl</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemRead_out</td>
<td>EX段的DMemRead</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemWrite_out</td>
<td>EX段的DMemWrite</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemtoReg_out</td>
<td>EX段的DMemtoReg</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegWrite_out</td>
<td>EX段的RegWrite</td>
</tr>
</tbody>
</table>
<h4 id="g-EXMEM模块——EX段和MEM段之间的寄存器"><a href="#g-EXMEM模块——EX段和MEM段之间的寄存器" class="headerlink" title="g) EXMEM模块——EX段和MEM段之间的寄存器"></a>g) EXMEM模块——EX段和MEM段之间的寄存器</h4><table>
<thead>
<tr>
<th>EXMEM.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>en</td>
<td>使能信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>flush</td>
<td>清空信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>ALUResult_in</td>
<td>EX段的ALUResult</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>DMemin_in</td>
<td>EX的Dmemin</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_in</td>
<td>EX的RegWtaddr</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>ALUResult_out</td>
<td>MEM段的ALUResult</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>DMemin_out</td>
<td>MEM的Dmemin</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>RegWtaddr_out</td>
<td>MEM的RegWtaddr</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemRead_in</td>
<td>EX段的DMemRead</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemWrite_in</td>
<td>EX段的DMemWrite</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemtoReg_in</td>
<td>EX段的DMemtoReg</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegWrite_in</td>
<td>EX段的RegWrite</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemRead_out</td>
<td>MEM段的DMemRead</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemWrite_out</td>
<td>MEM段的DMemWrite</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemtoReg_out</td>
<td>MEM段的DMemtoReg</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegWrite_out</td>
<td>MEM段的RegWrite</td>
</tr>
</tbody>
</table>
<h4 id="h-MEMWB模块——MEM段和WB段之间的寄存器"><a href="#h-MEMWB模块——MEM段和WB段之间的寄存器" class="headerlink" title="h) MEMWB模块——MEM段和WB段之间的寄存器"></a>h) MEMWB模块——MEM段和WB段之间的寄存器</h4><table>
<thead>
<tr>
<th>MEMWB.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>en</td>
<td>使能信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>flush</td>
<td>清空信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>ALUResult_in</td>
<td>MEM段的ALUResult</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>DMemout_in</td>
<td>MEM段的Dmemout</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_in</td>
<td>MEM段的RegWtaddr</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>ALUResult_out</td>
<td>WB段的ALUResult</td>
</tr>
<tr>
<td>output</td>
<td>[31:0]</td>
<td>DMemout_out</td>
<td>WB段的DMemout</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>RegWtaddr_out</td>
<td>WB段的RegWtaddr</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemtoReg_in</td>
<td>MEM段的DMemtoReg</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegWrite_in</td>
<td>MEM段的RegWrite</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemtoReg_out</td>
<td>WB段的DMemtoReg</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegWrite_out</td>
<td>WB段的RegWrite</td>
</tr>
</tbody>
</table>
<h4 id="i-dff模块——D触发器，用于各个段寄存器"><a href="#i-dff模块——D触发器，用于各个段寄存器" class="headerlink" title="i) dff模块——D触发器，用于各个段寄存器"></a>i) dff模块——D触发器，用于各个段寄存器</h4><table>
<thead>
<tr>
<th>dff.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>en</td>
<td>使能信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>rst</td>
<td>复位信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[WIDTH-1:0]</td>
<td>datain</td>
<td>输入数据</td>
</tr>
<tr>
<td>output</td>
<td>[WIDTH-1:0]</td>
<td>dataout</td>
<td>输出数据</td>
</tr>
</tbody>
</table>
<p> 这是一个通用的D触发器，位数作为参数可根据需要变化，用一个always在时钟沿触发来实现非阻塞赋值。</p>
<h4 id="j-compare模块——用于分支信号的判断"><a href="#j-compare模块——用于分支信号的判断" class="headerlink" title="j) compare模块——用于分支信号的判断"></a>j) compare模块——用于分支信号的判断</h4><table>
<thead>
<tr>
<th>dff.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>a,</td>
<td>有符号数a，需加前缀signed</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>b,</td>
<td>有符号数b，需加前缀signed</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>res</td>
<td>比较结果</td>
</tr>
</tbody>
</table>
<p>a等于b返回2’b01，a小于b返回2’b00，a大于b返回2’b10，比较均是基于有符号数。</p>
<h4 id="k-SignExtended模块——立即数符号扩展"><a href="#k-SignExtended模块——立即数符号扩展" class="headerlink" title="k) SignExtended模块——立即数符号扩展"></a>k) SignExtended模块——立即数符号扩展</h4><p>过于简单，直接在top中实现了。</p>
<h4 id="l-ZeroExtended模块——立即数无符号扩展"><a href="#l-ZeroExtended模块——立即数无符号扩展" class="headerlink" title="l) ZeroExtended模块——立即数无符号扩展"></a>l) ZeroExtended模块——立即数无符号扩展</h4><p>过于简单，直接在top中实现了。</p>
<h4 id="m-forward模块——旁路前推模块，实现转发"><a href="#m-forward模块——旁路前推模块，实现转发" class="headerlink" title="m) forward模块——旁路前推模块，实现转发"></a>m) forward模块——旁路前推模块，实现转发</h4><table>
<thead>
<tr>
<th>forward.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rs_EX</td>
<td>EX段的Rs</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rt_EX</td>
<td>EX段的Rt</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegWrite_MEM</td>
<td>MEM段的RegWrite</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>RegWrite_WB</td>
<td>WB段的RegWrite</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_MEM</td>
<td>MEM段的RegWtaddr</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_WB</td>
<td>WB段的RegWtaddr</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>RegRdout1Sel_Forward_EX</td>
<td>EX段的RegRdout1Sel_Forward</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>RegRdout2Sel_Forward_EX</td>
<td>EX段的RegRdout2Sel_Forward</td>
</tr>
</tbody>
</table>
<p>这个模块实现从DMem输出到ALU输入以及ALU输出到ALU输入的转发。</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic6.png" alt=""></p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic7.png" alt=""></p>
<h4 id="n-hazard模块——冒险检测模块，实现插入气泡"><a href="#n-hazard模块——冒险检测模块，实现插入气泡" class="headerlink" title="n) hazard模块——冒险检测模块，实现插入气泡"></a>n) hazard模块——冒险检测模块，实现插入气泡</h4><table>
<thead>
<tr>
<th>hazard.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rs_ID</td>
<td>ID段的Rs</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rt_ID</td>
<td>ID段的Rt</td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>RegWtaddr_EX</td>
<td>EX段的RegWtaddr</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>DMemRead_EX</td>
<td>EX段的DMemRead</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>PCEn</td>
<td>允许PC更新，高电平有效</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>IF_ID_En</td>
<td>允许IFID更新，高电平有效</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>ID_EX_Flush</td>
<td>IDEX清空，高电平有效</td>
</tr>
</tbody>
</table>
<p> lw之后R-Type需要使用访存结果，这在时间上是倒流的，不可能，只能插入一个气泡，清空IDEX寄存器，不更新IFID寄存器，不更新PC。</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic8.png" alt=""></p>
<h4 id="o-control模块——产生控制信号"><a href="#o-control模块——产生控制信号" class="headerlink" title="o) control模块——产生控制信号"></a>o) control模块——产生控制信号</h4><table>
<thead>
<tr>
<th>control.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>rst</td>
<td>复位信号高电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[5:0]</td>
<td>Op</td>
<td></td>
</tr>
<tr>
<td>input</td>
<td>[4:0]</td>
<td>Rt</td>
<td></td>
</tr>
<tr>
<td>input</td>
<td>[5:0]</td>
<td>Funct</td>
<td></td>
</tr>
<tr>
<td>input</td>
<td>[1:0]</td>
<td>RsCMPRt</td>
<td>Rs和Rt寄存器比较结果</td>
</tr>
<tr>
<td>input</td>
<td>[1:0]</td>
<td>RsCMPZero</td>
<td>Rs寄存器和0比较结果</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>PCSrc</td>
<td>0:+4，1:Branch，2:J，3:JR</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegDst</td>
<td>0:RegWtaddr=rt，1:RegWtaddr=rd</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>ALUSrcASel</td>
<td>0:RegRdout1，1:ShamtZeroExtended</td>
</tr>
<tr>
<td>output</td>
<td>[1:0]</td>
<td>ALUSrcBSel</td>
<td>0:RegRdout2，1:IMMSignExtended，2:IMMZeroExtended</td>
</tr>
<tr>
<td>output</td>
<td>[4:0]</td>
<td>ALUControl</td>
<td></td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemRead</td>
<td>1:En</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemWrite</td>
<td>1:En</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>DMemtoReg</td>
<td>0:Aluout，1:DMemout</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>RegWrite</td>
<td>1:En</td>
</tr>
</tbody>
</table>
<p>根据输入信号，判断指令类型，输出对应控制信号的取值。</p>
<h4 id="p-debounce模块——去抖动"><a href="#p-debounce模块——去抖动" class="headerlink" title="p) debounce模块——去抖动"></a>p) debounce模块——去抖动</h4><table>
<thead>
<tr>
<th>debounce.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>in</td>
<td>输入信号，可能有抖动</td>
</tr>
<tr>
<td>output</td>
<td>[0:0]</td>
<td>out</td>
<td>输出信号，输入稳定后才变化</td>
</tr>
</tbody>
</table>
<h4 id="q-seg模块——7段数码管"><a href="#q-seg模块——7段数码管" class="headerlink" title="q) seg模块——7段数码管"></a>q) seg模块——7段数码管</h4><table>
<thead>
<tr>
<th>seg.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>rst_n</td>
<td>复位信号，低电平有效</td>
</tr>
<tr>
<td>input</td>
<td>[31:0]</td>
<td>data32</td>
<td>要显示的数据</td>
</tr>
<tr>
<td>output</td>
<td>[3:0]</td>
<td>sel</td>
<td>选择当前显示位，低电平有效</td>
</tr>
<tr>
<td>output</td>
<td>[6:0]</td>
<td>segments</td>
<td>选择显示的数码管，高电平有效</td>
</tr>
</tbody>
</table>
<h4 id="r-top模块——实例化以上模块，连接各个信号"><a href="#r-top模块——实例化以上模块，连接各个信号" class="headerlink" title="r) top模块——实例化以上模块，连接各个信号"></a>r) top模块——实例化以上模块，连接各个信号</h4><table>
<thead>
<tr>
<th>top.v</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>输入/输出</td>
<td>宽度</td>
<td>信号名</td>
<td>说明</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>clk</td>
<td>时钟沿</td>
</tr>
<tr>
<td>input</td>
<td>[7:0]</td>
<td>sw</td>
<td>开关选择</td>
</tr>
<tr>
<td>output</td>
<td>[6:0]</td>
<td>seg7</td>
<td>7段数码管选择</td>
</tr>
<tr>
<td>output</td>
<td>[3:0]</td>
<td>an</td>
<td>7段数码管位选择</td>
</tr>
<tr>
<td>input</td>
<td>[0:0]</td>
<td>btns</td>
<td>按钮中间，按下复位</td>
</tr>
</tbody>
</table>
<h3 id="4、-信号命名规则"><a href="#4、-信号命名规则" class="headerlink" title="4、    信号命名规则"></a>4、    信号命名规则</h3><h4 id="（1）-信号名称由几个单词（或其简写）构成，每个单词首字母大写"><a href="#（1）-信号名称由几个单词（或其简写）构成，每个单词首字母大写" class="headerlink" title="（1）    信号名称由几个单词（或其简写）构成，每个单词首字母大写"></a>（1）    信号名称由几个单词（或其简写）构成，每个单词首字母大写</h4><h4 id="（2）-一般先写该信号对应的部件名，然后紧跟操作或接口名。"><a href="#（2）-一般先写该信号对应的部件名，然后紧跟操作或接口名。" class="headerlink" title="（2）    一般先写该信号对应的部件名，然后紧跟操作或接口名。"></a>（2）    一般先写该信号对应的部件名，然后紧跟操作或接口名。</h4><h4 id="（3）-如果该信号是另外一个信号的选择信号，则加上Sel后缀。"><a href="#（3）-如果该信号是另外一个信号的选择信号，则加上Sel后缀。" class="headerlink" title="（3）    如果该信号是另外一个信号的选择信号，则加上Sel后缀。"></a>（3）    如果该信号是另外一个信号的选择信号，则加上Sel后缀。</h4><h4 id="（4）-如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。"><a href="#（4）-如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。" class="headerlink" title="（4）    如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。"></a>（4）    如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。</h4><h4 id="（5）-以上面方法命名基本不会引起混淆。"><a href="#（5）-以上面方法命名基本不会引起混淆。" class="headerlink" title="（5）    以上面方法命名基本不会引起混淆。"></a>（5）    以上面方法命名基本不会引起混淆。</h4><ul>
<li>比如：RegRdout1_EX表示寄存器文件读端口1读出的数据传递到EX段的信号。</li>
</ul>
<h3 id="5、-DMem和IMem的初始化"><a href="#5、-DMem和IMem的初始化" class="headerlink" title="5、    DMem和IMem的初始化"></a>5、    DMem和IMem的初始化</h3><p>IP核选择Block Memory，设置为Single Port RAM，</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic9.png" alt=""> </p>
<p>宽度为32，深度为256</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic10.png" alt="">  </p>
<p>选中Load Init File设置，选择初始化coe文件的路径，</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic11.png" alt="">  </p>
<p>其中IMem_init_test.coe文件内容为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">memory_initialization_radix = 16;</span><br><span class="line">memory_initialization_vector =</span><br><span class="line">20110008</span><br><span class="line">01d17020</span><br><span class="line">21ceffff</span><br><span class="line">11c00001</span><br><span class="line">02200008</span><br><span class="line">20100001</span><br><span class="line">200f2000</span><br><span class="line">20080010</span><br><span class="line">00084040</span><br><span class="line">00084082</span><br><span class="line">ade80000</span><br><span class="line">21ef0004</span><br><span class="line">8de9fffc</span><br><span class="line">01295004</span><br><span class="line">3c090001</span><br><span class="line">ade90000</span><br><span class="line">21ef0004</span><br><span class="line">adea0000</span><br><span class="line">21ef0004</span><br><span class="line">01505022</span><br><span class="line">adea0000</span><br><span class="line">21ef0004</span><br><span class="line">010a4025</span><br><span class="line">01004024</span><br><span class="line">01084027</span><br><span class="line">ade80000</span><br><span class="line">21ef0004</span><br><span class="line">01485826</span><br><span class="line">000b5843</span><br><span class="line">020b5807</span><br><span class="line">adeb0000</span><br><span class="line">21ef0004</span><br><span class="line">000b5842</span><br><span class="line">020b5806</span><br><span class="line">000b5dc0</span><br><span class="line">016b5821</span><br><span class="line">adeb0000</span><br><span class="line">21ef0004</span><br><span class="line">01685823</span><br><span class="line">adeb0000</span><br><span class="line">21ef0004</span><br><span class="line">256b0001</span><br><span class="line">adeb0000</span><br><span class="line">21ef0004</span><br><span class="line">356b0001</span><br><span class="line">316b0003</span><br><span class="line">390b0001</span><br><span class="line">adeb0000</span><br><span class="line">21ef0004</span><br><span class="line">020b602a</span><br><span class="line">adec0000</span><br><span class="line">21ef0004</span><br><span class="line">020b602b</span><br><span class="line">adec0000</span><br><span class="line">21ef0004</span><br><span class="line">296c0001</span><br><span class="line">adec0000</span><br><span class="line">21ef0004</span><br><span class="line">2d6c0001</span><br><span class="line">adec0000</span><br><span class="line">21ef0004</span><br><span class="line">018c680a</span><br><span class="line">aded0000</span><br><span class="line">21ef0004</span><br><span class="line">0210680b</span><br><span class="line">aded0000</span><br><span class="line">21ef0004</span><br><span class="line">200e0000</span><br><span class="line">08000062</span><br><span class="line">08000066</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">1560fffb</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">1000fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">1800fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">0560fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">0401fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">1e00fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">1560fff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">21ef0004</span><br><span class="line">116bfff8</span><br><span class="line">21ce0001</span><br><span class="line">adee0000</span><br><span class="line">08000068;</span><br></pre></td></tr></table></figure></p>
<p>DMem的初始化类似该过程，其coe文件初始全为0。</p>
<h3 id="6、-测试的汇编代码"><a href="#6、-测试的汇编代码" class="headerlink" title="6、    测试的汇编代码"></a>6、    测试的汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">    addi $17, $0, 8 #const $17=8</span><br><span class="line">    add $14, $14, $17 #$14=8</span><br><span class="line">    addi $14, $14, -1 #$14--</span><br><span class="line">    beq $14, $0, begin</span><br><span class="line">    jr $17 #jump to IMemAddr 8</span><br><span class="line">begin:</span><br><span class="line">    addi $16, $0, 1 #const 1</span><br><span class="line">    addi $15, $0, 8192 #MemAddr</span><br><span class="line">    addi $8, $0, 16 #$8=16</span><br><span class="line">    sll $8, $8, 1 #$8=32</span><br><span class="line">    srl $8, $8, 2 #$8=8</span><br><span class="line">    sw $8, 0($15) #-------Save Value: 8------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    lw $9, -4($15) #$9=8(32&apos;b00000000_00000001_00000000_00001000)</span><br><span class="line">    sllv $10, $9, $9 #$10=2048(32&apos;b00000000_00000000_00001000_00000000)</span><br><span class="line">    lui $9, 1 #$9=32&apos;b00000000_00000001_00000000_00000000</span><br><span class="line">    sw $9, 0($15) #-------Save Value: 32&apos;b00000000_00000001_00000000_00001000------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    sw $10, 0($15) #-------Save Value: 2048------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++</span><br><span class="line">    sub $10, $10, $16 #$10=2047(32&apos;b00000000_00000000_00000111_11111111)</span><br><span class="line">    sw $10, 0($15) #-------Save Value: 2047------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++</span><br><span class="line">    or $8, $8, $10 #$8=2047(32&apos;b111_11111111)</span><br><span class="line">    and $8, $8, $0 #$8=0</span><br><span class="line">    nor $8, $8, $8 #$8=2^32-1</span><br><span class="line">    sw $8, 0($15) #-------Save Value: 2^32-1------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    xor $11, $10, $8 #$11=32&apos;b11111111_11111111_11111000_00000000</span><br><span class="line">    sra $11, $11, 1 #$11=32&apos;b11111111_11111111_11111100_00000000</span><br><span class="line">    srav $11, $11, $16 #$11=32&apos;b11111111_11111111_11111110_00000000</span><br><span class="line">    sw $11, 0($15) #-------Save Value: 32&apos;b11111111_11111111_11111110_00000000------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    srl $11, $11, 1 #$11=32&apos;b01111111_11111111_11111111_00000000</span><br><span class="line">    srlv $11, $11, $16 #$11=32&apos;b00111111_11111111_11111111_10000000</span><br><span class="line">    sll $11, $11, 23 #$11=32&apos;b01000000_00000000_00000000_00000000</span><br><span class="line">    addu $11, $11, $11 #$11=32&apos;b10000000_00000000_00000000_00000000</span><br><span class="line">    sw $11, 0($15) #-------Save Value: 32&apos;b10000000_00000000_00000000_00000000------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    subu $11, $11, $8 #$11=32&apos;b10000000_00000000_00000000_00000001</span><br><span class="line">    sw $11, 0($15) #-------Save Value: 32&apos;b10000000_00000000_00000000_00000001------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    addiu $11, $11, 1 #$11=32&apos;b10000000_00000000_00000000_00000010</span><br><span class="line">    sw $11, 0($15) #-------Save Value: 32&apos;b10000000_00000000_00000000_00000010------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    ori $11, $11, 1 #$11=32&apos;b10000000_00000000_00000000_00000011</span><br><span class="line">    andi $11, $11, 3 #$11=32&apos;b00000000_00000000_00000000_00000011</span><br><span class="line">    xori $11, $8, 1 #$11=32&apos;b11111111_11111111_11111111_11111110</span><br><span class="line">    sw $11, 0($15) #-------Save Value: 32&apos;b11111111_11111111_11111111_11111100------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    slt $12, $16, $11 #$12=0</span><br><span class="line">    sw $12, 0($15) #-------Save Value: 0------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    sltu $12, $16, $11 #$12=1</span><br><span class="line">    sw $12, 0($15) #-------Save Value: 1------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    slti $12, $11, 1 #$12=1</span><br><span class="line">    sw $12, 0($15) #-------Save Value: 1------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++ </span><br><span class="line">    sltiu $12, $11, 1 #$12=0</span><br><span class="line">    sw $12, 0($15) #-------Save Value: 0------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    movz $13, $12, $12 #because $12=0, set $13=$12,</span><br><span class="line">    sw $13, 0($15) #-------Save Value: 0------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++         </span><br><span class="line">    movn $13, $16, $16 #because $16=1(!=0), set $13=$16,</span><br><span class="line">    sw $13, 0($15) #-------Save Value: 1------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++</span><br><span class="line">    addi $14, $0, 0 #count</span><br><span class="line">    j a</span><br><span class="line">i:  j end</span><br><span class="line">h:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    bne $11, $0, i #to i    </span><br><span class="line">g:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    beq $0, $0, h #to h </span><br><span class="line">f:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    blez $0, g #to g</span><br><span class="line">e:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    bltz $11, f #to f</span><br><span class="line">d:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    bgez $0, e #to e</span><br><span class="line">c:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    bgtz $16, d #to d</span><br><span class="line">b:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    bne $11,$0, c #to c</span><br><span class="line">a:  addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">    addi $15, $15, 4 #MemAddr++     </span><br><span class="line">    beq $11, $11, b #to b</span><br><span class="line">end:addi $14, $14, 1 #count++</span><br><span class="line">    sw $14, 0($15) #-------Save Value: $14------</span><br><span class="line">out:j out</span><br></pre></td></tr></table></figure>
<p>完整汇编代码如上，36条指令均测试到了，每条语句的执行结果在该语句后面给出了注释，每测试几条指令就将结果写入内存，方便查看，并且3种相关有包括在上面的代码中。<br>​     </p>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><h3 id="（1）仿真结果"><a href="#（1）仿真结果" class="headerlink" title="（1）仿真结果"></a>（1）仿真结果</h3><p>汇编代码在Mars编译运行得到Data段为</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic12.png" alt=""> </p>
<p>而ISE仿真结果显示DMem为</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic13.png" alt="">  </p>
<p>汇编代码在Mars编译运行得到结束时寄存器数据和仿真结果的regfile数据     </p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic14.png" alt="">     </p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic15.png" alt="">             </p>
<p>可见测试程序在编写的MIPS CPU上运行结果与Mars运行结果一致，并且符合上面注释的的预期结果。</p>
<h3 id="（2）下载结果"><a href="#（2）下载结果" class="headerlink" title="（2）下载结果"></a>（2）下载结果</h3><p>按下按钮中键复位，拨动开关选择地址，数码管显示对应地址内存。</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic16.png" alt="">     </p>
<p>由于数据为32位，4个数码管只能显示16位，为此还实现了动态显示，数字会向左移动循环显示。</p>
<p><img src="//l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/pic17.png" alt=""> </p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录:"></a>附录:</h2><h3 id="一、-编写过程中遇到问题和一些发现"><a href="#一、-编写过程中遇到问题和一些发现" class="headerlink" title="一、    编写过程中遇到问题和一些发现"></a>一、    编写过程中遇到问题和一些发现</h3><h4 id="1、如果位拼接作为左值，单个变量也要花括号，如"><a href="#1、如果位拼接作为左值，单个变量也要花括号，如" class="headerlink" title="1、如果位拼接作为左值，单个变量也要花括号，如"></a>1、如果位拼接作为左值，单个变量也要花括号，如</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;RegDst&#125;,&#123;ALUSrc&#125;,&#123;MemtoReg&#125;,&#123;RegWrite&#125;,&#123;MemWrite&#125;,&#123;Branch&#125;,&#123;ALUOp[1:0]&#125;,&#123;Jump&#125;&#125;=9&apos;b100100100;</span><br></pre></td></tr></table></figure>
<h4 id="2、”-”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“-”不成立，这是一个不好发现的问题。"><a href="#2、”-”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“-”不成立，这是一个不好发现的问题。" class="headerlink" title="2、”==”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“==”不成立，这是一个不好发现的问题。"></a>2、”==”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“==”不成立，这是一个不好发现的问题。</h4><h4 id="3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。"><a href="#3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。" class="headerlink" title="3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。"></a>3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。</h4><h4 id="4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。"><a href="#4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。" class="headerlink" title="4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。"></a>4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。</h4><h4 id="5、在clk边缘用-lt-对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）"><a href="#5、在clk边缘用-lt-对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）" class="headerlink" title="5、在clk边缘用&lt;=对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）"></a>5、在clk边缘用&lt;=对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）</h4><h4 id="6、-srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现"><a href="#6、-srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现" class="headerlink" title="6、 srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现"></a>6、 srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现</h4><pre><code>`$signed(alu_a) &gt;&gt;&gt; alu_b`
</code></pre><h4 id="应该注意，-gt-gt-gt-是算术右移，但对于无符号数，高位仍然补0，所以需要用-signed-转为有符号数"><a href="#应该注意，-gt-gt-gt-是算术右移，但对于无符号数，高位仍然补0，所以需要用-signed-转为有符号数" class="headerlink" title="应该注意， &gt;&gt;&gt; 是算术右移，但对于无符号数，高位仍然补0，所以需要用$signed()转为有符号数"></a>应该注意， &gt;&gt;&gt; 是算术右移，但对于无符号数，高位仍然补0，所以需要用<code>$signed()</code>转为有符号数</h4><pre><code>`$signed(alu_a) &gt;&gt; alu_b `
</code></pre><h4 id="这样写也不行，-gt-gt-不具有算术右移的功能"><a href="#这样写也不行，-gt-gt-不具有算术右移的功能" class="headerlink" title="这样写也不行，&gt;&gt;不具有算术右移的功能"></a>这样写也不行，&gt;&gt;不具有算术右移的功能</h4><h4 id="7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。"><a href="#7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。" class="headerlink" title="7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。"></a>7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。</h4><h3 id="二、-模块源代码"><a href="#二、-模块源代码" class="headerlink" title="二、    模块源代码"></a>二、    模块源代码</h3><h4 id="top-v"><a href="#top-v" class="headerlink" title="top.v"></a>top.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] sw,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>] seg7,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] an,</span><br><span class="line">    <span class="keyword">input</span> btnr,btnl,btns,btnd,btnu</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//_后缀表示该信号所在的流水段</span></span><br><span class="line">    <span class="keyword">wire</span> ALUSrcASel_ID;</span><br><span class="line">    <span class="keyword">wire</span> ALUSrcASel_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] ALUSrcBSel_ID;<span class="comment">//alu B在regout2和imm之间选择</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] ALUSrcBSel_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ALUSrcA_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ALUSrcB_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] ALUControl_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] ALUControl_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_MEM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_WB;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] RsCMPZero;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] RsCMPRt;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMMSignExtended_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMMSignExtended_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMMZeroExtended_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMMZeroExtended_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ShamtZeroExtended_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ShamtZeroExtended_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] RegRdout1Sel_Forward_EX;<span class="comment">//旁路单元产生的选择信号</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] RegRdout2Sel_Forward_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout1_Forward_EX;<span class="comment">//旁路数据</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout2_Forward_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegRdaddr1_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout1_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout1_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegRdaddr2_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout2_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout2_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_EX;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_MEM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_WB;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] RegWtin_WB;</span><br><span class="line">    <span class="keyword">wire</span> RegWrite_ID;</span><br><span class="line">    <span class="keyword">wire</span> RegWrite_EX;</span><br><span class="line">    <span class="keyword">wire</span> RegWrite_MEM;</span><br><span class="line">    <span class="keyword">wire</span> RegWrite_WB;</span><br><span class="line">    <span class="keyword">wire</span> RegDst_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMemaddr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMemout;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] DMemaddr_MEM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] DMemin_MEM;</span><br><span class="line">    <span class="keyword">wire</span> DMemRead_MEM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] DMemout_MEM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] DMemout_WB;</span><br><span class="line">    <span class="keyword">wire</span> DMemWrite_MEM;</span><br><span class="line">    <span class="keyword">wire</span> DMemtoReg_EX;</span><br><span class="line">    <span class="keyword">wire</span> DMemtoReg_MEM;</span><br><span class="line">    <span class="keyword">wire</span> DMemtoReg_WB;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PC;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_IF;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_EX;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] EPC;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] nextPC;</span><br><span class="line">    <span class="keyword">wire</span> PCEn;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] PCSrc_ID;<span class="comment">//Control输出的，0:+4,1:Branch,2:J,3:JR</span></span><br><span class="line">    <span class="keyword">wire</span> IF_ID_En;</span><br><span class="line">    <span class="keyword">wire</span> IF_ID_Flush;</span><br><span class="line">    <span class="keyword">wire</span> ID_EX_Flush;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCJump_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCJR_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PCBranch_ID;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] Instr;  </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">5</span>:<span class="number">0</span>] Funct;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Shamt;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] IMM16;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Rd;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Rt;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Rs;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">5</span>:<span class="number">0</span>] Op;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Rt_EX;<span class="comment">//为了旁路判断</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] Rs_EX;<span class="comment">//为了旁路判断</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">25</span>:<span class="number">0</span>] JumpIMM;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] IMMSignExtendedShiftLeft2;</span><br><span class="line">    <span class="keyword">wire</span> btns_d;</span><br><span class="line">    debounce debounce(clk,btns,btns_d);<span class="comment">//中键去抖动</span></span><br><span class="line">    <span class="keyword">reg</span> rst;</span><br><span class="line">    <span class="keyword">assign</span> Led = rst;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> btns_d) rst=~rst;</span><br><span class="line">    <span class="comment">//--------------regfile_copy_DMem是DMem的一份复制--------------</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] addr_show;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] out_show;</span><br><span class="line">    <span class="keyword">assign</span> addr_show = sw;<span class="comment">//开关输输入要显示的地址</span></span><br><span class="line">    seg seg1(clk,<span class="number">1'b1</span>,out_show,an,seg7);<span class="comment">//显示数据</span></span><br><span class="line">    regfile_copy_DMem regfile_copy_DMem(clk,~rst,addr_show,out_show,DMemaddr_MEM &gt;&gt; <span class="number">2</span>,DMemin_MEM,DMemWrite_MEM);</span><br><span class="line">    <span class="comment">//---------------方便显示内存-------------------------</span></span><br><span class="line">    <span class="comment">//=======================IF========================</span></span><br><span class="line">    mux4 MUXPC(</span><br><span class="line">        <span class="variable">.sel</span>(PCSrc_ID),</span><br><span class="line">        <span class="variable">.d0</span>(PCPlus_IF),<span class="comment">//+4直接用IF的</span></span><br><span class="line">        <span class="variable">.d1</span>(PCBranch_ID),</span><br><span class="line">        <span class="variable">.d2</span>(PCJump_ID),</span><br><span class="line">        <span class="variable">.d3</span>(PCJR_ID),</span><br><span class="line">        <span class="variable">.out</span>(nextPC)</span><br><span class="line">    );</span><br><span class="line">    dff DFFPC(</span><br><span class="line">        <span class="variable">.clk</span>(~clk),<span class="comment">//下降沿更新PC</span></span><br><span class="line">        <span class="variable">.en</span>(PCEn),</span><br><span class="line">        <span class="variable">.rst</span>(rst),</span><br><span class="line">        <span class="variable">.datain</span>(nextPC),</span><br><span class="line">        <span class="variable">.dataout</span>(PC)</span><br><span class="line">    );  </span><br><span class="line">    alu ALUPCPlus(PC,<span class="number">4</span>,<span class="number">5'd01</span>,PCPlus_IF);</span><br><span class="line">    <span class="keyword">assign</span> IMemaddr = PC &gt;&gt; <span class="number">2</span>;<span class="comment">//&gt;&gt;2是因为这里IMem是每个地址存储4字节，和实际上的（一地址一字节）不一样</span></span><br><span class="line">    IMem IMem(clk,<span class="number">1'b0</span>,IMemaddr,<span class="number">32'b0</span>,IMemout);<span class="comment">//上升沿读指令</span></span><br><span class="line">    <span class="comment">//======================IFID========================</span></span><br><span class="line">    IFID IFID(</span><br><span class="line">        <span class="variable">.clk</span>(~clk),</span><br><span class="line">        <span class="variable">.en</span>(IF_ID_En),</span><br><span class="line">        <span class="variable">.flush</span>(IF_ID_Flush || rst),</span><br><span class="line">        <span class="variable">.PCPlus_in</span>(PCPlus_IF),</span><br><span class="line">        <span class="variable">.IMemout_in</span>(IMemout),</span><br><span class="line">        <span class="variable">.PCPlus_out</span>(PCPlus_ID),</span><br><span class="line">        <span class="variable">.IMemout_out</span>(Instr)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//=======================ID==========================</span></span><br><span class="line">    <span class="keyword">assign</span> JumpIMM = Instr[<span class="number">25</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> Funct = Instr[<span class="number">5</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> Shamt = Instr[<span class="number">10</span>:<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">assign</span> IMM16 = Instr[<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> Rd = Instr[<span class="number">15</span>:<span class="number">11</span>];</span><br><span class="line">    <span class="keyword">assign</span> Rt = Instr[<span class="number">20</span>:<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">assign</span> Rs = Instr[<span class="number">25</span>:<span class="number">21</span>];</span><br><span class="line">    <span class="keyword">assign</span> Op = Instr[<span class="number">31</span>:<span class="number">26</span>];</span><br><span class="line">    <span class="comment">//*******Control*******</span></span><br><span class="line">    control control(</span><br><span class="line">        <span class="comment">//in</span></span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rst</span>(rst),</span><br><span class="line">        <span class="variable">.Op</span>(Op),</span><br><span class="line">        <span class="variable">.Rt</span>(Rt),</span><br><span class="line">        <span class="variable">.Funct</span>(Funct),</span><br><span class="line">        <span class="variable">.RsCMPRt</span>(RsCMPRt),</span><br><span class="line">        <span class="variable">.RsCMPZero</span>(RsCMPZero),</span><br><span class="line">        <span class="comment">//out</span></span><br><span class="line">        <span class="variable">.PCSrc</span>(PCSrc_ID), </span><br><span class="line">        <span class="comment">//ID</span></span><br><span class="line">        <span class="variable">.RegDst</span>(RegDst_ID),</span><br><span class="line">        <span class="comment">//EX</span></span><br><span class="line">        <span class="variable">.ALUSrcASel</span>(ALUSrcASel_ID),</span><br><span class="line">        <span class="variable">.ALUSrcBSel</span>(ALUSrcBSel_ID), </span><br><span class="line">        <span class="variable">.ALUControl</span>(ALUControl_ID),</span><br><span class="line">        <span class="comment">//MEM</span></span><br><span class="line">        <span class="variable">.DMemRead</span>(DMemRead_ID),</span><br><span class="line">        <span class="variable">.DMemWrite</span>(DMemWrite_ID),</span><br><span class="line">        <span class="comment">//WB</span></span><br><span class="line">        <span class="variable">.DMemtoReg</span>(DMemtoReg_ID),</span><br><span class="line">        <span class="variable">.RegWrite</span>(RegWrite_ID)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//*******Control*******</span></span><br><span class="line">    <span class="keyword">assign</span> RegRdaddr1_ID = Rs;</span><br><span class="line">    <span class="keyword">assign</span> RegRdaddr2_ID = Rt;</span><br><span class="line">    mux <span class="variable">#(5) MUXRegWtaddr(RegDst_ID,Rt,Rd,RegWtaddr_ID)</span>;</span><br><span class="line">    <span class="keyword">assign</span> ShamtZeroExtended_ID = &#123;&#123;<span class="number">27</span>&#123;<span class="number">1'b0</span>&#125;&#125;,Shamt&#125;;</span><br><span class="line">    <span class="keyword">assign</span> IMMSignExtended_ID = &#123;&#123;<span class="number">16</span>&#123;IMM16[<span class="number">15</span>]&#125;&#125;,IMM16&#125;;</span><br><span class="line">    <span class="keyword">assign</span> IMMZeroExtended_ID = &#123;&#123;<span class="number">16</span>&#123;<span class="number">1'b0</span>&#125;&#125;,IMM16&#125;;</span><br><span class="line">    <span class="keyword">assign</span> IMMSignExtendedShiftLeft2 = IMMSignExtended_ID &lt;&lt; <span class="number">2</span>;</span><br><span class="line">    alu BranchALU(PCPlus_ID,IMMSignExtendedShiftLeft2,<span class="number">5'd01</span>,PCBranch_ID);</span><br><span class="line">    <span class="keyword">assign</span> PCJump_ID = &#123;&#123;PCPlus_ID[<span class="number">31</span>:<span class="number">28</span>]&#125;,&#123;&#123;<span class="number">2'b00</span>,JumpIMM&#125;&lt;&lt;<span class="number">2</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">assign</span> PCJR_ID = RegRdout1_ID;</span><br><span class="line">    <span class="keyword">assign</span> IF_ID_Flush = (PCSrc_ID != <span class="number">2'b00</span>);<span class="comment">//有跳转则清空IF_ID寄存器</span></span><br><span class="line">	regfile regfile(clk,~rst,RegRdaddr1_ID,RegRdout1_ID,RegRdaddr2_ID,RegRdout2_ID,RegWtaddr_WB,RegWtin_WB,RegWrite_WB);</span><br><span class="line">    compare compare1(RegRdout1_ID,RegRdout2_ID,RsCMPRt);<span class="comment">//for beq,bne</span></span><br><span class="line">    compare compare2(RegRdout1_ID,<span class="number">0</span>,RsCMPZero);<span class="comment">//for movz,movn,blez,bgtz,bltz,bgez</span></span><br><span class="line">    hazard hazard(Rs,Rt,RegWtaddr_EX,DMemRead_EX,PCEn,IF_ID_En,ID_EX_Flush);</span><br><span class="line">    <span class="comment">//======================IDEX=========================</span></span><br><span class="line">    IDEX IDEX(</span><br><span class="line">        <span class="variable">.clk</span>(~clk),</span><br><span class="line">        <span class="variable">.en</span>(<span class="number">1'b1</span>),  </span><br><span class="line">        <span class="variable">.flush</span>(ID_EX_Flush || rst),</span><br><span class="line">        <span class="comment">//data</span></span><br><span class="line">        <span class="comment">//in</span></span><br><span class="line">        <span class="variable">.PCPlus_in</span>(PCPlus_ID),</span><br><span class="line">        <span class="variable">.RegRdout1_in</span>(RegRdout1_ID),</span><br><span class="line">        <span class="variable">.RegRdout2_in</span>(RegRdout2_ID),</span><br><span class="line">        <span class="variable">.IMMSignExtended_in</span>(IMMSignExtended_ID),</span><br><span class="line">        <span class="variable">.IMMZeroExtended_in</span>(IMMZeroExtended_ID),</span><br><span class="line">        <span class="variable">.ShamtZeroExtended_in</span>(ShamtZeroExtended_ID),</span><br><span class="line">        <span class="variable">.Rs_in</span>(Rs),</span><br><span class="line">        <span class="variable">.Rt_in</span>(Rt),</span><br><span class="line">        <span class="variable">.RegWtaddr_in</span>(RegWtaddr_ID),</span><br><span class="line">        <span class="comment">//out</span></span><br><span class="line">        <span class="variable">.PCPlus_out</span>(PCPlus_EX),</span><br><span class="line">        <span class="variable">.RegRdout1_out</span>(RegRdout1_EX),</span><br><span class="line">        <span class="variable">.RegRdout2_out</span>(RegRdout2_EX),</span><br><span class="line">        <span class="variable">.IMMSignExtended_out</span>(IMMSignExtended_EX),</span><br><span class="line">        <span class="variable">.IMMZeroExtended_out</span>(IMMZeroExtended_EX),</span><br><span class="line">        <span class="variable">.ShamtZeroExtended_out</span>(ShamtZeroExtended_EX),</span><br><span class="line">        <span class="variable">.Rs_out</span>(Rs_EX),</span><br><span class="line">        <span class="variable">.Rt_out</span>(Rt_EX),</span><br><span class="line">        <span class="variable">.RegWtaddr_out</span>(RegWtaddr_EX),</span><br><span class="line">		<span class="comment">//control sign</span></span><br><span class="line">		<span class="comment">//in</span></span><br><span class="line">		<span class="variable">.RegDst_in</span>(RegDst_ID),</span><br><span class="line">		<span class="variable">.ALUSrcASel_in</span>(ALUSrcASel_ID),</span><br><span class="line">		<span class="variable">.ALUSrcBSel_in</span>(ALUSrcBSel_ID), </span><br><span class="line">		<span class="variable">.ALUControl_in</span>(ALUControl_ID),</span><br><span class="line">		<span class="variable">.DMemRead_in</span>(DMemRead_ID),</span><br><span class="line">		<span class="variable">.DMemWrite_in</span>(DMemWrite_ID),</span><br><span class="line">		<span class="variable">.DMemtoReg_in</span>(DMemtoReg_ID),</span><br><span class="line">		<span class="variable">.RegWrite_in</span>(RegWrite_ID),</span><br><span class="line">		<span class="comment">//out</span></span><br><span class="line">		<span class="variable">.RegDst_out</span>(RegDst_EX),</span><br><span class="line">		<span class="variable">.ALUSrcASel_out</span>(ALUSrcASel_EX),</span><br><span class="line">		<span class="variable">.ALUSrcBSel_out</span>(ALUSrcBSel_EX), </span><br><span class="line">		<span class="variable">.ALUControl_out</span>(ALUControl_EX),</span><br><span class="line">		<span class="variable">.DMemRead_out</span>(DMemRead_EX),</span><br><span class="line">		<span class="variable">.DMemWrite_out</span>(DMemWrite_EX),</span><br><span class="line">		<span class="variable">.DMemtoReg_out</span>(DMemtoReg_EX),</span><br><span class="line">		<span class="variable">.RegWrite_out</span>(RegWrite_EX)</span><br><span class="line">	);</span><br><span class="line">	<span class="comment">//========================EX=========================</span></span><br><span class="line">	forward forward(Rs_EX,Rt_EX,RegWrite_MEM,RegWrite_WB,RegWtaddr_MEM,RegWtaddr_WB,RegRdout1Sel_Forward_EX,RegRdout2Sel_Forward_EX);</span><br><span class="line">	mux4 MUXRegRdout1FW(RegRdout1Sel_Forward_EX,RegRdout1_EX,RegWtin_WB,ALUResult_MEM,<span class="number">0</span>,RegRdout1_Forward_EX);<span class="comment">//forward</span></span><br><span class="line">	mux4 MUXRegRdout2FW(RegRdout2Sel_Forward_EX,RegRdout2_EX,RegWtin_WB,ALUResult_MEM,<span class="number">0</span>,RegRdout2_Forward_EX);<span class="comment">//forward</span></span><br><span class="line">	mux MUXALUSrcA(ALUSrcASel_EX,RegRdout1_Forward_EX,ShamtZeroExtended_EX,ALUSrcA_EX);</span><br><span class="line">	mux4 MUXALUSrcB(ALUSrcBSel_EX,RegRdout2_Forward_EX,IMMSignExtended_EX,IMMZeroExtended_EX,<span class="number">0</span>,ALUSrcB_EX);</span><br><span class="line">	alu alu(ALUSrcA_EX,ALUSrcB_EX,ALUControl_EX,ALUResult_EX);</span><br><span class="line">	<span class="comment">//======================EXMEM========================</span></span><br><span class="line">	EXMEM EXMEM(</span><br><span class="line">		<span class="variable">.clk</span>(~clk),</span><br><span class="line">		<span class="variable">.en</span>(<span class="number">1'b1</span>),</span><br><span class="line">		<span class="variable">.flush</span>(rst),</span><br><span class="line">		<span class="comment">//data</span></span><br><span class="line">		<span class="comment">//in</span></span><br><span class="line">		<span class="variable">.ALUResult_in</span>(ALUResult_EX),</span><br><span class="line">		<span class="variable">.DMemin_in</span>(RegRdout2_Forward_EX),</span><br><span class="line">		<span class="variable">.RegWtaddr_in</span>(RegWtaddr_EX),</span><br><span class="line">		<span class="comment">//out</span></span><br><span class="line">		<span class="variable">.ALUResult_out</span>(ALUResult_MEM),</span><br><span class="line">		<span class="variable">.DMemin_out</span>(DMemin_MEM),</span><br><span class="line">		<span class="variable">.RegWtaddr_out</span>(RegWtaddr_MEM),</span><br><span class="line">		<span class="comment">//control sign</span></span><br><span class="line">		<span class="comment">//in</span></span><br><span class="line">		<span class="variable">.DMemRead_in</span>(DMemRead_EX),</span><br><span class="line">		<span class="variable">.DMemWrite_in</span>(DMemWrite_EX),</span><br><span class="line">		<span class="variable">.DMemtoReg_in</span>(DMemtoReg_EX),</span><br><span class="line">		<span class="variable">.RegWrite_in</span>(RegWrite_EX),</span><br><span class="line">		<span class="comment">//out</span></span><br><span class="line">		<span class="variable">.DMemRead_out</span>(DMemRead_MEM),</span><br><span class="line">		<span class="variable">.DMemWrite_out</span>(DMemWrite_MEM),</span><br><span class="line">		<span class="variable">.DMemtoReg_out</span>(DMemtoReg_MEM),</span><br><span class="line">		<span class="variable">.RegWrite_out</span>(RegWrite_MEM)</span><br><span class="line">	);</span><br><span class="line">	<span class="comment">//=======================MEM=========================   </span></span><br><span class="line">	<span class="keyword">assign</span> DMemaddr_MEM = ALUResult_MEM;</span><br><span class="line">	DMem DMem(clk,DMemWrite_MEM,DMemaddr_MEM &gt;&gt; <span class="number">2</span>,DMemin_MEM,DMemout_MEM);  </span><br><span class="line">	<span class="comment">//======================MEMWB========================</span></span><br><span class="line">	MEMWB MEMWB(</span><br><span class="line">		<span class="variable">.clk</span>(~clk),</span><br><span class="line">		<span class="variable">.en</span>(<span class="number">1'b1</span>),</span><br><span class="line">		<span class="variable">.flush</span>(rst),</span><br><span class="line">		<span class="comment">//data</span></span><br><span class="line">		<span class="comment">//in</span></span><br><span class="line">		<span class="variable">.ALUResult_in</span>(ALUResult_MEM),</span><br><span class="line">		<span class="variable">.DMemout_in</span>(DMemout_MEM),</span><br><span class="line">		<span class="variable">.RegWtaddr_in</span>(RegWtaddr_MEM),</span><br><span class="line">		<span class="comment">//out</span></span><br><span class="line">		<span class="variable">.ALUResult_out</span>(ALUResult_WB),</span><br><span class="line">		<span class="variable">.DMemout_out</span>(DMemout_WB),</span><br><span class="line">		<span class="variable">.RegWtaddr_out</span>(RegWtaddr_WB),</span><br><span class="line">		<span class="comment">//control sign</span></span><br><span class="line">		<span class="comment">//in</span></span><br><span class="line">		<span class="variable">.DMemtoReg_in</span>(DMemtoReg_MEM),</span><br><span class="line">		<span class="variable">.RegWrite_in</span>(RegWrite_MEM),</span><br><span class="line">		<span class="comment">//out</span></span><br><span class="line">		<span class="variable">.DMemtoReg_out</span>(DMemtoReg_WB),</span><br><span class="line">		<span class="variable">.RegWrite_out</span>(RegWrite_WB)</span><br><span class="line">	);</span><br><span class="line">	<span class="comment">//========================WB=========================</span></span><br><span class="line">	mux MUXDMemtoReg(DMemtoReg_WB,ALUResult_WB,DMemout_WB,RegWtin_WB);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="alu-v"><a href="#alu-v" class="headerlink" title="alu.v"></a>alu.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_NOP 5'd00 //nop</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_ADD 5'd01 //signed_add</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SUB 5'd02 //signed_sub</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_AND 5'd03 //and</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_OR  5'd04 //or</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_XOR 5'd05 //xor</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_NOR 5'd06 //nor</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_ADDU 5'd07 //unsigned_add</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SUBU 5'd08 //unsigned_sub</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SLT 5'd09 //slt</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SLTU 5'd10 //unsigned_slt</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SLL 5'd11 //sll</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SRL 5'd12 //srl</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_SRA 5'd13 //sra</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_MOV 5'd14 //movz,movn</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> A_LUI 5'd15 //lui</span></span><br><span class="line"><span class="keyword">module</span> alu(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] alu_a,<span class="comment">//无符号型的，如果有负数，是以补码存储</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] alu_b,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] alu_op,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] alu_out</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">always</span>@(*)</span><br><span class="line">        <span class="keyword">case</span> (alu_op)</span><br><span class="line">            <span class="meta">`A_NOP: alu_out = 0;</span></span><br><span class="line">            <span class="meta">`A_ADD: alu_out = alu_a + alu_b;</span></span><br><span class="line">            <span class="meta">`A_SUB: alu_out = alu_a - alu_b;</span></span><br><span class="line">            <span class="meta">`A_AND: alu_out = alu_a &amp; alu_b;</span></span><br><span class="line">            <span class="meta">`A_OR : alu_out = alu_a | alu_b;</span></span><br><span class="line">            <span class="meta">`A_XOR: alu_out = alu_a ^ alu_b;</span></span><br><span class="line">            <span class="meta">`A_NOR: alu_out = ~(alu_a | alu_b);</span></span><br><span class="line">            <span class="meta">`A_ADDU: alu_out = alu_a + alu_b;</span></span><br><span class="line">            <span class="meta">`A_SUBU: alu_out = alu_a - alu_b;</span></span><br><span class="line">            <span class="meta">`A_SLT: //a&lt;b(signed) return 1 <span class="meta-keyword">else</span> return 0;</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span>(alu_a[<span class="number">31</span>] == alu_b[<span class="number">31</span>]) alu_out = (alu_a &lt; alu_b) ? <span class="number">32'b1</span> : <span class="number">32'b0</span>;</span><br><span class="line"><span class="comment">//对于不加signed的变量类型，运算和比较视为无符号，但依然可以存储有符号数，这里相当于自行根据首位判断</span></span><br><span class="line"><span class="comment">//首位相等，即同号情况，直接比较，如果同正，后面31位大的，原数就大，如果同负，后面31位（补码）大的，依然是原数大</span></span><br><span class="line">                    <span class="keyword">else</span> alu_out = (alu_a[<span class="number">31</span>] &lt; alu_b[<span class="number">31</span>]) ? <span class="number">32'b0</span> : <span class="number">32'b1</span>;</span><br><span class="line"><span class="comment">//异号情况，直接比较符号</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="meta">`A_SLTU: alu_out = (alu_a &lt; alu_b) ? 32'b1 : 32'b0;</span></span><br><span class="line">            <span class="meta">`A_SLL: alu_out = alu_b &lt;&lt; alu_a;</span></span><br><span class="line">            <span class="meta">`A_SRL: alu_out = alu_b &gt;&gt; alu_a;</span></span><br><span class="line">            <span class="meta">`A_SRA: alu_out = $signed(alu_b) &gt;&gt;&gt; alu_a;</span></span><br><span class="line"><span class="comment">//使用&gt;&gt;&gt;为算术右移，高位补符号，应该注意，如果是无符号数，&gt;&gt;&gt;仍是逻辑右移，故应该$signed</span></span><br><span class="line">            <span class="meta">`A_MOV: alu_out = alu_b;</span></span><br><span class="line"><span class="comment">//原样输出，相当于reg[rt],mov本不需要通过alu，但因为是RType格式，故统一</span></span><br><span class="line">            <span class="meta">`A_LUI: alu_out = alu_b &lt;&lt; 16;</span></span><br><span class="line">            <span class="keyword">default</span>: ;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="regfile-v"><a href="#regfile-v" class="headerlink" title="regfile.v"></a>regfile.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> regfile(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rst_n,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] rAddr1,<span class="comment">//读地址1</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] rDout1,<span class="comment">//读数据1</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] rAddr2,<span class="comment">//读地址2</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] rDout2,<span class="comment">//读数据2</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] wAddr,<span class="comment">//写地址</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] wDin,<span class="comment">//写数据</span></span><br><span class="line">    <span class="keyword">input</span> wEna<span class="comment">//写使能</span></span><br><span class="line">    </span><br><span class="line">);</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] data [<span class="number">0</span>:<span class="number">31</span>];</span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">assign</span> rDout1=data[rAddr1];<span class="comment">//读1</span></span><br><span class="line">    <span class="keyword">assign</span> rDout2=data[rAddr2];<span class="comment">//读2</span></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)<span class="comment">//写和复位</span></span><br><span class="line">        <span class="keyword">if</span>(~rst_n)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i=i+<span class="number">1</span>) data[i]&lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(wEna)</span><br><span class="line">                data[wAddr]&lt;=wDin;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="dff-v"><a href="#dff-v" class="headerlink" title="dff.v"></a>dff.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> dff #(<span class="keyword">parameter</span> WIDTH = <span class="number">32</span>) ( <span class="comment">//Data Flip-Flop </span></span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> en,</span><br><span class="line">    <span class="keyword">input</span> rst,</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] datain,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] dataout</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(rst)</span><br><span class="line">            dataout &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(en)</span><br><span class="line">            dataout &lt;= datain;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="mux-v"><a href="#mux-v" class="headerlink" title="mux.v"></a>mux.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux #(<span class="keyword">parameter</span> WIDTH = <span class="number">32</span>)( <span class="comment">//2路选择器</span></span><br><span class="line">    <span class="keyword">input</span> sel,</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d0,</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d1,</span><br><span class="line">    <span class="keyword">output</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] out</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">assign</span> out = (sel == <span class="number">1'b1</span> ? d1 : d0);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="mux4-v"><a href="#mux4-v" class="headerlink" title="mux4.v"></a>mux4.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux4 #(<span class="keyword">parameter</span> WIDTH = <span class="number">32</span>)( <span class="comment">//4路选择器</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] sel,</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d0,</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d1,</span><br><span class="line">     <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d2,</span><br><span class="line">     <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] d3,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] out</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">always</span>@(*)</span><br><span class="line">        <span class="keyword">case</span>(sel)</span><br><span class="line">            <span class="number">2'b00</span>: out=d0;</span><br><span class="line">            <span class="number">2'b01</span>: out=d1;</span><br><span class="line">            <span class="number">2'b10</span>: out=d2;</span><br><span class="line">            <span class="number">2'b11</span>: out=d3;</span><br><span class="line">            <span class="keyword">default</span>:;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="IFID-v"><a href="#IFID-v" class="headerlink" title="IFID.v"></a>IFID.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> IFID(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> en,</span><br><span class="line">    <span class="keyword">input</span> flush,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] IMemout_in,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] IMemout_out</span><br><span class="line">    );</span><br><span class="line">     dff dff1(clk,en,flush,PCPlus_in,PCPlus_out);</span><br><span class="line">     dff dff2(clk,en,flush,IMemout_in,IMemout_out);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="IDEX-v"><a href="#IDEX-v" class="headerlink" title="IDEX.v"></a>IDEX.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> IDEX(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> en,</span><br><span class="line">    <span class="keyword">input</span> flush,<span class="comment">//flush for stall or start</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout1_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout2_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] IMMSignExtended_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] IMMZeroExtended_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] ShamtZeroExtended_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rs_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rt_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_in,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] PCPlus_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout1_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RegRdout2_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] IMMSignExtended_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] IMMZeroExtended_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] ShamtZeroExtended_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] Rs_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] Rt_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_out,</span><br><span class="line">    <span class="comment">//control</span></span><br><span class="line">    <span class="keyword">input</span> RegDst_in,</span><br><span class="line">    <span class="keyword">input</span> ALUSrcASel_in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] ALUSrcBSel_in, </span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] ALUControl_in,</span><br><span class="line">    <span class="keyword">input</span> DMemRead_in,</span><br><span class="line">    <span class="keyword">input</span> DMemWrite_in,</span><br><span class="line">    <span class="keyword">input</span> DMemtoReg_in,</span><br><span class="line">    <span class="keyword">input</span> RegWrite_in,</span><br><span class="line">    <span class="keyword">output</span> RegDst_out,</span><br><span class="line">    <span class="keyword">output</span> ALUSrcASel_out,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] ALUSrcBSel_out, </span><br><span class="line">    <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] ALUControl_out,</span><br><span class="line">    <span class="keyword">output</span> DMemRead_out,</span><br><span class="line">    <span class="keyword">output</span> DMemWrite_out,</span><br><span class="line">    <span class="keyword">output</span> DMemtoReg_out,</span><br><span class="line">    <span class="keyword">output</span> RegWrite_out</span><br><span class="line">    );</span><br><span class="line">    dff dff1(clk,en,flush,PCPlus_in,PCPlus_out);</span><br><span class="line">    dff dff2(clk,en,flush,RegRdout1_in,RegRdout1_out);</span><br><span class="line">    dff dff3(clk,en,flush,RegRdout2_in,RegRdout2_out);</span><br><span class="line">    dff dff4(clk,en,flush,IMMSignExtended_in,IMMSignExtended_out);</span><br><span class="line">    dff dff5(clk,en,flush,IMMZeroExtended_in,IMMZeroExtended_out);</span><br><span class="line">    dff dff6(clk,en,flush,ShamtZeroExtended_in,ShamtZeroExtended_out);</span><br><span class="line">    dff <span class="variable">#(5) dff7(clk,en,flush,Rs_in,Rs_out)</span>;</span><br><span class="line">    dff <span class="variable">#(5) dff8(clk,en,flush,Rt_in,Rt_out)</span>;</span><br><span class="line">    dff <span class="variable">#(5) dff9(clk,en,flush,RegWtaddr_in,RegWtaddr_out)</span>;</span><br><span class="line">    </span><br><span class="line">    dff <span class="variable">#(1) dff10(clk,en,flush,RegDst_in,RegDst_out)</span>;</span><br><span class="line">    dff <span class="variable">#(1) dff11(clk,en,flush,ALUSrcASel_in,ALUSrcASel_out)</span>;</span><br><span class="line">    dff <span class="variable">#(2) dff12(clk,en,flush,ALUSrcBSel_in,ALUSrcBSel_out)</span>;  </span><br><span class="line">    dff <span class="variable">#(5) dff13(clk,en,flush,ALUControl_in,ALUControl_out)</span>;  </span><br><span class="line">    dff <span class="variable">#(1) dff14(clk,en,flush,DMemRead_in,DMemRead_out)</span>;</span><br><span class="line">    dff <span class="variable">#(1) dff15(clk,en,flush,DMemWrite_in,DMemWrite_out)</span>;</span><br><span class="line">    dff <span class="variable">#(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out)</span>;</span><br><span class="line">    dff <span class="variable">#(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out)</span>;  </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="EXMEM-v"><a href="#EXMEM-v" class="headerlink" title="EXMEM.v"></a>EXMEM.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> EXMEM(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">     <span class="keyword">input</span> en,</span><br><span class="line">     <span class="keyword">input</span> flush,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_in,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] DMemin_in,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_in,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_out,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] DMemin_out,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_out,</span><br><span class="line">     <span class="comment">//control</span></span><br><span class="line">     <span class="keyword">input</span> DMemRead_in,</span><br><span class="line">     <span class="keyword">input</span> DMemWrite_in,</span><br><span class="line">     <span class="keyword">input</span> DMemtoReg_in,</span><br><span class="line">     <span class="keyword">input</span> RegWrite_in,</span><br><span class="line">     <span class="keyword">output</span> DMemRead_out,</span><br><span class="line">     <span class="keyword">output</span> DMemWrite_out,</span><br><span class="line">     <span class="keyword">output</span> DMemtoReg_out,</span><br><span class="line">     <span class="keyword">output</span> RegWrite_out</span><br><span class="line">    );</span><br><span class="line">     dff dff1(clk,en,flush,ALUResult_in,ALUResult_out);</span><br><span class="line">     dff dff2(clk,en,flush,DMemin_in,DMemin_out);</span><br><span class="line">     dff <span class="variable">#(5) dff3(clk,en,flush,RegWtaddr_in,RegWtaddr_out)</span>;</span><br><span class="line"></span><br><span class="line">     dff <span class="variable">#(1) dff14(clk,en,flush,DMemRead_in,DMemRead_out)</span>;</span><br><span class="line">     dff <span class="variable">#(1) dff15(clk,en,flush,DMemWrite_in,DMemWrite_out)</span>;</span><br><span class="line">     dff <span class="variable">#(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out)</span>;</span><br><span class="line">     dff <span class="variable">#(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="MEMWB-v"><a href="#MEMWB-v" class="headerlink" title="MEMWB.v"></a>MEMWB.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> MEMWB(</span><br><span class="line">     <span class="keyword">input</span> clk,</span><br><span class="line">     <span class="keyword">input</span> en,</span><br><span class="line">     <span class="keyword">input</span> flush,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_in,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] DMemout_in,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_in,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] ALUResult_out,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] DMemout_out,</span><br><span class="line">     <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_out,</span><br><span class="line">     <span class="comment">//control</span></span><br><span class="line">     <span class="keyword">input</span> DMemtoReg_in,</span><br><span class="line">     <span class="keyword">input</span> RegWrite_in,</span><br><span class="line">     <span class="keyword">output</span> DMemtoReg_out,</span><br><span class="line">     <span class="keyword">output</span> RegWrite_out</span><br><span class="line">    );</span><br><span class="line">     dff dff1(clk,en,flush,ALUResult_in,ALUResult_out);</span><br><span class="line">     dff dff2(clk,en,flush,DMemout_in,DMemout_out);</span><br><span class="line">     dff <span class="variable">#(5) dff3(clk,en,flush,RegWtaddr_in,RegWtaddr_out)</span>;</span><br><span class="line">     dff <span class="variable">#(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out)</span>;</span><br><span class="line">     dff <span class="variable">#(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out)</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="compare-v"><a href="#compare-v" class="headerlink" title="compare.v"></a>compare.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="meta-keyword">define</span> LESS 2'b00</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> EQUAL 2'b01</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">define</span> GREATER 2'b10</span></span><br><span class="line"><span class="keyword">module</span> compare(<span class="comment">//为了判断分支</span></span><br><span class="line">     <span class="keyword">input</span> <span class="keyword">signed</span> [<span class="number">31</span>:<span class="number">0</span>] a,</span><br><span class="line">     <span class="keyword">input</span> <span class="keyword">signed</span> [<span class="number">31</span>:<span class="number">0</span>] b,</span><br><span class="line">     <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] res</span><br><span class="line">    );</span><br><span class="line">     <span class="keyword">always</span> @(*)</span><br><span class="line">        <span class="keyword">if</span>(a == b) res = <span class="number">2'b01</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a &lt; b) res = <span class="number">2'b00</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(a &gt; b) res = <span class="number">2'b10</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="forward-v"><a href="#forward-v" class="headerlink" title="forward.v"></a>forward.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> forward(<span class="comment">//前推</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rs_EX,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rt_EX,</span><br><span class="line">    <span class="keyword">input</span> RegWrite_MEM,</span><br><span class="line">    <span class="keyword">input</span> RegWrite_WB,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_MEM,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_WB,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] RegRdout1Sel_Forward_EX,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] RegRdout2Sel_Forward_EX</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        RegRdout1Sel_Forward_EX[<span class="number">0</span>] = RegWrite_WB &amp;&amp; (RegWtaddr_WB != <span class="number">0</span>) &amp;&amp; (RegWtaddr_MEM != Rs_EX) &amp;&amp; (RegWtaddr_WB == Rs_EX);</span><br><span class="line">        RegRdout1Sel_Forward_EX[<span class="number">1</span>] = RegWrite_MEM &amp;&amp; (RegWtaddr_MEM != <span class="number">0</span>) &amp;&amp; (RegWtaddr_MEM == Rs_EX);</span><br><span class="line">        RegRdout2Sel_Forward_EX[<span class="number">0</span>] = RegWrite_WB &amp;&amp; (RegWtaddr_WB != <span class="number">0</span>) &amp;&amp; (RegWtaddr_MEM != Rt_EX) &amp;&amp; (RegWtaddr_WB == Rt_EX);</span><br><span class="line">        RegRdout2Sel_Forward_EX[<span class="number">1</span>] = RegWrite_MEM &amp;&amp; (RegWtaddr_MEM != <span class="number">0</span>) &amp;&amp; (RegWtaddr_MEM == Rt_EX);  </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="hazard-v"><a href="#hazard-v" class="headerlink" title="hazard.v"></a>hazard.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> hazard(<span class="comment">//上一条指令是LW指令且当前指令ID级读的是同一个寄存器,则插入bubble</span></span><br><span class="line">     <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rs_ID,</span><br><span class="line">     <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rt_ID, </span><br><span class="line">     <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] RegWtaddr_EX,</span><br><span class="line">     <span class="keyword">input</span> DMemRead_EX,</span><br><span class="line">     <span class="keyword">output</span> PCEn,</span><br><span class="line">     <span class="keyword">output</span> IF_ID_En,</span><br><span class="line">     <span class="keyword">output</span> ID_EX_Flush</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">assign</span> ID_EX_Flush = ((RegWtaddr_EX == Rs_ID) || (RegWtaddr_EX == Rt_ID)) &amp;&amp; DMemRead_EX;<span class="comment">//条件成立则为1，清空</span></span><br><span class="line">    <span class="keyword">assign</span> IF_ID_En = ~ID_EX_Flush;<span class="comment">//条件成立则为0，保持</span></span><br><span class="line">    <span class="keyword">assign</span> PCEn = ~ID_EX_Flush;<span class="comment">//条件成立则为0，保持</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="control-v"><a href="#control-v" class="headerlink" title="control.v"></a>control.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> control(</span><br><span class="line">    <span class="keyword">input</span> clk,rst,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] Op, <span class="comment">//instr[31:26]</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Rt, <span class="comment">//instr[20:16]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] Funct,<span class="comment">//instr[5:0]</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] RsCMPRt,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] RsCMPZero,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] PCSrc, <span class="comment">//0:+4,1:Branch,2:J,3:JR</span></span><br><span class="line">    <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> RegDst,<span class="comment">//0:RegWtaddr=rt,1:RegWtaddr=rd</span></span><br><span class="line">    <span class="comment">//EX</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> ALUSrcASel,<span class="comment">//0:RegRdout1,1:ShamtZeroExtended</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] ALUSrcBSel, <span class="comment">//0:RegRdout2,1:IMMSignExtended,2:IMMZeroExtended</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] ALUControl,</span><br><span class="line">    <span class="comment">//MEM</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> DMemRead,<span class="comment">//1:En</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> DMemWrite,<span class="comment">//1:En</span></span><br><span class="line">    <span class="comment">//WB</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> DMemtoReg,<span class="comment">//0:Aluout,1:DMemout</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> RegWrite<span class="comment">//1:En</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] tmpsrc;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(*)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(rst) </span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_00</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">case</span>(Op)</span><br><span class="line">            <span class="number">6'b000000</span>: <span class="comment">//R-Type</span></span><br><span class="line">                <span class="keyword">case</span>(Funct)</span><br><span class="line">                    <span class="comment">//SLL的rs rt rd shamt全0时是nop，本来nop没有对应的</span></span><br><span class="line">                    <span class="number">6'b000000</span>: <span class="comment">//SLL,注意Alu_a来自Shamt的无符号拓展,即ALUSrcASel=1，下面两个同理</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_1_00</span>&#125;,&#123;<span class="meta">`A_SLL&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="comment">//6'b000001: //MOVCI</span></span><br><span class="line">                    <span class="number">6'b000010</span>: <span class="comment">//SRL</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_1_00</span>&#125;,&#123;<span class="meta">`A_SRL&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b000011</span>: <span class="comment">//SRA</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_1_00</span>&#125;,&#123;<span class="meta">`A_SRA&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b000100</span>: <span class="comment">//SLLV，注意Alu_a来自reg[rs],即ALUSrcASel=0，下面两个同理</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SLL&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="comment">//6'b000101: //*</span></span><br><span class="line">                    <span class="number">6'b000110</span>: <span class="comment">//SRLV</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SRL&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b000111</span>: <span class="comment">//SRAV</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SRA&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b001000</span>: <span class="comment">//JR</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b11_z_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">                    <span class="comment">//6'b001001: //JALR</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="number">6'b001010</span>: <span class="comment">//MOVZ,如果 reg[rs]=0 则 reg[rd]=reg[rt],此时RsCMPZero=01,所以 RegWrite=RsCMPZero[0]</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_MOV&#125;,&#123;3'b000&#125;,&#123;RsCMPZero[0]&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b001011</span>: <span class="comment">//MOVN,如果 reg[rs]!=0 则 reg[rd]=reg[rt],此时RsCMPZero=00或10,所以 RegWrite=~RsCMPZero[0]</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_MOV&#125;,&#123;3'b000&#125;,&#123;~RsCMPZero[0]&#125;&#125;;</span></span><br><span class="line"></span><br><span class="line">                    <span class="number">6'b100000</span>: <span class="comment">//ADD</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_ADD&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100001</span>: <span class="comment">//ADDU</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_ADDU&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100010</span>: <span class="comment">//SUB</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SUB&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100011</span>: <span class="comment">//SUBU</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SUB&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100100</span>: <span class="comment">//AND</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_AND&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100101</span>: <span class="comment">//OR</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_OR&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100110</span>: <span class="comment">//XOR</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_XOR&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b100111</span>: <span class="comment">//NOR</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_NOR&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                  </span><br><span class="line">                    <span class="number">6'b101010</span>: <span class="comment">//SLT</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SLT&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                    <span class="number">6'b101011</span>: <span class="comment">//SLTU</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_1_0_00</span>&#125;,&#123;<span class="meta">`A_SLTU&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="number">6'b000001</span>: </span><br><span class="line">                <span class="keyword">case</span>(Rt)</span><br><span class="line">                    <span class="number">6'b00000</span>: <span class="comment">//BLTZ,Reg[rs]&lt;0则跳转</span></span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">if</span>(RsCMPZero == <span class="meta">`LESS) tmpsrc = 2'b01; <span class="meta-keyword">else</span> tmpsrc = 2'b00;</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="number">6'b00001</span>: <span class="comment">//BGEZ,Reg[rs]&gt;=0则跳转</span></span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">if</span>(RsCMPZero == <span class="meta">`GREATER || RsCMPZero == `EQUAL) tmpsrc = 2'b01; <span class="meta-keyword">else</span> tmpsrc = 2'b00;</span></span><br><span class="line">                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="number">6'b000010</span>: <span class="comment">//J,无条件跳转</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b10_z_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">            <span class="comment">//6'b000011: //JAL</span></span><br><span class="line">            <span class="number">6'b000100</span>: <span class="comment">//BEQ,Reg[rs]==Reg[rt]则跳转,RsCMPRt=01(==),则PCSrc=01，否则PCSrc=00(不跳转)</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;&#123;<span class="number">1'b0</span>&#125;,&#123;RsCMPRt[<span class="number">0</span>]&#125;&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b000101</span>: <span class="comment">//BNE,Reg[rs]!=Reg[rt]则跳转,RsCMPRt=00(&lt;)或10(&gt;),则PCSrc=01，否则PCSrc=00(不跳转)</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;&#123;<span class="number">1'b0</span>&#125;,&#123;~RsCMPRt[<span class="number">0</span>]&#125;&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b000110</span>: <span class="comment">//BLEZ,Reg[rs]&lt;=0则跳转</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(RsCMPZero == <span class="meta">`LESS || RsCMPZero == `EQUAL) tmpsrc = 2'b01; <span class="meta-keyword">else</span> tmpsrc = 2'b00;</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="number">6'b000111</span>: <span class="comment">//BGTZ,Reg[rs]&gt;0则跳转</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>(RsCMPZero == <span class="meta">`GREATER) tmpsrc = 2'b01; <span class="meta-keyword">else</span> tmpsrc = 2'b00;</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;<span class="number">4'bz_z_zz</span>&#125;,&#123;<span class="meta">`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="number">6'b001000</span>: <span class="comment">//ADDI,注意RegDst=0,AluBSrcSel=01(IMMSignExtended),下面三个同理</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_01</span>&#125;,&#123;<span class="meta">`A_ADD&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001001</span>: <span class="comment">//ADDIU</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_01</span>&#125;,&#123;<span class="meta">`A_ADDU&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001010</span>: <span class="comment">//SLTI</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_01</span>&#125;,&#123;<span class="meta">`A_SLT&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001011</span>: <span class="comment">//SLTIU</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_01</span>&#125;,&#123;<span class="meta">`A_SLTU&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001100</span>: <span class="comment">//ANDI,注意RegDst=0,AluBSrcSel=10(IMMZeroExtended),下面三个同理</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_10</span>&#125;,&#123;<span class="meta">`A_AND&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001101</span>: <span class="comment">//ORI</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_10</span>&#125;,&#123;<span class="meta">`A_OR&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001110</span>: <span class="comment">//XORI</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_10</span>&#125;,&#123;<span class="meta">`A_XOR&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line">            <span class="number">6'b001111</span>: <span class="comment">//LUI</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_10</span>&#125;,&#123;<span class="meta">`A_LUI&#125;,&#123;4'b0001&#125;&#125;;</span></span><br><span class="line"></span><br><span class="line">            <span class="number">6'b100011</span>: <span class="comment">//LW,注意RegDst=0(写到Reg[rt]),AluBSrcSel=01(IMMSignExtended),DMemtoReg=1(来自DMem),</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_0_0_01</span>&#125;,&#123;<span class="meta">`A_ADD&#125;,&#123;4'b1011&#125;&#125;;</span></span><br><span class="line"></span><br><span class="line">            <span class="number">6'b101011</span>: <span class="comment">//SW,注意RegDst=x(不写Reg),AluBSrcSel=01(IMMSignExtended)</span></span><br><span class="line">                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;<span class="number">6'b00_z_0_01</span>&#125;,&#123;<span class="meta">`A_ADD&#125;,&#123;4'b01z0&#125;&#125;;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>: ;</span><br><span class="line">        <span class="keyword">endcase</span>     </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="debounce-v"><a href="#debounce-v" class="headerlink" title="debounce.v"></a>debounce.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> debounce(<span class="comment">//去抖动</span></span><br><span class="line">     <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> out=<span class="number">0</span></span><br><span class="line">      </span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(in!=out)</span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    cnt=cnt+<span class="number">1</span>;</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(cnt==<span class="number">100000</span>)</span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        out=~out;</span><br><span class="line">                        cnt=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> cnt=<span class="number">0</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="seg-v"><a href="#seg-v" class="headerlink" title="seg.v"></a>seg.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> seg(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rst_n,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] data32,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] sel,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] segments</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">integer</span> clk_25=<span class="number">0</span>;<span class="comment">//4位数码管循环显示用</span></span><br><span class="line">    <span class="keyword">integer</span> clk_50000000=<span class="number">0</span>;<span class="comment">//2hz，移动显示用</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt2;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] data16;<span class="comment">//data32的16bit</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] data4;<span class="comment">//data16的4bit</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] empty;<span class="comment">//空白位</span></span><br><span class="line">    <span class="keyword">always</span>@(*)<span class="comment">//组合逻辑，控制七段数码管</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(!rst_n)</span><br><span class="line">                segments = <span class="number">7'b000_0000</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">case</span>(data4)</span><br><span class="line">                    <span class="number">0</span>: segments =       ~<span class="number">7'b011_1111</span>;<span class="comment">//0</span></span><br><span class="line">                    <span class="number">1</span>: segments =       ~<span class="number">7'b000_0110</span>;<span class="comment">//1</span></span><br><span class="line">                    <span class="number">2</span>: segments =       ~<span class="number">7'b101_1011</span>;<span class="comment">//2</span></span><br><span class="line">                    <span class="number">3</span>: segments =       ~<span class="number">7'b100_1111</span>;<span class="comment">//3</span></span><br><span class="line">                    <span class="number">4</span>: segments =       ~<span class="number">7'b110_0110</span>;<span class="comment">//4</span></span><br><span class="line">                    <span class="number">5</span>: segments =       ~<span class="number">7'b110_1101</span>;<span class="comment">//5</span></span><br><span class="line">                    <span class="number">6</span>: segments =       ~<span class="number">7'b111_1101</span>;<span class="comment">//6</span></span><br><span class="line">                    <span class="number">7</span>: segments =       ~<span class="number">7'b000_0111</span>;<span class="comment">//7</span></span><br><span class="line">                    <span class="number">8</span>: segments =       ~<span class="number">7'b111_1111</span>;<span class="comment">//8</span></span><br><span class="line">                    <span class="number">9</span>: segments =       ~<span class="number">7'b110_1111</span>;<span class="comment">//9</span></span><br><span class="line">                    <span class="number">10</span>:segments =       ~<span class="number">7'b111_0111</span>;<span class="comment">//A</span></span><br><span class="line">                    <span class="number">11</span>:segments =       ~<span class="number">7'b111_1100</span>;<span class="comment">//b</span></span><br><span class="line">                    <span class="number">12</span>:segments =       ~<span class="number">7'b011_1001</span>;<span class="comment">//C</span></span><br><span class="line">                    <span class="number">13</span>:segments =       ~<span class="number">7'b101_1110</span>;<span class="comment">//d</span></span><br><span class="line">                    <span class="number">14</span>:segments =       ~<span class="number">7'b111_1001</span>;<span class="comment">//E</span></span><br><span class="line">                    <span class="number">15</span>:segments =       ~<span class="number">7'b111_0001</span>;<span class="comment">//F</span></span><br><span class="line">                    <span class="keyword">default</span>: segments = <span class="number">7'b000_0000</span>; <span class="comment">// required</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)<span class="comment">//时序逻辑，产生位选择信号段选择信号</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">//if(!rst_n)</span></span><br><span class="line">                <span class="comment">//cnt = 2'b00;</span></span><br><span class="line">            <span class="comment">//else </span></span><br><span class="line">                <span class="keyword">if</span>(clk_25==<span class="number">400000</span>)</span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        clk_25=<span class="number">0</span>;</span><br><span class="line">                        cnt = cnt + <span class="number">2'b01</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    clk_25=clk_25+<span class="number">1</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">if</span>(clk_50000000==<span class="number">50000000</span>)<span class="comment">//</span></span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                        clk_50000000=<span class="number">0</span>;</span><br><span class="line">                        cnt2=cnt2+<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">if</span>(cnt2==<span class="number">4'b1010</span>) cnt2=<span class="number">4'b0000</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    clk_50000000=clk_50000000+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span>@(*)<span class="comment">//组合逻辑，选择当前显示段</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(cnt2)</span><br><span class="line">                <span class="number">4'b0000</span>:<span class="keyword">begin</span> data16=&#123;<span class="number">8'bzzzzzzzz</span>,data32[<span class="number">31</span>:<span class="number">24</span>]&#125;; empty=<span class="number">4'b1100</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0001</span>:<span class="keyword">begin</span> data16=&#123;<span class="number">4'bzzzz</span>,data32[<span class="number">31</span>:<span class="number">20</span>]&#125;; empty=<span class="number">4'b1000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0010</span>:<span class="keyword">begin</span> data16=data32[<span class="number">31</span>:<span class="number">16</span>]; empty=<span class="number">4'b0000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0011</span>:<span class="keyword">begin</span> data16=data32[<span class="number">27</span>:<span class="number">12</span>]; empty=<span class="number">4'b0000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0100</span>:<span class="keyword">begin</span> data16=data32[<span class="number">23</span>:<span class="number">8</span>]; empty=<span class="number">4'b0000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0101</span>:<span class="keyword">begin</span> data16=data32[<span class="number">19</span>:<span class="number">4</span>]; empty=<span class="number">4'b0000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0110</span>:<span class="keyword">begin</span> data16=data32[<span class="number">15</span>:<span class="number">0</span>]; empty=<span class="number">4'b0000</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b0111</span>:<span class="keyword">begin</span> data16=&#123;data32[<span class="number">11</span>:<span class="number">0</span>],<span class="number">4'bzzzz</span>&#125;; empty=<span class="number">4'b0001</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b1000</span>:<span class="keyword">begin</span> data16=&#123;data32[<span class="number">7</span>:<span class="number">0</span>],<span class="number">8'bzzzzzzzz</span>&#125;; empty=<span class="number">4'b0011</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="number">4'b1001</span>:<span class="keyword">begin</span> data16=&#123;data32[<span class="number">3</span>:<span class="number">0</span>],<span class="number">8'bzzzzzzzz</span>,data32[<span class="number">31</span>:<span class="number">28</span>]&#125;; empty=<span class="number">4'b0110</span>; <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">default</span>:;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">always</span>@(*)<span class="comment">//组合逻辑，选择当前显示位</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(cnt)</span><br><span class="line">                <span class="number">2'b00</span>:sel=<span class="number">4'b1110</span> | empty;</span><br><span class="line">                <span class="number">2'b01</span>:sel=<span class="number">4'b1101</span> | empty;</span><br><span class="line">                <span class="number">2'b10</span>:sel=<span class="number">4'b1011</span> | empty;</span><br><span class="line">                <span class="number">2'b11</span>:sel=<span class="number">4'b0111</span> | empty;</span><br><span class="line">                <span class="keyword">default</span>:sel=<span class="number">4'b1110</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">always</span>@(*)<span class="comment">//组合逻辑，选择当前显示位的数据</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(cnt)</span><br><span class="line">                <span class="number">2'b00</span>:data4=data16[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line">                <span class="number">2'b01</span>:data4=data16[<span class="number">7</span>:<span class="number">4</span>];</span><br><span class="line">                <span class="number">2'b10</span>:data4=data16[<span class="number">11</span>:<span class="number">8</span>];</span><br><span class="line">                <span class="number">2'b11</span>:data4=data16[<span class="number">15</span>:<span class="number">12</span>];</span><br><span class="line">                <span class="keyword">default</span>:data4=<span class="number">16'b0</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span> </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h4 id="test-v"><a href="#test-v" class="headerlink" title="test.v"></a>test.v</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> test;</span><br><span class="line">    <span class="comment">// Inputs</span></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> rst;</span><br><span class="line">    <span class="comment">// Instantiate the Unit Under Test (UUT)</span></span><br><span class="line">    top uut (</span><br><span class="line">        <span class="variable">.clk</span>(clk), </span><br><span class="line">        <span class="variable">.rst</span>(rst),</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// Initialize Inputs</span></span><br><span class="line">        clk = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        rst = <span class="number">0</span>;</span><br><span class="line">        #<span class="number">100</span>;</span><br><span class="line">        </span><br><span class="line">        rst = <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Wait 100 ns for global reset to finish</span></span><br><span class="line">        #<span class="number">100</span>;</span><br><span class="line">        clk=~clk;</span><br><span class="line">        #<span class="number">10</span>;</span><br><span class="line">        clk=~clk;</span><br><span class="line">      rst = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">forever</span> <span class="keyword">begin</span></span><br><span class="line">            #<span class="number">10</span>;</span><br><span class="line">            clk=~clk;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Add stimulus here</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/06/14/cod/lab7_Pipeline-CPU/">计算机组成原理上机实验7 流水线CPU</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Lyncien</a></p>
        <p><span>发布时间:</span>2018-06-14, 00:00:00</p>
        <p><span>最后更新:</span>2019-03-14, 20:18:35</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/06/14/cod/lab7_Pipeline-CPU/" title="计算机组成原理上机实验7 流水线CPU">https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/</a>
            <span class="copy-path" data-clipboard-text="原文: https://l-x.me/2018/06/14/cod/lab7_Pipeline-CPU/　　作者: Lyncien" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/10/12/article/USTC_Hackergame2018_8/">
                    USTCHackergame2018之&#34;我是谁&#34;
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/06/13/article/verilog_signed_and_unsigned/">
                    Verilog中的有符号数与无符号数
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#实验目的"><span class="toc-text">实验目的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设计一个MIPS指令集的CPU，"><span class="toc-text">设计一个MIPS指令集的CPU，</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、-基本要求："><span class="toc-text">1、    基本要求：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、-扩展要求"><span class="toc-text">2、    扩展要求</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验平台"><span class="toc-text">实验平台</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EDA工具为ISE14-7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6-XC6SLX16-CS324。"><span class="toc-text">EDA工具为ISE14.7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6 XC6SLX16-CS324。</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#使用部件"><span class="toc-text">使用部件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#开发板上的开关，7段数码管和按钮。"><span class="toc-text">开发板上的开关，7段数码管和按钮。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最终实现功能"><span class="toc-text">最终实现功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、实现五段流水线"><span class="toc-text">1、实现五段流水线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、实现完全转发和冒险检测"><span class="toc-text">2、实现完全转发和冒险检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、实现36条指令"><span class="toc-text">3、实现36条指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、实现下载并在数码管上动态显示内存"><span class="toc-text">4、实现下载并在数码管上动态显示内存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#详细设计过程"><span class="toc-text">详细设计过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、-MIPS指令格式"><span class="toc-text">1、    MIPS指令格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、-整体设计"><span class="toc-text">2、    整体设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-分为五个流水段IF、ID、EX、MEM、WB。"><span class="toc-text">(1)    分为五个流水段IF、ID、EX、MEM、WB。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-clk上升沿为每段的开始，每段长度为一个clk。"><span class="toc-text">(2)    clk上升沿为每段的开始，每段长度为一个clk。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。"><span class="toc-text">(3)    每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-甘特图如下"><span class="toc-text">(4)    甘特图如下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-详细数据通路图如下"><span class="toc-text">(5)详细数据通路图如下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、-各模块设计，主要有以下几个模块"><span class="toc-text">3、    各模块设计，主要有以下几个模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-alu模块——算术逻辑单元"><span class="toc-text">a)    alu模块——算术逻辑单元</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-regfile模块——寄存器文件"><span class="toc-text">b) regfile模块——寄存器文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-mux模块和mux4模块——2路和4路选择器"><span class="toc-text">c) mux模块和mux4模块——2路和4路选择器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-IP核生成的DMem模块和IMem模块——存放数据段和代码段"><span class="toc-text">d) IP核生成的DMem模块和IMem模块——存放数据段和代码段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-IFID模块——IF段和ID段之间的寄存器"><span class="toc-text">e) IFID模块——IF段和ID段之间的寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#f-IDEX模块——ID段和EX段之间的寄存器"><span class="toc-text">f) IDEX模块——ID段和EX段之间的寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#g-EXMEM模块——EX段和MEM段之间的寄存器"><span class="toc-text">g) EXMEM模块——EX段和MEM段之间的寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#h-MEMWB模块——MEM段和WB段之间的寄存器"><span class="toc-text">h) MEMWB模块——MEM段和WB段之间的寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#i-dff模块——D触发器，用于各个段寄存器"><span class="toc-text">i) dff模块——D触发器，用于各个段寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#j-compare模块——用于分支信号的判断"><span class="toc-text">j) compare模块——用于分支信号的判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#k-SignExtended模块——立即数符号扩展"><span class="toc-text">k) SignExtended模块——立即数符号扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#l-ZeroExtended模块——立即数无符号扩展"><span class="toc-text">l) ZeroExtended模块——立即数无符号扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#m-forward模块——旁路前推模块，实现转发"><span class="toc-text">m) forward模块——旁路前推模块，实现转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#n-hazard模块——冒险检测模块，实现插入气泡"><span class="toc-text">n) hazard模块——冒险检测模块，实现插入气泡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#o-control模块——产生控制信号"><span class="toc-text">o) control模块——产生控制信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#p-debounce模块——去抖动"><span class="toc-text">p) debounce模块——去抖动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#q-seg模块——7段数码管"><span class="toc-text">q) seg模块——7段数码管</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#r-top模块——实例化以上模块，连接各个信号"><span class="toc-text">r) top模块——实例化以上模块，连接各个信号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、-信号命名规则"><span class="toc-text">4、    信号命名规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）-信号名称由几个单词（或其简写）构成，每个单词首字母大写"><span class="toc-text">（1）    信号名称由几个单词（或其简写）构成，每个单词首字母大写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（2）-一般先写该信号对应的部件名，然后紧跟操作或接口名。"><span class="toc-text">（2）    一般先写该信号对应的部件名，然后紧跟操作或接口名。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（3）-如果该信号是另外一个信号的选择信号，则加上Sel后缀。"><span class="toc-text">（3）    如果该信号是另外一个信号的选择信号，则加上Sel后缀。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（4）-如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。"><span class="toc-text">（4）    如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#（5）-以上面方法命名基本不会引起混淆。"><span class="toc-text">（5）    以上面方法命名基本不会引起混淆。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5、-DMem和IMem的初始化"><span class="toc-text">5、    DMem和IMem的初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6、-测试的汇编代码"><span class="toc-text">6、    测试的汇编代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实验结果"><span class="toc-text">实验结果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#（1）仿真结果"><span class="toc-text">（1）仿真结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（2）下载结果"><span class="toc-text">（2）下载结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-text">附录:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、-编写过程中遇到问题和一些发现"><span class="toc-text">一、    编写过程中遇到问题和一些发现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、如果位拼接作为左值，单个变量也要花括号，如"><span class="toc-text">1、如果位拼接作为左值，单个变量也要花括号，如</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、”-”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“-”不成立，这是一个不好发现的问题。"><span class="toc-text">2、”==”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“==”不成立，这是一个不好发现的问题。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。"><span class="toc-text">3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。"><span class="toc-text">4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5、在clk边缘用-lt-对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）"><span class="toc-text">5、在clk边缘用&lt;=对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6、-srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现"><span class="toc-text">6、 srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#应该注意，-gt-gt-gt-是算术右移，但对于无符号数，高位仍然补0，所以需要用-signed-转为有符号数"><span class="toc-text">应该注意， &gt;&gt;&gt; 是算术右移，但对于无符号数，高位仍然补0，所以需要用$signed()转为有符号数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#这样写也不行，-gt-gt-不具有算术右移的功能"><span class="toc-text">这样写也不行，&gt;&gt;不具有算术右移的功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。"><span class="toc-text">7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、-模块源代码"><span class="toc-text">二、    模块源代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#top-v"><span class="toc-text">top.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#alu-v"><span class="toc-text">alu.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#regfile-v"><span class="toc-text">regfile.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dff-v"><span class="toc-text">dff.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mux-v"><span class="toc-text">mux.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mux4-v"><span class="toc-text">mux4.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IFID-v"><span class="toc-text">IFID.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IDEX-v"><span class="toc-text">IDEX.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXMEM-v"><span class="toc-text">EXMEM.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MEMWB-v"><span class="toc-text">MEMWB.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compare-v"><span class="toc-text">compare.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#forward-v"><span class="toc-text">forward.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hazard-v"><span class="toc-text">hazard.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#control-v"><span class="toc-text">control.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debounce-v"><span class="toc-text">debounce.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#seg-v"><span class="toc-text">seg.v</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#test-v"><span class="toc-text">test.v</span></a></li></ol></li></ol></li>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"计算机组成原理上机实验7 流水线CPU　| Lyncien's homepage　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/10/12/article/USTC_Hackergame2018_8/" title="上一篇: USTCHackergame2018之&#34;我是谁&#34;">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/06/13/article/verilog_signed_and_unsigned/" title="下一篇: Verilog中的有符号数与无符号数">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/9999/01/01/article/my_blog/">博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/pc/lab3/">并行计算上机实验三 CUDA实现向量加法和矩阵乘法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/16/pc/lab2/">并行计算上机实验二 MPI实现π值的计算和PSRS排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/04/leetcode/single-number-iv/">LeetCode题目改编——只出现一次的数字IV</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/02/pc/lab1/">并行计算上机实验一 OpenMP实现π值的计算和PSRS排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/29/article/bit_operation_tips/">C/C++ 位运算总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/02/article/Makefile/">Makefile 使用总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/25/article/pc_first_problem/">并行计算初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/21/article/dp_1-5/">动态规划入门（1）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/17/cp/lab_final/">编译原理课程实验汇报</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/10/article/tea_and_health/">茶与健康</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/09/alg/lab5/">算法基础上机实验五 图搜索BFS算法及存储优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/05/mcps/lab_res/">汇编上机资源</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/03/mcps/lab4/">汇编上机题4</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/02/alg/lab4/">算法基础上机实验四 最佳调度问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/mcps/lab3/">汇编上机题3</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/25/alg/lab3/">算法基础上机实验三 最长公共子序列问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/19/mcps/lab2/">汇编上机题2</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/18/alg/lab2/">算法基础上机实验二 红黑树维护算法及其区间树应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/12/mcps/lab1/">汇编上机题1</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/11/alg/lab1/">算法基础上机实验一 求平面上n个顶点的最近点对问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/27/article/learning_and_forgetting/">学习与遗忘</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/15/article/USTC_Hackergame2018_18/">USTC Hackergame2018 之 “加密解密算法”</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/12/article/USTC_Hackergame2018_8/">USTCHackergame2018之"我是谁"</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/14/cod/lab7_Pipeline-CPU/">计算机组成原理上机实验7 流水线CPU</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/13/article/verilog_signed_and_unsigned/">Verilog中的有符号数与无符号数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/23/os/File_System/File System/">操作系统阅读报告：大容量存储器与文件系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/10/cod/lab6_Multi-CycleCPU/">计算机组成原理上机实验6 多周期CPU</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/04/cod/lab5_SingleCycleCPU/">计算机组成原理上机实验5 单周期CPU</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/25/os/Process_Communication&Synchronization&Scheduling/Process Communication&Synchronization&Scheduling/">操作系统阅读报告：进程通信与同步、进程调度</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/19/cod/lab4_FiniteStateMachine/">计算机组成原理上机实验4 有限状态机</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/31/os/Process_Concepts&Operations,Thread/Process Concepts&Operations,Thread/">操作系统阅读报告：进程与线程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/18/os/System_Call/System Call/">操作系统阅读报告：系统调用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/11/os/OS_Summary/OS Summary/">操作系统阅读报告：操作系统概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/09/ds/lab4_ShortestPaths/">数据结构上机题4 最短路径</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/ds/lab3_Haffman/">数据结构上机题3 哈夫曼压缩</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/29/ds/lab2_Bank/">数据结构上机题2 模拟银行业务办理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/23/ds/lab1_Polynome/">数据结构上机题1 一元稀疏多项式计算</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/01/article/A_Expression_Evaluation/">C语言表达式计算器</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/14/clp/lab10b/">程序设计II上机实验10B："完美阴阳矩阵"</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/13/clp/lab10a/">程序设计II上机实验10A：杀蚂蚁</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/12/clp/lab9b/">程序设计II上机实验9B：八数码问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/clp/lab9a/">程序设计II上机实验9A：算24</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2020 Lyncien
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
		
		
			<!-- Highlight.js -->
			<!-- "//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css" -->
			<!-- "http://apps.bdimg.com/libs/highlight.js/9.1.0/styles/default.min.css" -->
			<link rel="stylesheet" href="/js/highlight/styles/vs2015.css">
			<script src="/js/highlight/highlight.pack.js"></script>
			<script>
					hljs.initHighlightingOnLoad();
			</script>
		
		
		
			<div id="clustrmaps-widget"></div> <a href="https://clustrmaps.com/site/1b46r" title="Visit tracker"></a>
		
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>