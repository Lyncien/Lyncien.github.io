<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Lyncien's blog">
	<title>Lyncien's blog</title>

	
<script>
	config = { root: '/' };
</script>
		
	 

	 
	<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"> 
	<link rel="preload" href="/css/blog.css" as="style">
	<link rel="preload" href="/js/main.js" as="script">
	<link rel="preload" href="/js/background.js" as="script">
	<link rel="preload" href="/js/particles.js" as="script">
	<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.9.2/mermaid.min.js" as="script">
	<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" as="script">
	<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" as="script">

	 
	<!-- <link rel="prefetch" href="/img/bg1.webp">
	<link rel="prefetch" href="/img/bg2.webp">
	<link rel="prefetch" href="/img/bg3.webp">
	<link rel="prefetch" href="/img/bg4.webp">
	<link rel="prefetch" href="/search.json" as="fetch" type="application/json" crossorigin> -->


	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script> -->

	<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->

	
<link rel="stylesheet" href="/css/blog.css">

	
<link rel="stylesheet" href="/css/input.css">

	
<script src="/js/background.js" async></script>


	
	<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/vs2015.min.css" rel="stylesheet">   -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" defer></script>
	<!-- <script>hljs.initHighlightingOnLoad();</script> -->
	

	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML" defer></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			showProcessingMessages: false, //关闭js加载过程信息
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']], //行内公式选择符
				displayMath: [["$$", "$$"], ["\\[", "\\]"]], //段内公式选择符
				skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //避开某些标签
			}
		});
	</script>	
	

	

	 

<meta name="generator" content="Hexo 5.4.0"></head>
<body>
	<canvas id="background-canvas"></canvas>
	
<script src="/js/particles.js" async></script>

	<svg style="position: absolute; width: 0px; height: 0px; overflow: hidden;">
	<symbol id="icon-douban" viewBox="0 0 1024 1024">
		<path d="M1023.979 862.827A161.152 161.152 0 0 1 862.805 1024H161.173A161.152 161.152 0 0 1 0 862.827V161.195A161.195 161.195 0 0 1 161.173 0.02h701.632a161.195 161.195 0 0 1 161.174 161.174v701.632z" fill="#05B711"></path>
		<path d="M218.56 208.064h586.816v66.09H218.56z m535.83 393.493v-258.41h-484.8v258.41h484.8zM339.882 409.173H684.8v126.358H339.883V409.173z m309.61 341.334c21.099-32.299 41.003-69.739 59.435-112.256l-70.507-25.707c-18.346 50.368-39.701 96.427-64 137.941H451.712c-20.373-53.802-43.328-99.818-69.077-137.941l-64.854 25.707c26.752 40.128 48.32 77.482 64.854 112.256H201.94v65.386h620.054v-65.386H649.493z" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-linkedin" viewBox="0 0 1024 1024">
		<path d="M948.245 0H75.52C33.877 0 0.021 33.067 0.021 73.813v876.288C0 990.891 33.877 1024 75.52 1024h872.704c41.75 0 75.733-33.11 75.733-73.899V73.835C1024 33.045 989.995 0 948.267 0z" fill="#007BB5"></path>
		<path d="M151.744 383.893h152.021v488.64H151.744v-488.64z m76.053-242.922a88.107 88.107 0 1 1-0.128 176.17 88.107 88.107 0 0 1 0.128-176.17M399.04 383.893h145.579v66.795h2.09c20.267-38.4 69.803-78.933 143.702-78.933 153.77 0 182.186 101.184 182.186 232.81v267.968h-151.85V634.88c0-56.661-0.982-129.557-78.934-129.557-79.018 0-91.093 61.76-91.093 125.525v241.707H399.04V383.872z" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-email" viewBox="0 0 1586 1024">
		<path d="M160.587 1019.543h1261.327a145.569 145.569 0 0 0 145.549-145.529V146.291A145.528 145.528 0 0 0 1421.914 0.803H160.587A145.569 145.569 0 0 0 15.06 146.312v727.702a145.589 145.589 0 0 0 145.528 145.549z" fill="#F4B459"></path>
		<path d="M63.85 981.956L670.94 514.77 65.176 37.205c-30.48 26.705-50.116 65.396-50.116 109.107v727.702c0 43.028 19.074 81.318 48.79 107.962zM1518.37 38.049L888.832 516.116l628.957 466.563c30.278-26.644 49.694-65.255 49.694-108.685V146.332c0-43.21-19.215-81.6-49.092-108.283z" fill="#E8AB54"></path>
		<path d="M1548.248 944.971l-530.151-424.197L1554.593 86.88a145.669 145.669 0 0 0-55.738-63.688L813.578 571.37l-703.83-560.99a145.609 145.609 0 0 0-69.39 54.09L607.03 518.988 47.666 964.668a144.946 144.946 0 0 0 75.214 49.293l554.165-438.312 33.812 27.266a142.436 142.436 0 0 0 205.603 0l31.483-25.46 538.423 426.366a145.087 145.087 0 0 0 61.862-58.83z" fill="#FADAAC"></path>
	</symbol>
	<symbol id="icon-dingtalk" viewBox="0 0 1024 1024">
		<path d="M908.474 381.92c-1.767 7.47-6.128 18.419-12.246 31.624h0.132l-0.7 1.223c-35.695 76.492-128.894 226.512-128.894 226.512s-0.119-0.354-0.486-0.938l-27.235 47.485h131.254L619.61 1021.705l56.903-227.129H573.236l35.886-150.19c-29.033 7.011-63.35 16.654-103.993 29.74 0 0-54.982 32.249-158.382-62.037 0 0-69.736-61.533-29.304-76.909 17.196-6.538 83.49-14.832 135.645-21.894 70.487-9.543 113.848-14.596 113.848-14.596s-217.316 3.255-268.87-4.866c-51.557-8.12-116.959-94.275-130.89-170.019 0 0-21.547-41.58 46.334-21.894s348.855 76.632 348.855 76.632-365.423-112.204-389.74-139.578c-24.312-27.374-71.557-149.423-65.41-224.42 0 0 2.665-18.698 21.804-13.687 0 0 270.149 123.64 454.875 191.323 184.724 67.683 345.33 102.108 324.58 189.739z" fill="#3296FA"></path>
	</symbol>
	<symbol id="icon-facebook" viewBox="0 0 1024 1024">
		<path d="M981.333 1024A42.667 42.667 0 0 0 1024 981.333V42.667A42.667 42.667 0 0 0 981.333 0H42.667A42.667 42.667 0 0 0 0 42.667v938.666A42.667 42.667 0 0 0 42.667 1024h938.666z" fill="#39579A"></path>
		<path d="M544.427 1024V618.667H405.333V469.333h139.094v-110.4c0-132.266 80.768-204.266 198.741-204.266 56.533 0 105.088 4.202 119.253 6.08v138.24l-81.834 0.021c-64.171 0-76.587 30.507-76.587 75.243v95.082h149.333L832 618.667H704V1024H544.427z" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-csdn" viewBox="0 0 1024 1024">
		<path d="M229.12 841.92c-170.88-237.76-46.4-629.12 236.16-716.8 118.4-38.08 262.72-16.96 351.36 74.24 48.64 43.2 1.28 102.4-24.96 141.76-81.92-62.4-179.2-143.04-289.92-102.08C303.36 310.4 232 593.28 338.24 764.8c128 141.44 358.08 94.08 488.64-20.48 42.88 37.12 88.96 112.32 24.64 153.92-182.4 120.96-474.24 120-622.4-56.32z" fill="#D81E06"></path>
	</symbol>
	<symbol id="icon-github" viewBox="0 0 1024 1024">
		<path d="M855.557 216.855c35.621-66.153-5.089-152.661-5.089-152.661-91.597 0-157.75 61.064-157.75 61.064-35.621-20.355-152.661-20.355-152.661-20.355s-117.04 0-152.661 20.355c0 0-66.153-61.064-157.75-61.064 0 0-40.71 86.508-5.089 152.661 0 0-81.419 76.331-50.887 239.169 28.691 153.018 162.838 193.371 249.346 193.371 0 0-35.621 30.532-30.532 81.419 0 0-50.887 30.532-101.774 10.177s-76.331-71.242-76.331-71.242-50.887-66.153-101.774-40.71c0 0-15.266 15.266 40.71 40.71 0 0 40.71 61.064 55.976 96.685 15.266 35.621 96.685 66.153 178.105 45.798v117.04s0 10.177-20.355 15.266-20.355 15.266-10.177 15.266H723.25c10.177 0 10.177-10.177-10.177-15.266-20.355-5.089-20.355-15.266-20.355-15.266v-117.04s0.447-61.03 0-81.419c-1.119-51.128-35.621-81.419-35.621-81.419 86.508 0 220.655-40.353 249.346-193.371 30.533-162.837-50.886-239.168-50.886-239.168z" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-wechat" viewBox="0 0 1025 1024">
		<path d="M1024.16 694.816c0-149.92-143.104-271.392-319.584-271.392-176.576 0-319.68 121.504-319.68 271.392S528 966.208 704.576 966.208c55.456 0 107.648-12.096 153.184-33.248l125.984 54.528-14.592-140.544c34.784-43.392 55.04-95.808 55.04-152.128zM596.832 621.28c-25.152 0-45.472-20.352-45.472-45.472s20.32-45.472 45.472-45.472c25.12 0 45.44 20.384 45.44 45.472s-20.384 45.472-45.44 45.472z m215.392 0c-25.056 0-45.44-20.352-45.44-45.472s20.384-45.472 45.44-45.472c25.184 0 45.536 20.384 45.536 45.472s-20.352 45.472-45.536 45.472zM704.576 387.488c49.376 0 96.416 8.8 139.264 24.64 0.32-5.728 0.992-11.232 0.992-16.992 0-198.08-189.152-358.624-422.432-358.624C189.184 36.512 0.032 197.024 0.032 395.136c0 74.496 26.816 143.776 72.704 201.12L53.472 781.92l166.432-72.096c41.216 19.2 86.784 32.16 134.88 38.784-3.616-17.504-5.824-35.424-5.824-53.792 0.032-169.44 159.552-307.296 355.616-307.296z m-139.808-209.6c33.184 0 60 26.88 60 60 0 33.184-26.816 60.064-60 60.064s-60.032-26.88-60.032-60.064c0-33.152 26.88-60 60.032-60zM280.032 297.952c-33.184 0-60-26.88-60-60.064 0-33.152 26.848-60 60-60 33.184 0 60.032 26.88 60.032 60s-26.88 60.064-60.032 60.064z" fill="#51C332"></path>
	</symbol>
	<symbol id="icon-twitter" viewBox="0 0 1024 1024">
		<path d="M962.267 233.18q-38.253 56.027-92.598 95.45 0.585 7.973 0.585 23.992 0 74.313-21.724 148.26t-65.975 141.97-105.398 120.32T529.7 846.63t-184.54 31.158q-154.843 0-283.428-82.87 19.968 2.267 44.544 2.267 128.585 0 229.156-78.848-59.977-1.17-107.447-36.864t-65.17-91.136q18.87 2.853 34.89 2.853 24.575 0 48.566-6.29-64-13.166-105.984-63.708T98.304 405.797v-2.268q38.839 21.724 83.456 23.406-37.742-25.161-59.977-65.682t-22.309-87.991q0-50.323 25.161-93.111 69.12 85.138 168.302 136.265t212.26 56.832q-4.534-21.723-4.534-42.277 0-76.58 53.98-130.56t130.56-53.979q80.018 0 134.875 58.295 62.317-11.996 117.175-44.544-21.139 65.682-81.116 101.742 53.175-5.706 106.277-28.6z" fill="#00ACED"></path>
	</symbol>
	<symbol id="icon-yuque" viewBox="0 0 1024 1024">
		<path d="M228.7 643.9c-0.1 0.1-0.2 0.3-0.3 0.4 3.9-4.4 8-9 12-13.5-7.5 8.4-11.7 13.1-11.7 13.1z" fill="#1590E9"></path>
		<path d="M894 298.1l25.6-15.1c10.4-6.1 9.1-21.5-2.1-25.9l-12.3-4.8c-18-7.1-34.2-18.2-46.7-33-15.7-18.5-44.7-45.1-90.9-60.8-52.7-18-142.9-14.4-193.2-10.5-15.9 1.2-25 18.4-17.4 32.5 42.6 78.6 16.7 114.3-5.7 140.7-34.3 40.4-97.4 112.2-160.7 183.6 21.9-24.5 41.8-46.8 58.1-65.1 36.4-40.8 91.3-61.5 145.1-51.7 171.5 31.3 191 253.4-9.2 385.6 26.1-1.4 52.6-3.3 79.2-6 252.6-26 272.6-232.1 218-333.9-19.4-36.1-22.2-60.5-20.1-83.9 2-21.5 13.8-40.8 32.3-51.7z" fill="#99C236"></path>
		<path d="M212.8 704.5C241.1 672.9 316 589 390.7 504.7c-54.6 61.2-121.8 136.7-177.9 199.8z" fill="#1590E9"></path>
		<path d="M216.3 758.6c-19.5-2.5-28.2-25.6-15.5-40.6-51.7 58.3-91.7 103.5-99.1 112.6-24.1 29.5 247.7 97.9 482.6-56.8 0.1-0.1 0.3-0.2 0.4-0.3-156.5 8.2-298.5-5.9-368.4-14.9z" fill="#CAC134"></path>
		<path d="M593.9 387.9c-53.8-9.8-108.7 10.9-145.1 51.7-16.3 18.2-36.2 40.5-58.1 65.1C316 589 241.1 672.9 212.8 704.5c-4.1 4.6-8.1 9.1-12 13.5-12.7 14.9-4 38 15.5 40.6 69.9 9 211.9 23.1 368.3 15 200.2-132.3 180.8-354.4 9.3-385.7z" fill="#029F40"></path>
	</symbol>
	<symbol id="icon-tianya" viewBox="0 0 1024 1024">
		<path d="M199.111 85.333c-47.132 0-85.333 38.201-85.333 85.334S151.978 256 199.11 256s85.333-38.2 85.333-85.333-38.2-85.334-85.333-85.334z m0 256c-47.132 0-85.333 38.201-85.333 85.334S151.978 512 199.11 512s85.333-38.2 85.333-85.333-38.2-85.334-85.333-85.334z m-85.333 597.334L256 853.333v-256H113.778v341.334zM910.222 85.333H369.778c-26.652 0-28.445 28.445-28.445 28.445v824.889l113.778-85.334V170.667h455.111V85.333z m-170.666 768V711.111h142.222v-56.889H739.556V568.89h170.666v-85.333H739.556V369.778h142.222v-56.89H739.556V256H625.778v56.889H483.556v56.889h142.222v113.778H483.556v85.333h142.222v85.333H483.556v56.89h142.222v142.221H483.556v56.89h455.11v-56.89h-199.11z" fill="#08E2FF"></path>
	</symbol>
	<symbol id="icon-qq" viewBox="0 0 1024 1024">
		<path d="M511.037 986.94c-85.502 0-163.986-26.686-214.517-66.544-25.66 7.149-58.486 18.655-79.202 32.921-17.725 12.202-15.516 24.647-12.32 29.67 14.027 22.069 240.622 14.092 306.04 7.219v-3.265z" fill="#FAAD08"></path>
		<path d="M495.627 986.94c85.501 0 163.986-26.686 214.518-66.544 25.66 7.149 58.485 18.655 79.203 32.921 17.724 12.202 15.512 24.647 12.32 29.67-14.027 22.069-240.623 14.092-306.042 7.219v-3.265z" fill="#FAAD08"></path>
		<path d="M496.137 472.026c140.73-0.935 253.514-27.502 291.73-37.696 9.11-2.432 13.984-6.789 13.984-6.789 0.032-1.25 0.578-22.348 0.578-33.232 0-183.287-88.695-367.458-306.812-367.47C277.5 26.851 188.8 211.021 188.8 394.31c0 10.884 0.55 31.982 0.583 33.232 0 0 3.965 4.076 11.231 6.048 35.283 9.579 150.19 37.482 294.485 38.437h1.037z m387.364 154.941c-8.66-27.825-20.484-60.273-32.455-91.434 0 0-6.886-0.848-10.366 0.158-107.424 31.152-237.624 51.006-336.845 49.808h-1.026c-98.664 1.186-227.982-18.44-335.044-49.288-4.09-1.176-12.168-0.677-12.168-0.677-11.97 31.16-23.793 63.608-32.453 91.433-41.3 132.679-27.92 187.587-17.731 188.818 21.862 2.638 85.099-99.88 85.099-99.88 0 104.17 94.212 264.125 309.947 265.596a765.877 765.877 0 0 1 5.725 0c215.738-1.471 309.947-161.424 309.947-265.595 0 0 63.236 102.519 85.102 99.88 10.186-1.231 23.566-56.14-17.732-188.819"></path>
		<path d="M429.208 303.911c-29.76 1.323-55.195-32.113-56.79-74.62-1.618-42.535 21.183-78.087 50.95-79.417 29.732-1.305 55.149 32.116 56.765 74.64 1.629 42.535-21.177 78.08-50.925 79.397m220.448-74.62c-1.593 42.507-27.03 75.941-56.79 74.62-29.746-1.32-52.553-36.862-50.924-79.397 1.614-42.526 27.03-75.948 56.764-74.639 29.77 1.33 52.57 36.881 50.951 79.417" fill="#FFFFFF"></path>
		<path d="M695.405 359.069c-7.81-18.783-86.466-39.709-183.843-39.709h-1.045c-97.376 0-176.033 20.926-183.842 39.709a6.66 6.66 0 0 0-0.57 2.672c0 1.353 0.418 2.575 1.072 3.612 6.58 10.416 93.924 61.885 183.341 61.885h1.045c89.416 0 176.758-51.466 183.34-61.883a6.775 6.775 0 0 0 1.069-3.622 6.66 6.66 0 0 0-0.567-2.664" fill="#FAAD08"></path>
		<path d="M464.674 239.335c1.344 16.946-7.87 32-20.55 33.645-12.701 1.647-24.074-10.755-25.426-27.71-1.326-16.954 7.873-32.008 20.534-33.64 12.722-1.652 24.114 10.76 25.442 27.705m77.97 8.464c2.702-4.392 21.149-27.488 59.328-19.078 10.028 2.208 14.667 5.457 15.646 6.737 1.445 1.888 1.84 4.576 0.375 8.196-2.903 7.174-8.894 6.979-12.217 5.575-2.144-0.907-28.736-16.948-53.232 6.99-1.685 1.648-4.7 2.212-7.558 0.258-2.856-1.956-4.038-5.923-2.342-8.678"></path>
		<path d="M503.821 589.328h-1.031c-67.806 0.802-150.022-8.004-229.638-23.381-6.817 38.68-10.934 87.294-7.399 145.275 8.928 146.543 97.728 238.652 234.793 239.996h5.57c137.065-1.344 225.865-93.453 234.796-239.996 3.535-57.986-0.584-106.6-7.403-145.283-79.631 15.385-161.861 24.196-229.688 23.389" fill="#FFFFFF"></path>
		<path d="M310.693 581.35v146.633s69.287 13.552 138.7 4.17V596.897c-43.974-2.413-91.4-7.79-138.7-15.546" fill="#EB1C26"></path>
		<path d="M806.504 427.238s-130.112 43.08-302.66 44.309h-1.025c-172.264-1.224-302.217-44.161-302.66-44.309L156.58 541.321c108.998 34.464 244.093 56.677 346.238 55.387l1.024-0.002c102.152 1.297 237.226-20.917 346.24-55.385l-43.579-114.083z" fill="#EB1C26"></path>
	</symbol>
	<symbol id="icon-zhihu" viewBox="0 0 1024 1024">
		<path d="M539.101 769.844l-76.117 48.43-96.094-151.063c-19.842 63.221-52.85 120.174-96.455 172.482-18.128 21.78-36.977 41.396-58.667 62.004-6.99 6.629-34.947 32.332-39.592 36.976l-63.762-63.762c6.268-6.268 35.489-33.143 41.26-38.6 19.391-18.398 35.85-35.623 51.497-54.382 57.089-68.452 91.54-144.75 96.365-235.884H117.749V455.86h180.373V275.485h-39.14c-31.07 57.089-70.256 100.198-118.055 128.832l-46.356-77.29c62.905-37.788 109.351-117.423 136.993-241.7l88.023 19.57c-6.313 28.544-13.664 55.33-22.051 80.402h203.506v90.186H388.31V455.86h112.733v90.186h-104.39l142.45 223.799z m173.068-3.157l50.325-40.268h76.749V275.485H658.869V726.42h33.189l20.111 40.268zM568.682 185.3H929.43v631.307H794.15l-112.733 90.186-45.094-90.186h-67.64V185.299z" fill="#0E87EA"></path>
	</symbol>
	<symbol id="icon-pixiv" viewBox="0 0 1024 1024">
		<path d="M701.515 301.152c-44.44-46.092-100.245-64.919-163.08-65.107-29.552-0.089-58.595 4.617-87.095 12.455-28.961 7.965-56.673 18.839-81.996 35.306-3.347 2.176-4.69 4.686-4.695 8.694-0.034 29.713-0.333 59.424-0.426 89.137-0.085 27.263-0.018 54.527-0.021 81.79-0.004 56.836 0.053 113.674-0.097 170.51-0.015 5.326 1.57 8.393 6.639 10.576 17.881 7.7 36.245 13.85 55.161 18.37 30.808 7.36 62.082 10.876 93.715 12.36 33.75 1.583 66.83-1.28 98.832-12.378 61.328-21.265 105.46-61.217 129.447-121.99 15.492-39.25 17.417-80.058 10.877-121.393-7.146-45.173-25.384-85.268-57.26-118.33z" fill="#0074AA"></path>
		<path d="M512 17.482C238.886 17.482 17.482 238.886 17.482 512S238.886 1006.518 512 1006.518 1006.518 785.114 1006.518 512 785.114 17.482 512 17.482z m327.127 530.516c-18.962 47.58-50.687 84.816-92.709 113.517-43.734 29.872-92.452 46.554-144.647 53.74-66.355 9.136-131.115 0.236-195.108-17.307-12.485-3.423-24.767-7.483-37.009-11.676-4.732-1.62-5.413-1.201-5.42 3.878-0.049 33.583 0.004 67.165-0.069 100.748-0.008 3.782 1.314 5.86 5.093 7.004 7.233 2.187 14.26 5.003 20.384 9.602 3.594 2.699 6.19 5.968 5.824 10.873-0.43 5.752-3.64 8.957-9.432 8.968-19.872 0.039-39.744 0.014-59.617 0.014-19.41 0.006-38.82-0.103-58.23 0.082-4.736 0.045-8.025-1.288-9.814-5.842-1.798-4.575-0.752-8.45 2.566-11.847 5.698-5.833 13.181-8.404 20.593-11 7.625-2.668 7.8-0.933 7.8-10.86-0.02-151.738-0.02-303.476-0.076-455.215-0.001-2.353 1.227-5.726-1.09-6.829-2.297-1.094-4.167 1.976-6 3.442-22.584 18.058-43.474 37.783-60.052 61.694-0.527 0.76-1.03 1.537-1.588 2.273-5.878 7.727-9.827 15.6-5.76 25.855 1.946 4.91 1.707 10.59 0.282 15.968-0.937 3.532-2.436 6.64-5.44 8.865-5.016 3.718-8.469 3.16-11.788-2.085-12.847-20.308-25.59-40.682-38.532-60.928-2.117-3.313-1.999-5.634 0.715-8.492 17.758-18.692 37.058-35.675 57.256-51.635 51.148-40.413 106.911-72.725 168.335-94.902 40.036-14.455 81.234-23.72 123.709-27.312 49.596-4.194 98.488-0.765 146.365 13.295 50.8 14.919 95.584 40.146 131.966 79.103 36.324 38.896 58.162 84.856 65.163 137.62 5.425 40.866 1.694 80.839-13.67 119.389z" fill="#0074AA"></path>
	</symbol>
	<symbol id="icon-juejin" viewBox="0 0 1024 1024">
		<path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z" fill="#006CFF"></path>
		<path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z" fill="#006CFF"></path>
	</symbol>
	<symbol id="icon-rss" viewBox="0 0 1024 1024">
		<path d="M42.667 810.667a128 128 0 1 0 256 0 128 128 0 1 0-256 0zM938.667 938.667H768c0-399.958-325.376-725.334-725.333-725.334V42.667c494.037 0 896 401.92 896 896z" fill="#FF6600"></path>
		<path d="M640 938.667H469.333C469.333 703.403 277.91 512 42.667 512V341.333C372.053 341.333 640 609.28 640 938.667z" fill="#FF6600"></path>
	</symbol>
	<symbol id="icon-jianshu" viewBox="0 0 1024 1024">
		<path d="M654.791 38.495h-286.53c-95.005 0-142.412 0-193.612 16.118-55.94 20.48-99.935 64.474-120.225 120.226-16.308 51.2-16.308 98.607-16.308 193.611v286.53c0 95.005 0 142.602 16.118 193.613 20.29 55.75 64.285 99.745 120.036 120.035 51.2 16.119 98.607 16.119 193.611 16.119h286.53c95.005 0 142.413 0 193.613-16.119 55.75-20.29 99.745-64.284 120.225-120.035 16.118-51.2 16.118-98.608 16.118-193.612V368.45c0-95.005 0-142.412-16.118-193.612-20.29-55.752-64.285-99.746-120.225-120.226-50.821-16.118-98.228-16.118-193.233-16.118z m0 0" fill="#EA6F5A"></path>
		<path d="M235.52 456.818h70.732v370.346H235.52V456.818z m40.012-112.45c17.825 32.995 29.203 65.8 34.512 98.796h77.18c-10.62-42.097-23.894-74.903-39.823-98.797h-71.87z m0 0" fill="#FFFFFF"></path>
		<path d="M427.804 278.566h85.144v-46.649H358.59c1.706-3.603 4.361-10.05 7.964-19.153 1.707-7.395 3.603-12.705 5.31-16.497H292.03c-12.326 49.303-40.77 85.902-85.144 109.795v46.65c58.595-14.602 100.124-39.254 124.966-73.956H358.4c8.913 23.703 14.222 46.648 15.929 68.645h74.524c-5.12-25.79-12.326-48.734-21.049-68.835z m-34.702 148.1h320.664v301.701c1.707 27.497-10.62 40.202-37.167 38.306h-43.995v54.803h63.906c62.009 1.896 92.16-26.549 90.453-85.144V371.864h-393.86v54.803z m0 0" fill="#FFFFFF"></path>
		<path d="M643.224 476.16H382.483v277.049H563.39c56.699 1.896 83.437-25.6 79.834-82.3V476.16z m-188.871 49.304h117.001v63.146H454.353v-63.146z m82.488 178.252h-82.488v-68.457h117.001v32.996c1.707 25.41-9.671 37.357-34.513 35.46zM645.88 229.262c0-1.896 0.948-4.55 2.654-8.154l7.965-24.652h-79.834c-12.516 51.2-39.823 89.695-82.49 115.295v43.805c54.993-14.602 96.712-40.202 124.967-76.8h37.167c8.913 23.703 14.222 46.648 15.929 68.645h71.87c-1.707-18.204-8.913-41.15-21.239-68.645h93.108v-49.304H645.88z m0 0" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-weibo" viewBox="0 0 1024 1024">
		<path d="M382.48 698.688c-8.66 0.277-16.34 7.787-17.514 16.939-1.088 9.088 4.821 16.384 13.546 16.256 8.875-0.15 16.896-7.872 18.027-17.174 0.917-9.28-5.397-16.512-14.059-16.021z m-58.944 10.41c-26.666 1.26-50.816 24.513-54.293 52.566-3.627 28.224 15.168 50.859 42.027 50.39 27.242-0.427 52.352-24.3 55.68-53.1 2.986-28.863-16.363-50.986-43.414-49.855z" fill="#FFFFFF"></path>
		<path d="M766.46 673.685c-12.204-127.594-183.852-215.53-383.404-196.437-199.552 19.093-351.424 137.984-339.22 265.6C56.058 870.443 227.706 958.4 427.258 939.307c199.552-19.115 351.424-138.006 339.2-265.622z m-251.137 49.451c-9.067 83.03-89.237 151.339-175.85 150.976-83.606-0.32-139.563-64.981-127.809-142.997 11.542-76.523 84.48-140.886 165.718-145.238 84.053-4.693 147.008 55.979 137.941 137.259z" fill="#FFFFFF"></path>
		<path d="M1022.096 313.877C988.411 125.653 838.758 50.091 735.056 42.88c-19.498-1.877-37.61 9.877-40.298 28.715-2.582 18.325 10.538 36.565 28.714 40.298 67.84 14.976 196.203 34.731 230.166 225.75 2.965 19.37 18.922 40.021 43.05 34.773 17.664-3.904 33.451-13.717 25.408-58.539zM720.38 261.291a24.363 24.363 0 0 0-27.499 17.45c-3.946 13.142 3.328 28.182 16.683 30.976 28.373 5.931 42.261 25.494 46.379 46.358 0 0 3.626 14.144 17.258 18.048 13.334 3.818 37.42-6.038 30.486-32.299-6.89-35.733-42.41-74.112-83.307-80.533z" fill="#E79014"></path>
		<path d="M737.638 160.427c-29.782-5.142-43.414 16.213-43.414 33.258 0 17.024 12.16 29.312 34.603 35.563 59.605 16.533 97.877 42.667 108.373 111.68 3.051 20.032 21.355 30.72 34.646 30.72 17.941 0 32.47-14.55 32.47-32.47 0-0.66-0.065-1.322-0.108-1.962l0.171-0.043c-11.35-88.533-77.696-161.365-166.741-176.746z" fill="#E79014"></path>
		<path d="M731.6 697.472c-11.968 124.053-188.842 223.381-380.65 218.496-177.75-4.395-296.192-97.984-276.566-206.57C93.52 603.924 238.8 512.767 409.68 502.677c183.552-10.817 333.59 74.58 321.92 194.794z m-27.968-198.805c-7.082 0.192-10.069 1.024-11.136-1.515-0.874-2.07 0.171-4.33 3.99-13.973 10.645-26.859 27.562-82.07-7.232-112.875-22.955-20.33-120.15-35.84-222.57 35.2-5.1 3.541-13.377 11.093-17.558 9.707-4.608-1.558-5.59-6.528-6.208-15.915-3.35-50.603 39.21-191.232-70.57-179.563-116.694 19.755-274.134 204.16-319.126 293.355-159.68 316.459 71.232 445.397 297.11 452.139 245.055 7.232 493.311-131.904 525.951-318.038 21.781-124.245-124.48-149.589-172.65-148.522z" fill="#D62629"></path>
		<path d="M377.382 585.877c-81.238 4.374-154.176 68.715-165.718 145.238-11.733 78.016 44.203 142.677 127.808 142.997 86.614 0.363 166.784-67.947 175.851-150.976 9.067-81.28-53.888-141.952-137.941-137.259zM366.95 758.955c-3.328 28.8-28.438 52.65-55.68 53.098-26.88 0.47-45.675-22.165-42.027-50.389 3.477-28.053 27.627-51.307 54.293-52.565 27.051-1.131 46.4 20.992 43.414 49.856z m11.562-27.094c-8.704 0.128-14.613-7.168-13.546-16.256 1.173-9.13 8.853-16.661 17.514-16.938 8.64-0.491 14.976 6.741 14.06 16-1.132 9.322-9.153 17.045-18.028 17.194z" fill="#030000"></path>
	</symbol>
	<symbol id="icon-momo" viewBox="0 0 1024 1024">
		<path d="M840.9 204.2c-2.7-2.8-5.4-5.6-8.1-8.3C747.6 110.8 634.6 64 514.3 64h-3.2c-121.5 0.9-235.1 49.3-319.9 136.5-81.8 84.1-126.9 195.6-127 313.8 0 118.2 45 229.7 126.7 313.9 2.8 2.9 5.6 5.7 8.4 8.4C280.5 916 390.8 960 506 960c10.5 0 21.1-0.4 31.7-1.1L847 937.2l-7-99.7 97.1 6.8 21.5-306.4c8.8-124.1-34.2-245.7-117.7-333.7z m16.7 326.6l-21.5 305.6-305.5 21.5c-97.7 6.8-192.5-27.3-260.4-93.6-2.2-2.1-4.4-4.3-6.5-6.5-130.3-134.2-130.3-352.4 0.2-486.5 65.7-67.6 153.8-105.2 248-105.8h2.5c93.3 0 180.8 36.3 246.8 102.3 2.1 2.1 4.2 4.3 6.3 6.5 64 67.1 96.8 160.7 90.1 256.5zM378.9 388.4c-30.9 0-56 24.3-56 54.2v81.5c0 29.9 25.1 54.2 56 54.2 30.8 0 56-24.3 56-54.2v-81.5c-0.1-29.8-25.2-54.2-56-54.2z m223.3 0c-30.8 0-56 24.3-56 54.2v81.5c0 29.9 25.1 54.2 56 54.2 30.8 0 55.9-24.3 55.9-54.2v-81.5c0-29.8-25.1-54.2-55.9-54.2z" fill="#9D39F1"></path>
	</symbol>
	<symbol id="icon-tieba" viewBox="0 0 1024 1024">
		<path d="M1024 862.827A161.152 161.152 0 0 1 862.827 1024H161.195A161.152 161.152 0 0 1 0.02 862.827V161.195A161.195 161.195 0 0 1 161.195 0.02h701.632A161.195 161.195 0 0 1 1024 161.195v701.632z" fill="#306FB6"></path>
		<path d="M828.843 250.261H655.38V213.74a17.067 17.067 0 0 0-17.066-17.067h-41.942a17.045 17.045 0 0 0-17.045 17.067v263.296h-24.896a17.067 17.067 0 0 0-17.045 17.066V810.22a17.067 17.067 0 0 0 17.045 17.088h257.365a17.067 17.067 0 0 0 17.067-17.088v-58.987h-0.256V553.088h0.256v-58.987a17.067 17.067 0 0 0-17.067-17.066H655.381v-150.72h173.462a17.067 17.067 0 0 0 17.066-17.067v-41.941a17.067 17.067 0 0 0-17.066-17.046zM735.467 553.11c9.429 0 17.045 7.638 17.045 17.067v164.01a17.067 17.067 0 0 1-17.045 17.067H630.485a17.045 17.045 0 0 1-17.045-17.066V570.176a17.067 17.067 0 0 1 17.045-17.067h104.982zM197.909 657.408h41.942a17.088 17.088 0 0 0 17.088-17.088V281.579h174.528V640.32a17.067 17.067 0 0 0 17.045 17.088h41.941a17.088 17.088 0 0 0 17.088-17.088V222.57c0-9.407-7.658-17.066-17.088-17.066H197.931a17.067 17.067 0 0 0-17.046 17.067V640.32a17.024 17.024 0 0 0 17.024 17.088z" fill="#FFFFFF"></path>
		<path d="M492.97 739.2v-0.17a110.656 110.656 0 0 1-110.655-110.657h-0.107V332.331a17.067 17.067 0 0 0-17.067-17.046H323.2a17.045 17.045 0 0 0-17.045 17.046v296.042h-0.363A110.677 110.677 0 0 1 195.115 739.03v0.171a17.045 17.045 0 0 0-17.046 17.067v42.112a17.067 17.067 0 0 0 17.046 17.066 186.603 186.603 0 0 0 148.928-74.176 186.624 186.624 0 0 0 148.928 74.176 17.045 17.045 0 0 0 17.045-17.066v-42.112a17.024 17.024 0 0 0-17.045-17.067zM865.45 873.685c17.665-3.797 15.254-24.896 14.742-29.504-0.875-7.125-9.237-19.541-20.587-18.581-14.293 1.28-16.362 21.93-16.362 21.93-1.963 9.558 4.608 29.953 22.208 26.155z m18.753 36.694c-0.534 1.493-1.664 5.29-0.683 8.597 1.963 7.403 8.405 7.744 8.405 7.744h9.259v-22.613h-9.899a10.837 10.837 0 0 0-7.082 6.272z m14.037-72.086c9.75 0 17.621-11.221 17.621-25.109 0-13.867-7.872-25.088-17.621-25.088-9.728 0-17.643 11.221-17.643 25.088 0 13.888 7.894 25.11 17.643 25.11z m41.984 1.664c13.035 1.707 21.419-12.202 23.083-22.762 1.706-10.539-6.699-22.763-15.936-24.854-9.259-2.112-20.779 12.672-21.846 22.358-1.258 11.797 1.686 23.573 14.699 25.258z m31.936 61.974s-20.16-15.595-31.936-32.448c-15.957-24.875-38.635-14.763-46.208-2.112-7.552 12.65-19.328 20.629-20.992 22.741-1.685 2.09-24.363 14.336-19.328 36.672s22.72 21.91 22.72 21.91 13.013 1.28 28.139-2.113c15.104-3.349 28.117 0.832 28.117 0.832s35.307 11.819 44.97-10.944c9.622-22.72-5.482-34.538-5.482-34.538z m-60.395 33.877h-22.954c-9.92-1.984-13.867-8.747-14.358-9.899-0.49-1.173-3.306-6.613-1.813-15.85 4.288-13.867 16.49-14.848 16.49-14.848h12.225v-15.04l10.41 0.149v55.488z m42.752-0.17h-26.41c-10.24-2.625-10.71-9.92-10.71-9.92v-29.206l10.71-0.17v26.26c0.64 2.795 4.117 3.307 4.117 3.307h10.88v-29.397h11.413v39.125z m37.376-77.995c0-5.035-4.181-20.224-19.733-20.224s-17.643 14.336-17.643 24.469c0 9.685 0.811 23.19 20.16 22.741 19.328-0.426 17.216-21.909 17.216-26.986z" fill="#FFFFFF"></path>
	</symbol>
	<symbol id="icon-steam" viewBox="0 0 1024 1024">
		<path d="M510.872 0.00004A511.738935 511.738935 0 0 0 0.578065 470.68598l274.473965 113.377986a144.332982 144.332982 0 0 1 89.621989-24.903997L486.810003 382.552991v-2.615999a193.084975 193.084975 0 1 1 193.049976 193.095975h-4.48L501.388001 697.214951c0 2.275 0.193 4.549999 0.193 6.823a144.799982 144.799982 0 0 1-286.766963 28.543996L18.227063 651.159957A511.965935 511.965935 0 1 0 510.792 0.00004h0.069zM321.404024 776.591941L258.540032 750.549945a108.772986 108.772986 0 1 0 59.599993-148.745981l64.967991 26.837996a80.09299 80.09299 0 1 1-61.646992 147.835981v0.114z m487.139938-396.767949A128.661984 128.661984 0 1 0 679.882979 508.439975a128.843984 128.843984 0 0 0 128.662983-128.616983z m-225.061971-0.228a96.661988 96.661988 0 1 1 96.661988 96.661988 96.433988 96.433988 0 0 1-96.661988-96.661988z" fill="#004986"></path>
	</symbol>
	<symbol id="icon-leetcode" viewBox="0 0 1024 1024">
		<path d="M1023.52385 511.966c0 163.698 0 327.396 0.477 491.094 0 17.052-3.888 20.94-20.94 20.872q-491.094-0.819-982.188 0c-17.051 0-20.94-3.82-20.871-20.872Q0.81985 511.966 0.00085 20.872C-0.06615 3.821 3.82085-0.068 20.87285 0.001q491.094 0.818 982.188 0c17.052 0 21.008 3.82 20.94 20.871-0.477 163.698-0.477 327.396-0.477 491.094z" fill="#FEFEFE"></path>
		<path d="M454.87785 321.736c-61.387 61.386-124.82 121.068-184.774 184.16-44.404 46.722-40.925 113.906 5.593 161.924 55.18 56.68 111.996 111.724 168.063 167.45 21.212 21.963 20.94 47.063 5.388 70.39-14.392 21.485-35.058 34.65-63.092 22.577a132.664 132.664 0 0 1-35.672-25.578c-51.77-52.315-104.767-103.47-155.99-156.4-89.898-92.83-90.921-232.451-0.478-324.668C320.98585 291.724 449.96585 163.903 578.40085 35.537c28.307-28.306 63.843-30.148 87.033-6.002s21.008 55.657-6.411 84.509q-43.176 45.426-86.692 90.443c-30.693 47.609-71.823 84.645-117.453 117.249z" fill="#070706"></path>
		<path d="M677.02885 641.015H493.41485c-40.925 0-70.186-24.76-69.504-58.113 0.614-32.262 27.966-55.998 68.208-56.135q187.025-0.886 374.05 0c39.833 0 62.342 22.031 62.683 56.476 0 35.74-23.055 57.294-64.934 57.704-62.137 0.545-124.547 0.068-186.889 0.068z" fill="#B4B2B1"></path>
		<path d="M386.05585 928.1c60.569-7.366 79.053-37.241 57.704-92.967 63.842 33.49 110.837 26.056 162.47-25.577 26.465-26.465 52.52-53.339 79.598-79.19s57.431-26.464 81.44-2.728 23.532 54.566-1.978 81.44c-34.104 35.195-67.457 70.595-103.47 103.266-76.939 69.777-199.917 75.915-275.764 15.756z" fill="#EAA240"></path>
		<path d="M454.87785 321.736A1295.942 1295.942 0 0 1 572.33085 204.487c89.693 27.829 142.349 101.152 202.372 164.926 19.575 20.871 11.663 53.747-10.777 72.777a53.338 53.338 0 0 1-73.869-2.183 821.627 821.627 0 0 1-74.414-74.278c-44.13-52.315-96.855-66.502-160.765-43.993z" fill="#EAA340"></path>
	</symbol>
</svg>
	<a id="top"></a>
	<header>
		<div id="nav-mobile-toggle-button"><span></span><span></span><span></span></div>
		
		<div id="nav-mobile-toc-button"><i class="fa fa-list"></i></div>
		
		<nav class="horizental-inner">
			<a class="nav-item " href="/"><span class="nav-item-inner">
				<i class="fa fa-home"></i> <span data-hover="Home">Home</span>
			</span></a>
			<a class="nav-item " href="/archives"><span class="nav-item-inner">
				<i class="fa fa-archive"></i> <span data-hover="Archive">Archive</span>
			</span></a>
			<a class="nav-item " href="/tags"><span class="nav-item-inner">
				<i class="fa fa-tag"></i> <span data-hover="Tag">Tag</span>
			</span></a>
			<a class="nav-item " href="/categories"><span class="nav-item-inner">
				<i class="fa fa-folder"></i> <span data-hover="Category">Category</span>
			</span></a>
			<a class="nav-item " href="/about"><span class="nav-item-inner">
				<i class="fa fa-user"></i> <span data-hover="About">About</span>
			</span></a>
			<a class="nav-item " href="/link"><span class="nav-item-inner">
				<i class="fa fa-link"></i> <span data-hover="Link">Link</span>
			</span></a>
			<a class="nav-item" href="javascript:;" id="nav-search-button"><span class="nav-item-inner">
				<i class="fa fa-search"></i> <span data-hover="Search">Search</span>
			</span></a>
			
			<a class="nav-item" href="javascript:location.href = location.pathname.replace('/', '/s/');"><span class="nav-item-inner">
				<i class="fa fa-exchange"></i> <span data-hover="Notebook">Notebook</span>
				</span></a>
			
		</nav>
	</header>
	<main>
		<div id="main-inner" class="horizental-inner">
			<section>
 
<article> 
	<a href="/p/9mnmo0/" class="head">
		<div class="title">计算机组成原理上机实验7 流水线CPU</div>
		<div class="date"><i class="fa fa-calendar"></i> 2018-06-14</div>
	</a>
	<div class="content">
		<h2 id="实验目的"><a href="#实验目的" class="headerlink" title="实验目的"></a>实验目的</h2><h3 id="设计一个MIPS指令集的CPU，"><a href="#设计一个MIPS指令集的CPU，" class="headerlink" title="设计一个MIPS指令集的CPU，"></a>设计一个MIPS指令集的CPU，</h3><h4 id="1、-基本要求："><a href="#1、-基本要求：" class="headerlink" title="1、    基本要求："></a>1、    基本要求：</h4><pre><code>a)    多周期
b)    包含16条指令
    i.    add addi addu sub subu 
    ii.
</code></pre>
<span id="more"></span>
<pre><code>and andi or nor xor
    iii. bgtz bne j jr
    iv.    lw sw
</code></pre>
<h4 id="2、-扩展要求"><a href="#2、-扩展要求" class="headerlink" title="2、    扩展要求"></a>2、    扩展要求</h4><pre><code>a)    在16条的基础上，增加其他指令
b)    实现中断功能
c)    实现流水
d)    实现下载
</code></pre>
<h2 id="实验平台"><a href="#实验平台" class="headerlink" title="实验平台"></a>实验平台</h2><h4 id="EDA工具为ISE14-7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6-XC6SLX16-CS324。"><a href="#EDA工具为ISE14-7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6-XC6SLX16-CS324。" class="headerlink" title="EDA工具为ISE14.7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6 XC6SLX16-CS324。"></a>EDA工具为ISE14.7，开发板型号为Digilent的Nexys3，FPGA型号为Spartan-6 XC6SLX16-CS324。</h4><h2 id="使用部件"><a href="#使用部件" class="headerlink" title="使用部件"></a>使用部件</h2><h4 id="开发板上的开关，7段数码管和按钮。"><a href="#开发板上的开关，7段数码管和按钮。" class="headerlink" title="开发板上的开关，7段数码管和按钮。"></a>开发板上的开关，7段数码管和按钮。</h4><h2 id="最终实现功能"><a href="#最终实现功能" class="headerlink" title="最终实现功能"></a>最终实现功能</h2><h4 id="1、实现五段流水线"><a href="#1、实现五段流水线" class="headerlink" title="1、实现五段流水线"></a>1、实现五段流水线</h4><h4 id="2、实现完全转发和冒险检测"><a href="#2、实现完全转发和冒险检测" class="headerlink" title="2、实现完全转发和冒险检测"></a>2、实现完全转发和冒险检测</h4><h4 id="3、实现36条指令"><a href="#3、实现36条指令" class="headerlink" title="3、实现36条指令"></a>3、实现36条指令</h4><h4 id="4、实现下载并在数码管上动态显示内存"><a href="#4、实现下载并在数码管上动态显示内存" class="headerlink" title="4、实现下载并在数码管上动态显示内存"></a>4、实现下载并在数码管上动态显示内存</h4><h2 id="详细设计过程"><a href="#详细设计过程" class="headerlink" title="详细设计过程"></a>详细设计过程</h2><h3 id="1、-MIPS指令格式"><a href="#1、-MIPS指令格式" class="headerlink" title="1、    MIPS指令格式"></a>1、    MIPS指令格式</h3><p>MIPS-IV指令集标准下的指令长度为32位，分为R型、I型和J型指令</p>
<p><img src="/p/9mnmo0/pic1.png"><br>R-Tpye<br><img src="/p/9mnmo0/pic2.png"><br>I-Tpye<br><img src="/p/9mnmo0/pic3.png"><br>J-Tpye</p>
<p>它们的共同部分是26-31位的Op码，用来区分不同的指令，其中</p>
<p>（1）R-Type的指令Op=000000，再根据0-5位的Funct部分区分不同指令</p>
<p>（2）I-Type的指令0-15位为立即数，位扩展后用于直接计算或者访存和跳转偏移地址。Op=000001的I-Type指令，根据Rt的不同来区分。</p>
<p>（3）J-Type的指令除了Op之外，0-25位为立即数，位扩展后作为跳转地址偏移。<br>本次实现的36条指令，详细格式如下表</p>
<table>
<thead>
<tr>
<th><strong>Instr</strong></th>
<th><strong>31-26</strong></th>
<th><strong>25-21</strong></th>
<th><strong>20-16</strong></th>
<th><strong>15-11</strong></th>
<th><strong>10-6</strong></th>
<th><strong>5-0</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>op</strong></td>
<td><strong>rs</strong></td>
<td><strong>rt</strong></td>
<td><strong>rd</strong></td>
<td><strong>shamt</strong></td>
<td><strong>func</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td>SLL</td>
<td>000000</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000000</td>
<td><code>$1</code>=<code>$2</code>&lt;&lt;shamt</td>
</tr>
<tr>
<td>SRL</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000010</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;shamt</td>
<td></td>
</tr>
<tr>
<td>SRA</td>
<td>-</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>shamt</td>
<td>000011</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;&gt;shamt</td>
<td></td>
</tr>
<tr>
<td>SLLV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000100</td>
<td><code>$1</code>=<code>$2</code>&lt;&lt;<code>$3</code></td>
<td></td>
</tr>
<tr>
<td>SRLV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000110</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;<code>$3</code></td>
<td></td>
</tr>
<tr>
<td>SRAV</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>000111</td>
<td><code>$1</code>=<code>$2</code>&gt;&gt;&gt;<code>$3</code></td>
<td></td>
</tr>
<tr>
<td>JR</td>
<td><code>$1</code></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>001000</td>
<td>PC=<code>$1</code></td>
<td></td>
</tr>
<tr>
<td>MOVZ</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td></td>
<td>001010</td>
<td>Set <code>$t1</code> = <code>$t2</code> if <code>$t3</code> is zero</td>
<td></td>
</tr>
<tr>
<td>MOVN</td>
<td><code>$3</code></td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td></td>
<td>001011</td>
<td>Set <code>$t1</code> = <code>$t2</code> if <code>$t3</code> is not zero</td>
<td></td>
</tr>
<tr>
<td>ADD</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100000</td>
<td><code>$1</code>=<code>$2</code>+<code>$3</code></td>
<td></td>
</tr>
<tr>
<td>ADDU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100001</td>
<td><code>$1</code>=<code>$2</code>+<code>$3</code>(unsigned)</td>
<td></td>
</tr>
<tr>
<td>SUB</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100010</td>
<td><code>$1</code>=<code>$2</code>-<code>$3</code></td>
<td></td>
</tr>
<tr>
<td>SUBU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100011</td>
<td><code>$1</code>=<code>$2</code>-<code>$3</code>(unsigned)</td>
<td></td>
</tr>
<tr>
<td>AND</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100100</td>
<td><code>$1</code>=<code>$2</code> and <code>$3</code></td>
<td></td>
</tr>
<tr>
<td>OR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100101</td>
<td><code>$1</code>=<code>$2</code> or <code>$3</code></td>
<td></td>
</tr>
<tr>
<td>XOR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100110</td>
<td><code>$1</code>=<code>$2</code> xor <code>$3</code></td>
<td></td>
</tr>
<tr>
<td>NOR</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>100111</td>
<td><code>$1</code>=<code>$2</code> nor <code>$3</code></td>
<td></td>
</tr>
<tr>
<td>SLT</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>101010</td>
<td>if(<code>$2</code>&lt;<code>$3</code>) <code>$1</code>=1 else <code>$1</code>=0</td>
<td></td>
</tr>
<tr>
<td>SLTU</td>
<td><code>$2</code></td>
<td><code>$3</code></td>
<td><code>$1</code></td>
<td>-</td>
<td>101011</td>
<td>if(<code>$2</code>&lt;<code>$3</code>) <code>$1</code>=1 else <code>$1</code>=0(unsigned)</td>
<td></td>
</tr>
<tr>
<td>BLTZ</td>
<td>000001</td>
<td><code>$1</code></td>
<td>00000</td>
<td>offset</td>
<td>if(<code>$1</code>&lt;0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BGEZ</td>
<td><code>$1</code></td>
<td>00001</td>
<td>offset</td>
<td>if(<code>$1</code>&gt;=0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>J</td>
<td>000010</td>
<td>immediate</td>
<td>PC=PC[31:28]+immediate&lt;&lt;2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>BEQ</td>
<td>000100</td>
<td><code>$1</code></td>
<td><code>$2</code></td>
<td>offset</td>
<td>if(<code>$1</code>==<code>$2</code>) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BNE</td>
<td>000101</td>
<td><code>$1</code></td>
<td><code>$2</code></td>
<td>offset</td>
<td>if(<code>$1</code>!=<code>$2</code>) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BLEZ</td>
<td>000110</td>
<td><code>$1</code></td>
<td>-</td>
<td>offset</td>
<td>if(<code>$1</code>&lt;=0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>BGTZ</td>
<td>000111</td>
<td><code>$1</code></td>
<td>-</td>
<td>offset</td>
<td>if(<code>$1</code>&gt;0) PC=PC+4+(sign-extend)offset&lt;&lt;2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ADDI</td>
<td>001000</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code>+(sign-extend)immediate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ADDIU</td>
<td>001001</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>(unsigned)=<code>$2</code>+(sign-extend)immediate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SLTI</td>
<td>001010</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>if(<code>$2</code>&lt;(sign-extend)immediate) <code>$1</code>=1 else <code>$1</code>=0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SLTIU</td>
<td>001011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>if(<code>$2</code>&lt;(sign-extend)immediate) <code>$1</code>=1 else <code>$1</code>=0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ANDI</td>
<td>001100</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> and (zero-extend)immediate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ORI</td>
<td>001101</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> or (zero-extend)immediate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>XORI</td>
<td>001110</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=<code>$2</code> xor (zero-extend)immediate</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LUI</td>
<td>001111</td>
<td>-</td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=immediate*65536</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LW</td>
<td>100011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td><code>$1</code>=memory[<code>$2</code>+10]</td>
<td></td>
<td></td>
</tr>
<tr>
<td>SW</td>
<td>101011</td>
<td><code>$2</code></td>
<td><code>$1</code></td>
<td>immediate</td>
<td>memory[<code>$2</code>+10]=<code>$1</code></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2、-整体设计"><a href="#2、-整体设计" class="headerlink" title="2、    整体设计"></a>2、    整体设计</h3><h4 id="1-分为五个流水段IF、ID、EX、MEM、WB。"><a href="#1-分为五个流水段IF、ID、EX、MEM、WB。" class="headerlink" title="(1)    分为五个流水段IF、ID、EX、MEM、WB。"></a>(1)    分为五个流水段IF、ID、EX、MEM、WB。</h4><h4 id="2-clk上升沿为每段的开始，每段长度为一个clk。"><a href="#2-clk上升沿为每段的开始，每段长度为一个clk。" class="headerlink" title="(2)    clk上升沿为每段的开始，每段长度为一个clk。"></a>(2)    clk上升沿为每段的开始，每段长度为一个clk。</h4><h4 id="3-每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。"><a href="#3-每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。" class="headerlink" title="(3)    每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。"></a>(3)    每段的相关模块可以和clk上升沿同步也可以与clk下降沿同步。</h4><h4 id="4-甘特图如下"><a href="#4-甘特图如下" class="headerlink" title="(4)    甘特图如下"></a>(4)    甘特图如下</h4><p><img src="/p/9mnmo0/pic4.png"></p>
<h4 id="5-详细数据通路图如下"><a href="#5-详细数据通路图如下" class="headerlink" title="(5)详细数据通路图如下"></a>(5)详细数据通路图如下</h4><p><img src="/p/9mnmo0/pic5.jpg"></p>
<h3 id="3、-各模块设计，主要有以下几个模块"><a href="#3、-各模块设计，主要有以下几个模块" class="headerlink" title="3、    各模块设计，主要有以下几个模块"></a>3、    各模块设计，主要有以下几个模块</h3><h4 id="a-alu模块——算术逻辑单元"><a href="#a-alu模块——算术逻辑单元" class="headerlink" title="a)    alu模块——算术逻辑单元"></a>a)    alu模块——算术逻辑单元</h4><p>| alu.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [31:0] | alu_a | 无符号型的操作数a，如果有负数，是以补码存储 |<br>| input | [31:0] | alu_b, | 无符号型的操作数b，如果有负数，是以补码存储 |<br>| input | [4:0] | alu_op, | 运算类型 |<br>| output | [31:0] | alu_out | 无符号型的运算结果，如果有负数，是以补码存储 |</p>
<p>alu模块完成大部分R型指令的计算，case判断alu_op的值，使用使用verilog语言中的各运算符完成运算。</p>
<p> 这里应该注意的是add和addu的实现是一样的，这是因为当操作数都是补码表示时，符号可以直接参与运算，两条指令的区别在于，add视结果为有符号，因此如果要实现中断功能，就需要判断是否溢出。具体方法是alu_a与alu_b符号同号时，alu_out与它们异号，则表示溢出。</p>
<p> 另外，还需要注意slt的实现，比较大小时，不能使用alu_a-alu_b&gt;0，因为它们都是无符号数，相减结果认为无符号数，而无符号数&gt;0是恒成立的。</p>
<h4 id="b-regfile模块——寄存器文件"><a href="#b-regfile模块——寄存器文件" class="headerlink" title="b) regfile模块——寄存器文件"></a>b) regfile模块——寄存器文件</h4><p>| regfile.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | rst_n | 复位信号，低电平有效 |<br>| input | [4:0] | rAddr1 | 读地址1 |<br>| output | [31:0] | rDout1 | 读数据1 |<br>| input | [4:0] | rAddr2 | 读地址2 |<br>| output | [31:0] | rDout2 | 读数据2 |<br>| input | [4:0] | wAddr | 写地址 |<br>| input | [31:0] | wDin | 写数据 |<br>| input | [0:0] | wEna | 写使能，高电平有效 |</p>
<p>这个模块实现了一个32个32位宽的寄存器组，有两个读端口，一个写端口，读取数据为异步读，写入数据在时钟上升沿且写使能有效，使用非阻塞赋值。</p>
<h4 id="c-mux模块和mux4模块——2路和4路选择器"><a href="#c-mux模块和mux4模块——2路和4路选择器" class="headerlink" title="c) mux模块和mux4模块——2路和4路选择器"></a>c) mux模块和mux4模块——2路和4路选择器</h4><p>| mux.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | sel | 选择信号 |<br>| input | [WIDTH-1:0] | d0 | 选择数据1 |<br>| input | [WIDTH-1:0] | d1 | 选择数据2 |<br>| output | [WIDTH-1:0] | out | 输出 |</p>
<h4 id="d-IP核生成的DMem模块和IMem模块——存放数据段和代码段"><a href="#d-IP核生成的DMem模块和IMem模块——存放数据段和代码段" class="headerlink" title="d) IP核生成的DMem模块和IMem模块——存放数据段和代码段"></a>d) IP核生成的DMem模块和IMem模块——存放数据段和代码段</h4><p>Mem是同步读，同步写，且由指定coe文件初始化，coe文件的内容是16进制文本，由Mars编译汇编代码生成。</p>
<h4 id="e-IFID模块——IF段和ID段之间的寄存器"><a href="#e-IFID模块——IF段和ID段之间的寄存器" class="headerlink" title="e) IFID模块——IF段和ID段之间的寄存器"></a>e) IFID模块——IF段和ID段之间的寄存器</h4><p>| IFID.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | en | 使能信号，高电平有效 |<br>| input | [0:0] | flush | 清空信号，高电平有效 |<br>| input | [31:0] | PCPlus_in | IF段的PC+4 |<br>| input | [31:0] | IMemout_in | IF段的Imem输出 |<br>| output | [31:0] | PCPlus_out | ID段的PC+4 |<br>| output | [31:0] | IMemout_out | ID段的Imem输出 |</p>
<h4 id="f-IDEX模块——ID段和EX段之间的寄存器"><a href="#f-IDEX模块——ID段和EX段之间的寄存器" class="headerlink" title="f) IDEX模块——ID段和EX段之间的寄存器"></a>f) IDEX模块——ID段和EX段之间的寄存器</h4><p>| IDEX.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | en | 使能信号高电平有效 |<br>| input | [0:0] | flush | 清空信号高电平有效 |<br>| input | [31:0] | PCPlus_in | ID段的PCPlus |<br>| input | [31:0] | RegRdout1_in | ID段的RegRdout1 |<br>| input | [31:0] | RegRdout2_in | ID段的RegRdout2 |<br>| input | [31:0] | IMMSignExtended_in | ID段的IMMSignExtended |<br>| input | [31:0] | IMMZeroExtended_in | ID段的IMMZeroExtended |<br>| input | [31:0] | ShamtZeroExtended_in | ID段的ShamtZeroExtended |<br>| input | [4:0] | Rs_in | ID段的Rs |<br>| input | [4:0] | Rt_in | ID段的Rt |<br>| input | [4:0] | RegWtaddr_in | ID段的RegWtaddr |<br>| output | [31:0] | PCPlus_out | EX段的PCPlus |<br>| output | [31:0] | RegRdout1_out | EX段的RegRdout1 |<br>| output | [31:0] | RegRdout2_out | EX段的RegRdout2 |<br>| output | [31:0] | IMMSignExtended_out | EX段的IMMSignExtended |<br>| output | [31:0] | IMMZeroExtended_out | EX段的IMMZeroExtended |<br>| output | [31:0] | ShamtZeroExtended_out | EX段的ShamtZeroExtended |<br>| output | [4:0] | Rs_out | EX段的Rs |<br>| output | [4:0] | Rt_out | EX段的Rt |<br>| output | [4:0] | RegWtaddr_out | EX段的RegWtaddr |<br>| input | [0:0] | RegDst_in | ID段的RegDst |<br>| input | [0:0] | ALUSrcASel_in | ID段的ALUSrcASel |<br>| input | [1:0] | ALUSrcBSel_in | ID段的ALUSrcBSel |<br>| input | [4:0] | ALUControl_in | ID段的ALUControl |<br>| input | [0:0] | DMemRead_in | ID段的DMemRead |<br>| input | [0:0] | DMemWrite_in | ID段的DMemWrite |<br>| input | [0:0] | DMemtoReg_in | ID段的DMemtoReg |<br>| input | [0:0] | RegWrite_in | ID段的RegWrite |<br>| output | [0:0] | RegDst_out | EX段的RegDst |<br>| output | [0:0] | ALUSrcASel_out | EX段的ALUSrcASel |<br>| output | [1:0] | ALUSrcBSel_out | EX段的ALUSrcBSel |<br>| output | [4:0] | ALUControl_out | EX段的ALUControl |<br>| output | [0:0] | DMemRead_out | EX段的DMemRead |<br>| output | [0:0] | DMemWrite_out | EX段的DMemWrite |<br>| output | [0:0] | DMemtoReg_out | EX段的DMemtoReg |<br>| output | [0:0] | RegWrite_out | EX段的RegWrite |</p>
<h4 id="g-EXMEM模块——EX段和MEM段之间的寄存器"><a href="#g-EXMEM模块——EX段和MEM段之间的寄存器" class="headerlink" title="g) EXMEM模块——EX段和MEM段之间的寄存器"></a>g) EXMEM模块——EX段和MEM段之间的寄存器</h4><p>| EXMEM.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | en | 使能信号高电平有效 |<br>| input | [0:0] | flush | 清空信号高电平有效 |<br>| input | [31:0] | ALUResult_in | EX段的ALUResult |<br>| input | [31:0] | DMemin_in | EX的Dmemin |<br>| input | [4:0] | RegWtaddr_in | EX的RegWtaddr |<br>| output | [31:0] | ALUResult_out | MEM段的ALUResult |<br>| output | [31:0] | DMemin_out | MEM的Dmemin |<br>| output | [4:0] | RegWtaddr_out | MEM的RegWtaddr |<br>| input | [0:0] | DMemRead_in | EX段的DMemRead |<br>| input | [0:0] | DMemWrite_in | EX段的DMemWrite |<br>| input | [0:0] | DMemtoReg_in | EX段的DMemtoReg |<br>| input | [0:0] | RegWrite_in | EX段的RegWrite |<br>| output | [0:0] | DMemRead_out | MEM段的DMemRead |<br>| output | [0:0] | DMemWrite_out | MEM段的DMemWrite |<br>| output | [0:0] | DMemtoReg_out | MEM段的DMemtoReg |<br>| output | [0:0] | RegWrite_out | MEM段的RegWrite |</p>
<h4 id="h-MEMWB模块——MEM段和WB段之间的寄存器"><a href="#h-MEMWB模块——MEM段和WB段之间的寄存器" class="headerlink" title="h) MEMWB模块——MEM段和WB段之间的寄存器"></a>h) MEMWB模块——MEM段和WB段之间的寄存器</h4><p>| MEMWB.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | en | 使能信号高电平有效 |<br>| input | [0:0] | flush | 清空信号高电平有效 |<br>| input | [31:0] | ALUResult_in | MEM段的ALUResult |<br>| input | [31:0] | DMemout_in | MEM段的Dmemout |<br>| input | [4:0] | RegWtaddr_in | MEM段的RegWtaddr |<br>| output | [31:0] | ALUResult_out | WB段的ALUResult |<br>| output | [31:0] | DMemout_out | WB段的DMemout |<br>| output | [4:0] | RegWtaddr_out | WB段的RegWtaddr |<br>| input | [0:0] | DMemtoReg_in | MEM段的DMemtoReg |<br>| input | [0:0] | RegWrite_in | MEM段的RegWrite |<br>| output | [0:0] | DMemtoReg_out | WB段的DMemtoReg |<br>| output | [0:0] | RegWrite_out | WB段的RegWrite |</p>
<h4 id="i-dff模块——D触发器，用于各个段寄存器"><a href="#i-dff模块——D触发器，用于各个段寄存器" class="headerlink" title="i) dff模块——D触发器，用于各个段寄存器"></a>i) dff模块——D触发器，用于各个段寄存器</h4><p>| dff.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | en | 使能信号高电平有效 |<br>| input | [0:0] | rst | 复位信号高电平有效 |<br>| input | [WIDTH-1:0] | datain | 输入数据 |<br>| output | [WIDTH-1:0] | dataout | 输出数据 |</p>
<p> 这是一个通用的D触发器，位数作为参数可根据需要变化，用一个always在时钟沿触发来实现非阻塞赋值。</p>
<h4 id="j-compare模块——用于分支信号的判断"><a href="#j-compare模块——用于分支信号的判断" class="headerlink" title="j) compare模块——用于分支信号的判断"></a>j) compare模块——用于分支信号的判断</h4><p>| dff.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [31:0] | a, | 有符号数a，需加前缀signed |<br>| input | [31:0] | b, | 有符号数b，需加前缀signed |<br>| output | [1:0] | res | 比较结果 |</p>
<p>a等于b返回2’b01，a小于b返回2’b00，a大于b返回2’b10，比较均是基于有符号数。</p>
<h4 id="k-SignExtended模块——立即数符号扩展"><a href="#k-SignExtended模块——立即数符号扩展" class="headerlink" title="k) SignExtended模块——立即数符号扩展"></a>k) SignExtended模块——立即数符号扩展</h4><p>过于简单，直接在top中实现了。</p>
<h4 id="l-ZeroExtended模块——立即数无符号扩展"><a href="#l-ZeroExtended模块——立即数无符号扩展" class="headerlink" title="l) ZeroExtended模块——立即数无符号扩展"></a>l) ZeroExtended模块——立即数无符号扩展</h4><p>过于简单，直接在top中实现了。</p>
<h4 id="m-forward模块——旁路前推模块，实现转发"><a href="#m-forward模块——旁路前推模块，实现转发" class="headerlink" title="m) forward模块——旁路前推模块，实现转发"></a>m) forward模块——旁路前推模块，实现转发</h4><p>| forward.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [4:0] | Rs_EX | EX段的Rs |<br>| input | [4:0] | Rt_EX | EX段的Rt |<br>| input | [0:0] | RegWrite_MEM | MEM段的RegWrite |<br>| input | [0:0] | RegWrite_WB | WB段的RegWrite |<br>| input | [4:0] | RegWtaddr_MEM | MEM段的RegWtaddr |<br>| input | [4:0] | RegWtaddr_WB | WB段的RegWtaddr |<br>| output | [1:0] | RegRdout1Sel_Forward_EX | EX段的RegRdout1Sel_Forward |<br>| output | [1:0] | RegRdout2Sel_Forward_EX | EX段的RegRdout2Sel_Forward |</p>
<p>这个模块实现从DMem输出到ALU输入以及ALU输出到ALU输入的转发。</p>
<p><img src="/p/9mnmo0/pic6.png"></p>
<p><img src="/p/9mnmo0/pic7.png"></p>
<h4 id="n-hazard模块——冒险检测模块，实现插入气泡"><a href="#n-hazard模块——冒险检测模块，实现插入气泡" class="headerlink" title="n) hazard模块——冒险检测模块，实现插入气泡"></a>n) hazard模块——冒险检测模块，实现插入气泡</h4><p>| hazard.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [4:0] | Rs_ID | ID段的Rs |<br>| input | [4:0] | Rt_ID | ID段的Rt |<br>| input | [4:0] | RegWtaddr_EX | EX段的RegWtaddr |<br>| input | [0:0] | DMemRead_EX | EX段的DMemRead |<br>| output | [0:0] | PCEn | 允许PC更新，高电平有效 |<br>| output | [0:0] | IF_ID_En | 允许IFID更新，高电平有效 |<br>| output | [0:0] | ID_EX_Flush | IDEX清空，高电平有效 |</p>
<p> lw之后R-Type需要使用访存结果，这在时间上是倒流的，不可能，只能插入一个气泡，清空IDEX寄存器，不更新IFID寄存器，不更新PC。</p>
<p><img src="/p/9mnmo0/pic8.png"></p>
<h4 id="o-control模块——产生控制信号"><a href="#o-control模块——产生控制信号" class="headerlink" title="o) control模块——产生控制信号"></a>o) control模块——产生控制信号</h4><p>| control.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | rst | 复位信号高电平有效 |<br>| input | [5:0] | Op |  |<br>| input | [4:0] | Rt |  |<br>| input | [5:0] | Funct |  |<br>| input | [1:0] | RsCMPRt | Rs和Rt寄存器比较结果 |<br>| input | [1:0] | RsCMPZero | Rs寄存器和0比较结果 |<br>| output | [1:0] | PCSrc | 0:+4，1:Branch，2:J，3:JR |<br>| output | [0:0] | RegDst | 0:RegWtaddr=rt，1:RegWtaddr=rd |<br>| output | [0:0] | ALUSrcASel | 0:RegRdout1，1:ShamtZeroExtended |<br>| output | [1:0] | ALUSrcBSel | 0:RegRdout2，1:IMMSignExtended，2:IMMZeroExtended |<br>| output | [4:0] | ALUControl |  |<br>| output | [0:0] | DMemRead | 1:En |<br>| output | [0:0] | DMemWrite | 1:En |<br>| output | [0:0] | DMemtoReg | 0:Aluout，1:DMemout |<br>| output | [0:0] | RegWrite | 1:En |</p>
<p>根据输入信号，判断指令类型，输出对应控制信号的取值。</p>
<h4 id="p-debounce模块——去抖动"><a href="#p-debounce模块——去抖动" class="headerlink" title="p) debounce模块——去抖动"></a>p) debounce模块——去抖动</h4><p>| debounce.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | in | 输入信号，可能有抖动 |<br>| output | [0:0] | out | 输出信号，输入稳定后才变化 |</p>
<h4 id="q-seg模块——7段数码管"><a href="#q-seg模块——7段数码管" class="headerlink" title="q) seg模块——7段数码管"></a>q) seg模块——7段数码管</h4><p>| seg.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [0:0] | rst_n | 复位信号，低电平有效 |<br>| input | [31:0] | data32 | 要显示的数据 |<br>| output | [3:0] | sel | 选择当前显示位，低电平有效 |<br>| output | [6:0] | segments | 选择显示的数码管，高电平有效 |</p>
<h4 id="r-top模块——实例化以上模块，连接各个信号"><a href="#r-top模块——实例化以上模块，连接各个信号" class="headerlink" title="r) top模块——实例化以上模块，连接各个信号"></a>r) top模块——实例化以上模块，连接各个信号</h4><p>| top.v | | | |<br>| — |<br>| 输入/输出 | 宽度 | 信号名 | 说明 |<br>| input | [0:0] | clk | 时钟沿 |<br>| input | [7:0] | sw | 开关选择 |<br>| output | [6:0] | seg7 | 7段数码管选择 |<br>| output | [3:0] | an | 7段数码管位选择 |<br>| input | [0:0] | btns | 按钮中间，按下复位 |</p>
<h3 id="4、-信号命名规则"><a href="#4、-信号命名规则" class="headerlink" title="4、    信号命名规则"></a>4、    信号命名规则</h3><h4 id="（1）-信号名称由几个单词（或其简写）构成，每个单词首字母大写"><a href="#（1）-信号名称由几个单词（或其简写）构成，每个单词首字母大写" class="headerlink" title="（1）    信号名称由几个单词（或其简写）构成，每个单词首字母大写"></a>（1）    信号名称由几个单词（或其简写）构成，每个单词首字母大写</h4><h4 id="（2）-一般先写该信号对应的部件名，然后紧跟操作或接口名。"><a href="#（2）-一般先写该信号对应的部件名，然后紧跟操作或接口名。" class="headerlink" title="（2）    一般先写该信号对应的部件名，然后紧跟操作或接口名。"></a>（2）    一般先写该信号对应的部件名，然后紧跟操作或接口名。</h4><h4 id="（3）-如果该信号是另外一个信号的选择信号，则加上Sel后缀。"><a href="#（3）-如果该信号是另外一个信号的选择信号，则加上Sel后缀。" class="headerlink" title="（3）    如果该信号是另外一个信号的选择信号，则加上Sel后缀。"></a>（3）    如果该信号是另外一个信号的选择信号，则加上Sel后缀。</h4><h4 id="（4）-如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。"><a href="#（4）-如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。" class="headerlink" title="（4）    如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。"></a>（4）    如果该信号涉及在不同段之间传递，则在对应段的信号后加上所在段的名称。</h4><h4 id="（5）-以上面方法命名基本不会引起混淆。"><a href="#（5）-以上面方法命名基本不会引起混淆。" class="headerlink" title="（5）    以上面方法命名基本不会引起混淆。"></a>（5）    以上面方法命名基本不会引起混淆。</h4><ul>
<li>比如：RegRdout1_EX表示寄存器文件读端口1读出的数据传递到EX段的信号。</li>
</ul>
<h3 id="5、-DMem和IMem的初始化"><a href="#5、-DMem和IMem的初始化" class="headerlink" title="5、    DMem和IMem的初始化"></a>5、    DMem和IMem的初始化</h3><p>IP核选择Block Memory，设置为Single Port RAM，</p>
<p><img src="/p/9mnmo0/pic9.png"> </p>
<p>宽度为32，深度为256</p>
<p><img src="/p/9mnmo0/pic10.png">  </p>
<p>选中Load Init File设置，选择初始化coe文件的路径，</p>
<p><img src="/p/9mnmo0/pic11.png">  </p>
<p>其中IMem_init_test.coe文件内容为</p>
<pre><code>    memory_initialization_radix = 16;
    memory_initialization_vector =
    20110008
    01d17020
    21ceffff
    11c00001
    02200008
    20100001
    200f2000
    20080010
    00084040
    00084082
    ade80000
    21ef0004
    8de9fffc
    01295004
    3c090001
    ade90000
    21ef0004
    adea0000
    21ef0004
    01505022
    adea0000
    21ef0004
    010a4025
    01004024
    01084027
    ade80000
    21ef0004
    01485826
    000b5843
    020b5807
    adeb0000
    21ef0004
    000b5842
    020b5806
    000b5dc0
    016b5821
    adeb0000
    21ef0004
    01685823
    adeb0000
    21ef0004
    256b0001
    adeb0000
    21ef0004
    356b0001
    316b0003
    390b0001
    adeb0000
    21ef0004
    020b602a
    adec0000
    21ef0004
    020b602b
    adec0000
    21ef0004
    296c0001
    adec0000
    21ef0004
    2d6c0001
    adec0000
    21ef0004
    018c680a
    aded0000
    21ef0004
    0210680b
    aded0000
    21ef0004
    200e0000
    08000062
    08000066
    21ce0001
    adee0000
    21ef0004
    1560fffb
    21ce0001
    adee0000
    21ef0004
    1000fff8
    21ce0001
    adee0000
    21ef0004
    1800fff8
    21ce0001
    adee0000
    21ef0004
    0560fff8
    21ce0001
    adee0000
    21ef0004
    0401fff8
    21ce0001
    adee0000
    21ef0004
    1e00fff8
    21ce0001
    adee0000
    21ef0004
    1560fff8
    21ce0001
    adee0000
    21ef0004
    116bfff8
    21ce0001
    adee0000
    08000068;
</code></pre>
<p>DMem的初始化类似该过程，其coe文件初始全为0。</p>
<h3 id="6、-测试的汇编代码"><a href="#6、-测试的汇编代码" class="headerlink" title="6、    测试的汇编代码"></a>6、    测试的汇编代码</h3><pre><code class="assembly">.text
    addi $17, $0, 8 #const $17=8
    add $14, $14, $17 #$14=8
    addi $14, $14, -1 #$14--
    beq $14, $0, begin
    jr $17 #jump to IMemAddr 8
begin:
    addi $16, $0, 1 #const 1
    addi $15, $0, 8192 #MemAddr
    addi $8, $0, 16 #$8=16
    sll $8, $8, 1 #$8=32
    srl $8, $8, 2 #$8=8
    sw $8, 0($15) #-------Save Value: 8------
    addi $15, $15, 4 #MemAddr++ 
    lw $9, -4($15) #$9=8(32&#39;b00000000_00000001_00000000_00001000)
    sllv $10, $9, $9 #$10=2048(32&#39;b00000000_00000000_00001000_00000000)
    lui $9, 1 #$9=32&#39;b00000000_00000001_00000000_00000000
    sw $9, 0($15) #-------Save Value: 32&#39;b00000000_00000001_00000000_00001000------
    addi $15, $15, 4 #MemAddr++ 
    sw $10, 0($15) #-------Save Value: 2048------
    addi $15, $15, 4 #MemAddr++
    sub $10, $10, $16 #$10=2047(32&#39;b00000000_00000000_00000111_11111111)
    sw $10, 0($15) #-------Save Value: 2047------
    addi $15, $15, 4 #MemAddr++
    or $8, $8, $10 #$8=2047(32&#39;b111_11111111)
    and $8, $8, $0 #$8=0
    nor $8, $8, $8 #$8=2^32-1
    sw $8, 0($15) #-------Save Value: 2^32-1------
    addi $15, $15, 4 #MemAddr++ 
    xor $11, $10, $8 #$11=32&#39;b11111111_11111111_11111000_00000000
    sra $11, $11, 1 #$11=32&#39;b11111111_11111111_11111100_00000000
    srav $11, $11, $16 #$11=32&#39;b11111111_11111111_11111110_00000000
    sw $11, 0($15) #-------Save Value: 32&#39;b11111111_11111111_11111110_00000000------
    addi $15, $15, 4 #MemAddr++ 
    srl $11, $11, 1 #$11=32&#39;b01111111_11111111_11111111_00000000
    srlv $11, $11, $16 #$11=32&#39;b00111111_11111111_11111111_10000000
    sll $11, $11, 23 #$11=32&#39;b01000000_00000000_00000000_00000000
    addu $11, $11, $11 #$11=32&#39;b10000000_00000000_00000000_00000000
    sw $11, 0($15) #-------Save Value: 32&#39;b10000000_00000000_00000000_00000000------
    addi $15, $15, 4 #MemAddr++     
    subu $11, $11, $8 #$11=32&#39;b10000000_00000000_00000000_00000001
    sw $11, 0($15) #-------Save Value: 32&#39;b10000000_00000000_00000000_00000001------
    addi $15, $15, 4 #MemAddr++ 
    addiu $11, $11, 1 #$11=32&#39;b10000000_00000000_00000000_00000010
    sw $11, 0($15) #-------Save Value: 32&#39;b10000000_00000000_00000000_00000010------
    addi $15, $15, 4 #MemAddr++ 
    ori $11, $11, 1 #$11=32&#39;b10000000_00000000_00000000_00000011
    andi $11, $11, 3 #$11=32&#39;b00000000_00000000_00000000_00000011
    xori $11, $8, 1 #$11=32&#39;b11111111_11111111_11111111_11111110
    sw $11, 0($15) #-------Save Value: 32&#39;b11111111_11111111_11111111_11111100------
    addi $15, $15, 4 #MemAddr++ 
    slt $12, $16, $11 #$12=0
    sw $12, 0($15) #-------Save Value: 0------
    addi $15, $15, 4 #MemAddr++ 
    sltu $12, $16, $11 #$12=1
    sw $12, 0($15) #-------Save Value: 1------
    addi $15, $15, 4 #MemAddr++ 
    slti $12, $11, 1 #$12=1
    sw $12, 0($15) #-------Save Value: 1------
    addi $15, $15, 4 #MemAddr++ 
    sltiu $12, $11, 1 #$12=0
    sw $12, 0($15) #-------Save Value: 0------
    addi $15, $15, 4 #MemAddr++     
    movz $13, $12, $12 #because $12=0, set $13=$12,
    sw $13, 0($15) #-------Save Value: 0------
    addi $15, $15, 4 #MemAddr++         
    movn $13, $16, $16 #because $16=1(!=0), set $13=$16,
    sw $13, 0($15) #-------Save Value: 1------
    addi $15, $15, 4 #MemAddr++
    addi $14, $0, 0 #count
    j a
i:  j end
h:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    bne $11, $0, i #to i    
g:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    beq $0, $0, h #to h 
f:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    blez $0, g #to g
e:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    bltz $11, f #to f
d:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    bgez $0, e #to e
c:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    bgtz $16, d #to d
b:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    bne $11,$0, c #to c
a:  addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
    addi $15, $15, 4 #MemAddr++     
    beq $11, $11, b #to b
end:addi $14, $14, 1 #count++
    sw $14, 0($15) #-------Save Value: $14------
out:j out
</code></pre>
<p>完整汇编代码如上，36条指令均测试到了，每条语句的执行结果在该语句后面给出了注释，每测试几条指令就将结果写入内存，方便查看，并且3种相关有包括在上面的代码中。<br>​     </p>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><h3 id="（1）仿真结果"><a href="#（1）仿真结果" class="headerlink" title="（1）仿真结果"></a>（1）仿真结果</h3><p>汇编代码在Mars编译运行得到Data段为</p>
<p><img src="/p/9mnmo0/pic12.png"> </p>
<p>而ISE仿真结果显示DMem为</p>
<p><img src="/p/9mnmo0/pic13.png">  </p>
<p>汇编代码在Mars编译运行得到结束时寄存器数据和仿真结果的regfile数据     </p>
<p><img src="/p/9mnmo0/pic14.png">     </p>
<p><img src="/p/9mnmo0/pic15.png">             </p>
<p>可见测试程序在编写的MIPS CPU上运行结果与Mars运行结果一致，并且符合上面注释的的预期结果。</p>
<h3 id="（2）下载结果"><a href="#（2）下载结果" class="headerlink" title="（2）下载结果"></a>（2）下载结果</h3><p>按下按钮中键复位，拨动开关选择地址，数码管显示对应地址内存。</p>
<p><img src="/p/9mnmo0/pic16.png">     </p>
<p>由于数据为32位，4个数码管只能显示16位，为此还实现了动态显示，数字会向左移动循环显示。</p>
<p><img src="/p/9mnmo0/pic17.png"> </p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录:"></a>附录:</h2><h3 id="一、-编写过程中遇到问题和一些发现"><a href="#一、-编写过程中遇到问题和一些发现" class="headerlink" title="一、    编写过程中遇到问题和一些发现"></a>一、    编写过程中遇到问题和一些发现</h3><h4 id="1、如果位拼接作为左值，单个变量也要花括号，如"><a href="#1、如果位拼接作为左值，单个变量也要花括号，如" class="headerlink" title="1、如果位拼接作为左值，单个变量也要花括号，如"></a>1、如果位拼接作为左值，单个变量也要花括号，如</h4><pre><code>&#123;&#123;RegDst&#125;,&#123;ALUSrc&#125;,&#123;MemtoReg&#125;,&#123;RegWrite&#125;,&#123;MemWrite&#125;,&#123;Branch&#125;,&#123;ALUOp[1:0]&#125;,&#123;Jump&#125;&#125;=9&#39;b100100100;
</code></pre>
<h4 id="2、”-”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“-”不成立，这是一个不好发现的问题。"><a href="#2、”-”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“-”不成立，这是一个不好发现的问题。" class="headerlink" title="2、”==”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“==”不成立，这是一个不好发现的问题。"></a>2、”==”会严格匹配每一位，比如module内5位数字比较（一个常量，一个input），但外部传入的是3位的，高位自动拓展好像是x，就导致“==”不成立，这是一个不好发现的问题。</h4><h4 id="3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。"><a href="#3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。" class="headerlink" title="3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。"></a>3、仿真遇到高阻态，多半是这个信号不存在，经常是拼写错了，有时候ise检查不出来。</h4><h4 id="4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。"><a href="#4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。" class="headerlink" title="4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。"></a>4、在top里的wire信号，如果通过control模块（或其他模块）进行控制，那么这个信号不能直接在top里赋初值，要到仿真模块里赋值，不然control里改变这个信号的值时，会变成不确定。</h4><h4 id="5、在clk边缘用-lt-对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）"><a href="#5、在clk边缘用-lt-对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）" class="headerlink" title="5、在clk边缘用&lt;=对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）"></a>5、在clk边缘用&lt;=对某信号进行赋值时，如果同时刻需要对该信号进行判断（如状态机，根据状态以完成对应操作），则判断时信号的值是本次改变前的。（非阻塞赋值的特性体现）</h4><h4 id="6、-srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现"><a href="#6、-srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现" class="headerlink" title="6、 srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现"></a>6、 srl是逻辑右移，高位直接补零，而sra是算术右移，高位补符号，在Verilog中，既可以自行实现，也可以这样实现</h4><pre><code>`$signed(alu_a) &gt;&gt;&gt; alu_b`
</code></pre>
<h4 id="应该注意，-gt-gt-gt-是算术右移，但对于无符号数，高位仍然补0，所以需要用-signed-转为有符号数"><a href="#应该注意，-gt-gt-gt-是算术右移，但对于无符号数，高位仍然补0，所以需要用-signed-转为有符号数" class="headerlink" title="应该注意， &gt;&gt;&gt; 是算术右移，但对于无符号数，高位仍然补0，所以需要用$signed()转为有符号数"></a>应该注意， &gt;&gt;&gt; 是算术右移，但对于无符号数，高位仍然补0，所以需要用<code>$signed()</code>转为有符号数</h4><pre><code>`$signed(alu_a) &gt;&gt; alu_b `
</code></pre>
<h4 id="这样写也不行，-gt-gt-不具有算术右移的功能"><a href="#这样写也不行，-gt-gt-不具有算术右移的功能" class="headerlink" title="这样写也不行，&gt;&gt;不具有算术右移的功能"></a>这样写也不行，&gt;&gt;不具有算术右移的功能</h4><h4 id="7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。"><a href="#7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。" class="headerlink" title="7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。"></a>7、reset的时候应该把各段寄存器的各信号置0，否则将导致forward，hazard模块输出的值不确定进而使相关的选择信号不确定（比如PCEn不确定，这样一开始就不能更新PC）。</h4><h3 id="二、-模块源代码"><a href="#二、-模块源代码" class="headerlink" title="二、    模块源代码"></a>二、    模块源代码</h3><h4 id="top-v"><a href="#top-v" class="headerlink" title="top.v"></a>top.v</h4><pre><code class="verilog">module top(
    input clk,
    input [7:0] sw,
    output [6:0] seg7,
    output [3:0] an,
    input btnr,btnl,btns,btnd,btnu
    );
    //_后缀表示该信号所在的流水段
    wire ALUSrcASel_ID;
    wire ALUSrcASel_EX;
    wire [1:0] ALUSrcBSel_ID;//alu B在regout2和imm之间选择
    wire [1:0] ALUSrcBSel_EX;
    wire [31:0] ALUSrcA_EX;
    wire [31:0] ALUSrcB_EX;
    wire [4:0] ALUControl_ID;
    wire [4:0] ALUControl_EX;
    wire [31:0] ALUResult_EX;
    wire [31:0] ALUResult_MEM;
    wire [31:0] ALUResult_WB;
    wire [1:0] RsCMPZero;
    wire [1:0] RsCMPRt;
    wire [31:0] IMMSignExtended_ID;
    wire [31:0] IMMSignExtended_EX;
    wire [31:0] IMMZeroExtended_ID;
    wire [31:0] IMMZeroExtended_EX;
    wire [31:0] ShamtZeroExtended_ID;
    wire [31:0] ShamtZeroExtended_EX;
    wire [1:0] RegRdout1Sel_Forward_EX;//旁路单元产生的选择信号
    wire [1:0] RegRdout2Sel_Forward_EX;
    wire [31:0] RegRdout1_Forward_EX;//旁路数据
    wire [31:0] RegRdout2_Forward_EX;
    wire [4:0] RegRdaddr1_ID;
    wire [31:0] RegRdout1_ID;
    wire [31:0] RegRdout1_EX;
    wire [4:0] RegRdaddr2_ID;
    wire [31:0] RegRdout2_ID;
    wire [31:0] RegRdout2_EX;
    wire [4:0] RegWtaddr_ID;
    wire [4:0] RegWtaddr_EX;    
    wire [4:0] RegWtaddr_MEM;
    wire [4:0] RegWtaddr_WB;
    wire [31:0] RegWtin_WB;
    wire RegWrite_ID;
    wire RegWrite_EX;
    wire RegWrite_MEM;
    wire RegWrite_WB;
    wire RegDst_ID;
    wire [31:0] IMemaddr;
    wire [31:0] IMemout;
    wire [31:0] DMemaddr_MEM;
    wire [31:0] DMemin_MEM;
    wire DMemRead_MEM;
    wire [31:0] DMemout_MEM;
    wire [31:0] DMemout_WB;
    wire DMemWrite_MEM;
    wire DMemtoReg_EX;
    wire DMemtoReg_MEM;
    wire DMemtoReg_WB;
    wire [31:0] PC;
    wire [31:0] PCPlus_IF;
    wire [31:0] PCPlus_ID;
    wire [31:0] PCPlus_EX;
    wire [31:0] EPC;
    wire [31:0] nextPC;
    wire PCEn;
    wire [1:0] PCSrc_ID;//Control输出的，0:+4,1:Branch,2:J,3:JR
    wire IF_ID_En;
    wire IF_ID_Flush;
    wire ID_EX_Flush;
    wire [31:0] PCJump_ID;
    wire [31:0] PCJR_ID;
    wire [31:0] PCBranch_ID;
    wire [31:0] Instr;  
    wire [5:0] Funct;
    wire [4:0] Shamt;
    wire [15:0] IMM16;
    wire [4:0] Rd;
    wire [4:0] Rt;
    wire [4:0] Rs;
    wire [5:0] Op;
    wire [4:0] Rt_EX;//为了旁路判断
    wire [4:0] Rs_EX;//为了旁路判断
    wire [25:0] JumpIMM;
    wire [31:0] IMMSignExtendedShiftLeft2;
    wire btns_d;
    debounce debounce(clk,btns,btns_d);//中键去抖动
    reg rst;
    assign Led = rst;
    always @(posedge btns_d) rst=~rst;
    //--------------regfile_copy_DMem是DMem的一份复制--------------
    wire [4:0] addr_show;
    wire [31:0] out_show;
    assign addr_show = sw;//开关输输入要显示的地址
    seg seg1(clk,1&#39;b1,out_show,an,seg7);//显示数据
    regfile_copy_DMem regfile_copy_DMem(clk,~rst,addr_show,out_show,DMemaddr_MEM &gt;&gt; 2,DMemin_MEM,DMemWrite_MEM);
    //---------------方便显示内存-------------------------
    //=======================IF========================
    mux4 MUXPC(
        .sel(PCSrc_ID),
        .d0(PCPlus_IF),//+4直接用IF的
        .d1(PCBranch_ID),
        .d2(PCJump_ID),
        .d3(PCJR_ID),
        .out(nextPC)
    );
    dff DFFPC(
        .clk(~clk),//下降沿更新PC
        .en(PCEn),
        .rst(rst),
        .datain(nextPC),
        .dataout(PC)
    );  
    alu ALUPCPlus(PC,4,5&#39;d01,PCPlus_IF);
    assign IMemaddr = PC &gt;&gt; 2;//&gt;&gt;2是因为这里IMem是每个地址存储4字节，和实际上的（一地址一字节）不一样
    IMem IMem(clk,1&#39;b0,IMemaddr,32&#39;b0,IMemout);//上升沿读指令
    //======================IFID========================
    IFID IFID(
        .clk(~clk),
        .en(IF_ID_En),
        .flush(IF_ID_Flush || rst),
        .PCPlus_in(PCPlus_IF),
        .IMemout_in(IMemout),
        .PCPlus_out(PCPlus_ID),
        .IMemout_out(Instr)
    );
    //=======================ID==========================
    assign JumpIMM = Instr[25:0];
    assign Funct = Instr[5:0];
    assign Shamt = Instr[10:6];
    assign IMM16 = Instr[15:0];
    assign Rd = Instr[15:11];
    assign Rt = Instr[20:16];
    assign Rs = Instr[25:21];
    assign Op = Instr[31:26];
    //*******Control*******
    control control(
        //in
        .clk(clk),
        .rst(rst),
        .Op(Op),
        .Rt(Rt),
        .Funct(Funct),
        .RsCMPRt(RsCMPRt),
        .RsCMPZero(RsCMPZero),
        //out
        .PCSrc(PCSrc_ID), 
        //ID
        .RegDst(RegDst_ID),
        //EX
        .ALUSrcASel(ALUSrcASel_ID),
        .ALUSrcBSel(ALUSrcBSel_ID), 
        .ALUControl(ALUControl_ID),
        //MEM
        .DMemRead(DMemRead_ID),
        .DMemWrite(DMemWrite_ID),
        //WB
        .DMemtoReg(DMemtoReg_ID),
        .RegWrite(RegWrite_ID)
    );
    //*******Control*******
    assign RegRdaddr1_ID = Rs;
    assign RegRdaddr2_ID = Rt;
    mux #(5) MUXRegWtaddr(RegDst_ID,Rt,Rd,RegWtaddr_ID);
    assign ShamtZeroExtended_ID = &#123;&#123;27&#123;1'b0&#125;&#125;,Shamt&#125;;
    assign IMMSignExtended_ID = &#123;&#123;16&#123;IMM16[15]&#125;&#125;,IMM16&#125;;
    assign IMMZeroExtended_ID = &#123;&#123;16&#123;1'b0&#125;&#125;,IMM16&#125;;
    assign IMMSignExtendedShiftLeft2 = IMMSignExtended_ID &lt;&lt; 2;
    alu BranchALU(PCPlus_ID,IMMSignExtendedShiftLeft2,5&#39;d01,PCBranch_ID);
    assign PCJump_ID = &#123;&#123;PCPlus_ID[31:28]&#125;,&#123;&#123;2'b00,JumpIMM&#125;<<2&#125;&#125;;
    assign PCJR_ID = RegRdout1_ID;
    assign IF_ID_Flush = (PCSrc_ID != 2&#39;b00);//有跳转则清空IF_ID寄存器
    regfile regfile(clk,~rst,RegRdaddr1_ID,RegRdout1_ID,RegRdaddr2_ID,RegRdout2_ID,RegWtaddr_WB,RegWtin_WB,RegWrite_WB);
    compare compare1(RegRdout1_ID,RegRdout2_ID,RsCMPRt);//for beq,bne
    compare compare2(RegRdout1_ID,0,RsCMPZero);//for movz,movn,blez,bgtz,bltz,bgez
    hazard hazard(Rs,Rt,RegWtaddr_EX,DMemRead_EX,PCEn,IF_ID_En,ID_EX_Flush);
    //======================IDEX=========================
    IDEX IDEX(
        .clk(~clk),
        .en(1&#39;b1),  
        .flush(ID_EX_Flush || rst),
        //data
        //in
        .PCPlus_in(PCPlus_ID),
        .RegRdout1_in(RegRdout1_ID),
        .RegRdout2_in(RegRdout2_ID),
        .IMMSignExtended_in(IMMSignExtended_ID),
        .IMMZeroExtended_in(IMMZeroExtended_ID),
        .ShamtZeroExtended_in(ShamtZeroExtended_ID),
        .Rs_in(Rs),
        .Rt_in(Rt),
        .RegWtaddr_in(RegWtaddr_ID),
        //out
        .PCPlus_out(PCPlus_EX),
        .RegRdout1_out(RegRdout1_EX),
        .RegRdout2_out(RegRdout2_EX),
        .IMMSignExtended_out(IMMSignExtended_EX),
        .IMMZeroExtended_out(IMMZeroExtended_EX),
        .ShamtZeroExtended_out(ShamtZeroExtended_EX),
        .Rs_out(Rs_EX),
        .Rt_out(Rt_EX),
        .RegWtaddr_out(RegWtaddr_EX),
        //control sign
        //in
        .RegDst_in(RegDst_ID),
        .ALUSrcASel_in(ALUSrcASel_ID),
        .ALUSrcBSel_in(ALUSrcBSel_ID), 
        .ALUControl_in(ALUControl_ID),
        .DMemRead_in(DMemRead_ID),
        .DMemWrite_in(DMemWrite_ID),
        .DMemtoReg_in(DMemtoReg_ID),
        .RegWrite_in(RegWrite_ID),
        //out
        .RegDst_out(RegDst_EX),
        .ALUSrcASel_out(ALUSrcASel_EX),
        .ALUSrcBSel_out(ALUSrcBSel_EX), 
        .ALUControl_out(ALUControl_EX),
        .DMemRead_out(DMemRead_EX),
        .DMemWrite_out(DMemWrite_EX),
        .DMemtoReg_out(DMemtoReg_EX),
        .RegWrite_out(RegWrite_EX)
    );
    //========================EX=========================
    forward forward(Rs_EX,Rt_EX,RegWrite_MEM,RegWrite_WB,RegWtaddr_MEM,RegWtaddr_WB,RegRdout1Sel_Forward_EX,RegRdout2Sel_Forward_EX);
    mux4 MUXRegRdout1FW(RegRdout1Sel_Forward_EX,RegRdout1_EX,RegWtin_WB,ALUResult_MEM,0,RegRdout1_Forward_EX);//forward
    mux4 MUXRegRdout2FW(RegRdout2Sel_Forward_EX,RegRdout2_EX,RegWtin_WB,ALUResult_MEM,0,RegRdout2_Forward_EX);//forward
    mux MUXALUSrcA(ALUSrcASel_EX,RegRdout1_Forward_EX,ShamtZeroExtended_EX,ALUSrcA_EX);
    mux4 MUXALUSrcB(ALUSrcBSel_EX,RegRdout2_Forward_EX,IMMSignExtended_EX,IMMZeroExtended_EX,0,ALUSrcB_EX);
    alu alu(ALUSrcA_EX,ALUSrcB_EX,ALUControl_EX,ALUResult_EX);
    //======================EXMEM========================
    EXMEM EXMEM(
        .clk(~clk),
        .en(1&#39;b1),
        .flush(rst),
        //data
        //in
        .ALUResult_in(ALUResult_EX),
        .DMemin_in(RegRdout2_Forward_EX),
        .RegWtaddr_in(RegWtaddr_EX),
        //out
        .ALUResult_out(ALUResult_MEM),
        .DMemin_out(DMemin_MEM),
        .RegWtaddr_out(RegWtaddr_MEM),
        //control sign
        //in
        .DMemRead_in(DMemRead_EX),
        .DMemWrite_in(DMemWrite_EX),
        .DMemtoReg_in(DMemtoReg_EX),
        .RegWrite_in(RegWrite_EX),
        //out
        .DMemRead_out(DMemRead_MEM),
        .DMemWrite_out(DMemWrite_MEM),
        .DMemtoReg_out(DMemtoReg_MEM),
        .RegWrite_out(RegWrite_MEM)
    );
    //=======================MEM=========================   
    assign DMemaddr_MEM = ALUResult_MEM;
    DMem DMem(clk,DMemWrite_MEM,DMemaddr_MEM &gt;&gt; 2,DMemin_MEM,DMemout_MEM);  
    //======================MEMWB========================
    MEMWB MEMWB(
        .clk(~clk),
        .en(1&#39;b1),
        .flush(rst),
        //data
        //in
        .ALUResult_in(ALUResult_MEM),
        .DMemout_in(DMemout_MEM),
        .RegWtaddr_in(RegWtaddr_MEM),
        //out
        .ALUResult_out(ALUResult_WB),
        .DMemout_out(DMemout_WB),
        .RegWtaddr_out(RegWtaddr_WB),
        //control sign
        //in
        .DMemtoReg_in(DMemtoReg_MEM),
        .RegWrite_in(RegWrite_MEM),
        //out
        .DMemtoReg_out(DMemtoReg_WB),
        .RegWrite_out(RegWrite_WB)
    );
    //========================WB=========================
    mux MUXDMemtoReg(DMemtoReg_WB,ALUResult_WB,DMemout_WB,RegWtin_WB);
endmodule
</code></pre>
<h4 id="alu-v"><a href="#alu-v" class="headerlink" title="alu.v"></a>alu.v</h4><pre><code class="verilog">`define A_NOP 5&#39;d00 //nop
`define A_ADD 5&#39;d01 //signed_add
`define A_SUB 5&#39;d02 //signed_sub
`define A_AND 5&#39;d03 //and
`define A_OR  5&#39;d04 //or
`define A_XOR 5&#39;d05 //xor
`define A_NOR 5&#39;d06 //nor
`define A_ADDU 5&#39;d07 //unsigned_add
`define A_SUBU 5&#39;d08 //unsigned_sub
`define A_SLT 5&#39;d09 //slt
`define A_SLTU 5&#39;d10 //unsigned_slt
`define A_SLL 5&#39;d11 //sll
`define A_SRL 5&#39;d12 //srl
`define A_SRA 5&#39;d13 //sra
`define A_MOV 5&#39;d14 //movz,movn
`define A_LUI 5&#39;d15 //lui
module alu(
    input [31:0] alu_a,//无符号型的，如果有负数，是以补码存储
    input [31:0] alu_b,
    input [4:0] alu_op,
    output reg [31:0] alu_out

    );
    always@(*)
        case (alu_op)
            `A_NOP: alu_out = 0;
            `A_ADD: alu_out = alu_a + alu_b;
            `A_SUB: alu_out = alu_a - alu_b;
            `A_AND: alu_out = alu_a &amp; alu_b;
            `A_OR : alu_out = alu_a | alu_b;
            `A_XOR: alu_out = alu_a ^ alu_b;
            `A_NOR: alu_out = ~(alu_a | alu_b);
            `A_ADDU: alu_out = alu_a + alu_b;
            `A_SUBU: alu_out = alu_a - alu_b;
            `A_SLT: //a&lt;b(signed) return 1 else return 0;
                begin
                    if(alu_a[31] == alu_b[31]) alu_out = (alu_a &lt; alu_b) ? 32&#39;b1 : 32&#39;b0;
//对于不加signed的变量类型，运算和比较视为无符号，但依然可以存储有符号数，这里相当于自行根据首位判断
//首位相等，即同号情况，直接比较，如果同正，后面31位大的，原数就大，如果同负，后面31位（补码）大的，依然是原数大
                    else alu_out = (alu_a[31] &lt; alu_b[31]) ? 32&#39;b0 : 32&#39;b1;
//异号情况，直接比较符号
                end
            `A_SLTU: alu_out = (alu_a &lt; alu_b) ? 32&#39;b1 : 32&#39;b0;
            `A_SLL: alu_out = alu_b &lt;&lt; alu_a;
            `A_SRL: alu_out = alu_b &gt;&gt; alu_a;
            `A_SRA: alu_out = $signed(alu_b) &gt;&gt;&gt; alu_a;
//使用&gt;&gt;&gt;为算术右移，高位补符号，应该注意，如果是无符号数，&gt;&gt;&gt;仍是逻辑右移，故应该$signed
            `A_MOV: alu_out = alu_b;
//原样输出，相当于reg[rt],mov本不需要通过alu，但因为是RType格式，故统一
            `A_LUI: alu_out = alu_b &lt;&lt; 16;
            default: ;
        endcase
endmodule
</code></pre>
<h4 id="regfile-v"><a href="#regfile-v" class="headerlink" title="regfile.v"></a>regfile.v</h4><pre><code class="verilog">module regfile(
    input clk,
    input rst_n,
    input [4:0] rAddr1,//读地址1
    output [31:0] rDout1,//读数据1
    input [4:0] rAddr2,//读地址2
    output [31:0] rDout2,//读数据2
    input [4:0] wAddr,//写地址
    input [31:0] wDin,//写数据
    input wEna//写使能
    
);
    reg [31:0] data [0:31];
    integer i;
    assign rDout1=data[rAddr1];//读1
    assign rDout2=data[rAddr2];//读2
    always@(posedge clk or negedge rst_n)//写和复位
        if(~rst_n)
        begin
            for(i=0; i&lt;32; i=i+1) data[i]&lt;=0;
        end
        else
        begin
            if(wEna)
                data[wAddr]&lt;=wDin;
        end
endmodule
</code></pre>
<h4 id="dff-v"><a href="#dff-v" class="headerlink" title="dff.v"></a>dff.v</h4><pre><code class="verilog">module dff #(parameter WIDTH = 32) ( //Data Flip-Flop 
    input clk,
    input en,
    input rst,
    input [WIDTH-1:0] datain,
    output reg [WIDTH-1:0] dataout
    );
    always@(posedge clk)
    begin
        if(rst)
            dataout &lt;= 0;
        else if(en)
            dataout &lt;= datain;
    end
endmodule
</code></pre>
<h4 id="mux-v"><a href="#mux-v" class="headerlink" title="mux.v"></a>mux.v</h4><pre><code class="verilog">module mux #(parameter WIDTH = 32)( //2路选择器
    input sel,
    input [WIDTH-1:0] d0,
    input [WIDTH-1:0] d1,
    output [WIDTH-1:0] out
    );
    assign out = (sel == 1&#39;b1 ? d1 : d0);
endmodule
</code></pre>
<h4 id="mux4-v"><a href="#mux4-v" class="headerlink" title="mux4.v"></a>mux4.v</h4><pre><code class="verilog">module mux4 #(parameter WIDTH = 32)( //4路选择器
    input [1:0] sel,
    input [WIDTH-1:0] d0,
    input [WIDTH-1:0] d1,
     input [WIDTH-1:0] d2,
     input [WIDTH-1:0] d3,
    output reg [WIDTH-1:0] out
    );
    always@(*)
        case(sel)
            2&#39;b00: out=d0;
            2&#39;b01: out=d1;
            2&#39;b10: out=d2;
            2&#39;b11: out=d3;
            default:;
        endcase
endmodule
</code></pre>
<h4 id="IFID-v"><a href="#IFID-v" class="headerlink" title="IFID.v"></a>IFID.v</h4><pre><code class="verilog">module IFID(
    input clk,
    input en,
    input flush,
    input [31:0] PCPlus_in,
    input [31:0] IMemout_in,
    output [31:0] PCPlus_out,
    output [31:0] IMemout_out
    );
     dff dff1(clk,en,flush,PCPlus_in,PCPlus_out);
     dff dff2(clk,en,flush,IMemout_in,IMemout_out);
endmodule
</code></pre>
<h4 id="IDEX-v"><a href="#IDEX-v" class="headerlink" title="IDEX.v"></a>IDEX.v</h4><pre><code class="verilog">module IDEX(
    input clk,
    input en,
    input flush,//flush for stall or start
    input [31:0] PCPlus_in,
    input [31:0] RegRdout1_in,
    input [31:0] RegRdout2_in,
    input [31:0] IMMSignExtended_in,
    input [31:0] IMMZeroExtended_in,
    input [31:0] ShamtZeroExtended_in,
    input [4:0] Rs_in,
    input [4:0] Rt_in,
    input [4:0] RegWtaddr_in,
    output [31:0] PCPlus_out,
    output [31:0] RegRdout1_out,
    output [31:0] RegRdout2_out,
    output [31:0] IMMSignExtended_out,
    output [31:0] IMMZeroExtended_out,
    output [31:0] ShamtZeroExtended_out,
    output [4:0] Rs_out,
    output [4:0] Rt_out,
    output [4:0] RegWtaddr_out,
    //control
    input RegDst_in,
    input ALUSrcASel_in,
    input [1:0] ALUSrcBSel_in, 
    input [4:0] ALUControl_in,
    input DMemRead_in,
    input DMemWrite_in,
    input DMemtoReg_in,
    input RegWrite_in,
    output RegDst_out,
    output ALUSrcASel_out,
    output [1:0] ALUSrcBSel_out, 
    output [4:0] ALUControl_out,
    output DMemRead_out,
    output DMemWrite_out,
    output DMemtoReg_out,
    output RegWrite_out
    );
    dff dff1(clk,en,flush,PCPlus_in,PCPlus_out);
    dff dff2(clk,en,flush,RegRdout1_in,RegRdout1_out);
    dff dff3(clk,en,flush,RegRdout2_in,RegRdout2_out);
    dff dff4(clk,en,flush,IMMSignExtended_in,IMMSignExtended_out);
    dff dff5(clk,en,flush,IMMZeroExtended_in,IMMZeroExtended_out);
    dff dff6(clk,en,flush,ShamtZeroExtended_in,ShamtZeroExtended_out);
    dff #(5) dff7(clk,en,flush,Rs_in,Rs_out);
    dff #(5) dff8(clk,en,flush,Rt_in,Rt_out);
    dff #(5) dff9(clk,en,flush,RegWtaddr_in,RegWtaddr_out);
    
    dff #(1) dff10(clk,en,flush,RegDst_in,RegDst_out);
    dff #(1) dff11(clk,en,flush,ALUSrcASel_in,ALUSrcASel_out);
    dff #(2) dff12(clk,en,flush,ALUSrcBSel_in,ALUSrcBSel_out);  
    dff #(5) dff13(clk,en,flush,ALUControl_in,ALUControl_out);  
    dff #(1) dff14(clk,en,flush,DMemRead_in,DMemRead_out);
    dff #(1) dff15(clk,en,flush,DMemWrite_in,DMemWrite_out);
    dff #(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out);
    dff #(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out);  
endmodule
</code></pre>
<h4 id="EXMEM-v"><a href="#EXMEM-v" class="headerlink" title="EXMEM.v"></a>EXMEM.v</h4><pre><code class="verilog">module EXMEM(
    input clk,
     input en,
     input flush,
     input [31:0] ALUResult_in,
     input [31:0] DMemin_in,
     input [4:0] RegWtaddr_in,
     output [31:0] ALUResult_out,
     output [31:0] DMemin_out,
     output [4:0] RegWtaddr_out,
     //control
     input DMemRead_in,
     input DMemWrite_in,
     input DMemtoReg_in,
     input RegWrite_in,
     output DMemRead_out,
     output DMemWrite_out,
     output DMemtoReg_out,
     output RegWrite_out
    );
     dff dff1(clk,en,flush,ALUResult_in,ALUResult_out);
     dff dff2(clk,en,flush,DMemin_in,DMemin_out);
     dff #(5) dff3(clk,en,flush,RegWtaddr_in,RegWtaddr_out);

     dff #(1) dff14(clk,en,flush,DMemRead_in,DMemRead_out);
     dff #(1) dff15(clk,en,flush,DMemWrite_in,DMemWrite_out);
     dff #(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out);
     dff #(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out);

endmodule
</code></pre>
<h4 id="MEMWB-v"><a href="#MEMWB-v" class="headerlink" title="MEMWB.v"></a>MEMWB.v</h4><pre><code class="verilog">module MEMWB(
     input clk,
     input en,
     input flush,
     input [31:0] ALUResult_in,
     input [31:0] DMemout_in,
     input [4:0] RegWtaddr_in,
     output [31:0] ALUResult_out,
     output [31:0] DMemout_out,
     output [4:0] RegWtaddr_out,
     //control
     input DMemtoReg_in,
     input RegWrite_in,
     output DMemtoReg_out,
     output RegWrite_out
    );
     dff dff1(clk,en,flush,ALUResult_in,ALUResult_out);
     dff dff2(clk,en,flush,DMemout_in,DMemout_out);
     dff #(5) dff3(clk,en,flush,RegWtaddr_in,RegWtaddr_out);
     dff #(1) dff16(clk,en,flush,DMemtoReg_in,DMemtoReg_out);
     dff #(1) dff17(clk,en,flush,RegWrite_in,RegWrite_out);
endmodule
</code></pre>
<h4 id="compare-v"><a href="#compare-v" class="headerlink" title="compare.v"></a>compare.v</h4><pre><code class="verilog">`define LESS 2&#39;b00
`define EQUAL 2&#39;b01
`define GREATER 2&#39;b10
module compare(//为了判断分支
     input signed [31:0] a,
     input signed [31:0] b,
     output reg [1:0] res
    );
     always @(*)
        if(a == b) res = 2&#39;b01;
        else if(a &lt; b) res = 2&#39;b00;
        else if(a &gt; b) res = 2&#39;b10;
endmodule
</code></pre>
<h4 id="forward-v"><a href="#forward-v" class="headerlink" title="forward.v"></a>forward.v</h4><pre><code class="verilog">module forward(//前推
    input [4:0] Rs_EX,
    input [4:0] Rt_EX,
    input RegWrite_MEM,
    input RegWrite_WB,
    input [4:0] RegWtaddr_MEM,
    input [4:0] RegWtaddr_WB,
    output reg [1:0] RegRdout1Sel_Forward_EX,
    output reg [1:0] RegRdout2Sel_Forward_EX
    );
    always @(*) begin
        RegRdout1Sel_Forward_EX[0] = RegWrite_WB &amp;&amp; (RegWtaddr_WB != 0) &amp;&amp; (RegWtaddr_MEM != Rs_EX) &amp;&amp; (RegWtaddr_WB == Rs_EX);
        RegRdout1Sel_Forward_EX[1] = RegWrite_MEM &amp;&amp; (RegWtaddr_MEM != 0) &amp;&amp; (RegWtaddr_MEM == Rs_EX);
        RegRdout2Sel_Forward_EX[0] = RegWrite_WB &amp;&amp; (RegWtaddr_WB != 0) &amp;&amp; (RegWtaddr_MEM != Rt_EX) &amp;&amp; (RegWtaddr_WB == Rt_EX);
        RegRdout2Sel_Forward_EX[1] = RegWrite_MEM &amp;&amp; (RegWtaddr_MEM != 0) &amp;&amp; (RegWtaddr_MEM == Rt_EX);  
    end
endmodule
</code></pre>
<h4 id="hazard-v"><a href="#hazard-v" class="headerlink" title="hazard.v"></a>hazard.v</h4><pre><code class="verilog">module hazard(//上一条指令是LW指令且当前指令ID级读的是同一个寄存器,则插入bubble
     input [4:0] Rs_ID,
     input [4:0] Rt_ID, 
     input [4:0] RegWtaddr_EX,
     input DMemRead_EX,
     output PCEn,
     output IF_ID_En,
     output ID_EX_Flush
    );
    assign ID_EX_Flush = ((RegWtaddr_EX == Rs_ID) || (RegWtaddr_EX == Rt_ID)) &amp;&amp; DMemRead_EX;//条件成立则为1，清空
    assign IF_ID_En = ~ID_EX_Flush;//条件成立则为0，保持
    assign PCEn = ~ID_EX_Flush;//条件成立则为0，保持
endmodule
</code></pre>
<h4 id="control-v"><a href="#control-v" class="headerlink" title="control.v"></a>control.v</h4><pre><code class="verilog">module control(
    input clk,rst,
    input [5:0] Op, //instr[31:26]
    input [4:0] Rt, //instr[20:16]

    input [5:0] Funct,//instr[5:0]
    input [1:0] RsCMPRt,
    input [1:0] RsCMPZero,
    output reg [1:0] PCSrc, //0:+4,1:Branch,2:J,3:JR
    //ID
    output reg RegDst,//0:RegWtaddr=rt,1:RegWtaddr=rd
    //EX
    output reg ALUSrcASel,//0:RegRdout1,1:ShamtZeroExtended
    output reg [1:0] ALUSrcBSel, //0:RegRdout2,1:IMMSignExtended,2:IMMZeroExtended
    output reg [4:0] ALUControl,
    //MEM
    output reg DMemRead,//1:En
    output reg DMemWrite,//1:En
    //WB
    output reg DMemtoReg,//0:Aluout,1:DMemout
    output reg RegWrite//1:En
    );
    
    reg [1:0] tmpsrc;
    
    always @(*)
    begin
    if(rst) 
        begin
            &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_00&#125;,&#123;`A_NOP&#125;,&#123;4'b0001&#125;&#125;;
        end
    else
        case(Op)
            6&#39;b000000: //R-Type
                case(Funct)
                    //SLL的rs rt rd shamt全0时是nop，本来nop没有对应的
                    6&#39;b000000: //SLL,注意Alu_a来自Shamt的无符号拓展,即ALUSrcASel=1，下面两个同理
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_1_00&#125;,&#123;`A_SLL&#125;,&#123;4'b0001&#125;&#125;;
                    //6&#39;b000001: //MOVCI
                    6&#39;b000010: //SRL
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_1_00&#125;,&#123;`A_SRL&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b000011: //SRA
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_1_00&#125;,&#123;`A_SRA&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b000100: //SLLV，注意Alu_a来自reg[rs],即ALUSrcASel=0，下面两个同理
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SLL&#125;,&#123;4'b0001&#125;&#125;;
                    //6&#39;b000101: //*
                    6&#39;b000110: //SRLV
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SRL&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b000111: //SRAV
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SRA&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b001000: //JR
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b11_z_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
                    //6&#39;b001001: //JALR
                    
                    6&#39;b001010: //MOVZ,如果 reg[rs]=0 则 reg[rd]=reg[rt],此时RsCMPZero=01,所以 RegWrite=RsCMPZero[0]
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_MOV&#125;,&#123;3'b000&#125;,&#123;RsCMPZero[0]&#125;&#125;;
                    6&#39;b001011: //MOVN,如果 reg[rs]!=0 则 reg[rd]=reg[rt],此时RsCMPZero=00或10,所以 RegWrite=~RsCMPZero[0]
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_MOV&#125;,&#123;3'b000&#125;,&#123;~RsCMPZero[0]&#125;&#125;;

                    6&#39;b100000: //ADD
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_ADD&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100001: //ADDU
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_ADDU&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100010: //SUB
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SUB&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100011: //SUBU
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SUB&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100100: //AND
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_AND&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100101: //OR
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_OR&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100110: //XOR
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_XOR&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b100111: //NOR
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_NOR&#125;,&#123;4'b0001&#125;&#125;;
                  
                    6&#39;b101010: //SLT
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SLT&#125;,&#123;4'b0001&#125;&#125;;
                    6&#39;b101011: //SLTU
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_1_0_00&#125;,&#123;`A_SLTU&#125;,&#123;4'b0001&#125;&#125;;
                endcase
            6&#39;b000001: 
                case(Rt)
                    6&#39;b00000: //BLTZ,Reg[rs]&lt;0则跳转
                    begin
                        if(RsCMPZero == `LESS) tmpsrc = 2&#39;b01; else tmpsrc = 2&#39;b00;
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;4'bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
                    end
                    6&#39;b00001: //BGEZ,Reg[rs]&gt;=0则跳转
                    begin
                        if(RsCMPZero == `GREATER || RsCMPZero == `EQUAL) tmpsrc = 2&#39;b01; else tmpsrc = 2&#39;b00;
                        &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;4'bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
                    end
                endcase
            6&#39;b000010: //J,无条件跳转
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b10_z_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
            //6&#39;b000011: //JAL
            6&#39;b000100: //BEQ,Reg[rs]==Reg[rt]则跳转,RsCMPRt=01(==),则PCSrc=01，否则PCSrc=00(不跳转)
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;&#123;1'b0&#125;,&#123;RsCMPRt[0]&#125;&#125;,&#123;4&#39;bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4&#39;b00z0&#125;&#125;;
            6&#39;b000101: //BNE,Reg[rs]!=Reg[rt]则跳转,RsCMPRt=00(&lt;)或10(&gt;),则PCSrc=01，否则PCSrc=00(不跳转)
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;&#123;1'b0&#125;,&#123;~RsCMPRt[0]&#125;&#125;,&#123;4&#39;bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4&#39;b00z0&#125;&#125;;
            6&#39;b000110: //BLEZ,Reg[rs]&lt;=0则跳转
                begin
                if(RsCMPZero == `LESS || RsCMPZero == `EQUAL) tmpsrc = 2&#39;b01; else tmpsrc = 2&#39;b00;
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;4'bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
                end
            6&#39;b000111: //BGTZ,Reg[rs]&gt;0则跳转
                begin
                if(RsCMPZero == `GREATER) tmpsrc = 2&#39;b01; else tmpsrc = 2&#39;b00;
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;tmpsrc&#125;,&#123;4'bz_z_zz&#125;,&#123;`A_NOP&#125;,&#123;4'b00z0&#125;&#125;;
                end
            6&#39;b001000: //ADDI,注意RegDst=0,AluBSrcSel=01(IMMSignExtended),下面三个同理
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_01&#125;,&#123;`A_ADD&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001001: //ADDIU
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_01&#125;,&#123;`A_ADDU&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001010: //SLTI
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_01&#125;,&#123;`A_SLT&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001011: //SLTIU
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_01&#125;,&#123;`A_SLTU&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001100: //ANDI,注意RegDst=0,AluBSrcSel=10(IMMZeroExtended),下面三个同理
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_10&#125;,&#123;`A_AND&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001101: //ORI
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_10&#125;,&#123;`A_OR&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001110: //XORI
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_10&#125;,&#123;`A_XOR&#125;,&#123;4'b0001&#125;&#125;;
            6&#39;b001111: //LUI
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_10&#125;,&#123;`A_LUI&#125;,&#123;4'b0001&#125;&#125;;

            6&#39;b100011: //LW,注意RegDst=0(写到Reg[rt]),AluBSrcSel=01(IMMSignExtended),DMemtoReg=1(来自DMem),
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_0_0_01&#125;,&#123;`A_ADD&#125;,&#123;4'b1011&#125;&#125;;

            6&#39;b101011: //SW,注意RegDst=x(不写Reg),AluBSrcSel=01(IMMSignExtended)
                &#123;&#123;PCSrc&#125;,&#123;RegDst&#125;,&#123;ALUSrcASel&#125;,&#123;ALUSrcBSel&#125;,&#123;ALUControl&#125;,&#123;DMemRead&#125;,&#123;DMemWrite&#125;,&#123;DMemtoReg&#125;,&#123;RegWrite&#125;&#125;=&#123;&#123;6'b00_z_0_01&#125;,&#123;`A_ADD&#125;,&#123;4'b01z0&#125;&#125;;

            default: ;
        endcase     
    end
endmodule
</code></pre>
<h4 id="debounce-v"><a href="#debounce-v" class="headerlink" title="debounce.v"></a>debounce.v</h4><pre><code class="verilog">module debounce(//去抖动
     input clk,
    input in,
    output reg out=0
      
    );
    reg [31:0] cnt=0;
    always@(posedge clk)
        begin
            if(in!=out)
                begin
                    cnt=cnt+1;
                    
                    if(cnt==100000)
                    begin
                        out=~out;
                        cnt=0;
                    end
                    
                end
            else cnt=0;
            
        end
endmodule
</code></pre>
<h4 id="seg-v"><a href="#seg-v" class="headerlink" title="seg.v"></a>seg.v</h4><pre><code class="verilog">module seg(
    input clk,
    input rst_n,
    input [31:0] data32,
    output reg [3:0] sel,
    output reg [6:0] segments
    );
    integer clk_25=0;//4位数码管循环显示用
    integer clk_50000000=0;//2hz，移动显示用
    reg [1:0] cnt;
    reg [3:0] cnt2;
    reg [15:0] data16;//data32的16bit
    reg [3:0] data4;//data16的4bit
    reg [3:0] empty;//空白位
    always@(*)//组合逻辑，控制七段数码管
        begin
            if(!rst_n)
                segments = 7&#39;b000_0000;
            else
                case(data4)
                    0: segments =       ~7&#39;b011_1111;//0
                    1: segments =       ~7&#39;b000_0110;//1
                    2: segments =       ~7&#39;b101_1011;//2
                    3: segments =       ~7&#39;b100_1111;//3
                    4: segments =       ~7&#39;b110_0110;//4
                    5: segments =       ~7&#39;b110_1101;//5
                    6: segments =       ~7&#39;b111_1101;//6
                    7: segments =       ~7&#39;b000_0111;//7
                    8: segments =       ~7&#39;b111_1111;//8
                    9: segments =       ~7&#39;b110_1111;//9
                    10:segments =       ~7&#39;b111_0111;//A
                    11:segments =       ~7&#39;b111_1100;//b
                    12:segments =       ~7&#39;b011_1001;//C
                    13:segments =       ~7&#39;b101_1110;//d
                    14:segments =       ~7&#39;b111_1001;//E
                    15:segments =       ~7&#39;b111_0001;//F
                    default: segments = 7&#39;b000_0000; // required
                endcase
        end
        
    always@(posedge clk)//时序逻辑，产生位选择信号段选择信号
        begin
            //if(!rst_n)
                //cnt = 2&#39;b00;
            //else 
                if(clk_25==400000)
                    begin
                        clk_25=0;
                        cnt = cnt + 2&#39;b01;
                    end
                else
                    clk_25=clk_25+1;
                    
                if(clk_50000000==50000000)//
                    begin
                        clk_50000000=0;
                        cnt2=cnt2+1;
                        if(cnt2==4&#39;b1010) cnt2=4&#39;b0000;
                    end
                else
                    clk_50000000=clk_50000000+1;
            end

    always@(*)//组合逻辑，选择当前显示段
        begin
            case(cnt2)
                4&#39;b0000:begin data16=&#123;8&#39;bzzzzzzzz,data32[31:24]&#125;; empty=4&#39;b1100; end
                4&#39;b0001:begin data16=&#123;4&#39;bzzzz,data32[31:20]&#125;; empty=4&#39;b1000; end
                4&#39;b0010:begin data16=data32[31:16]; empty=4&#39;b0000; end
                4&#39;b0011:begin data16=data32[27:12]; empty=4&#39;b0000; end
                4&#39;b0100:begin data16=data32[23:8]; empty=4&#39;b0000; end
                4&#39;b0101:begin data16=data32[19:4]; empty=4&#39;b0000; end
                4&#39;b0110:begin data16=data32[15:0]; empty=4&#39;b0000; end
                4&#39;b0111:begin data16=&#123;data32[11:0],4&#39;bzzzz&#125;; empty=4&#39;b0001; end
                4&#39;b1000:begin data16=&#123;data32[7:0],8&#39;bzzzzzzzz&#125;; empty=4&#39;b0011; end
                4&#39;b1001:begin data16=&#123;data32[3:0],8&#39;bzzzzzzzz,data32[31:28]&#125;; empty=4&#39;b0110; end
                default:;
            endcase
        end
            
    always@(*)//组合逻辑，选择当前显示位
        begin
            case(cnt)
                2&#39;b00:sel=4&#39;b1110 | empty;
                2&#39;b01:sel=4&#39;b1101 | empty;
                2&#39;b10:sel=4&#39;b1011 | empty;
                2&#39;b11:sel=4&#39;b0111 | empty;
                default:sel=4&#39;b1110;
            endcase
        end
        
    always@(*)//组合逻辑，选择当前显示位的数据
        begin
            case(cnt)
                2&#39;b00:data4=data16[3:0];
                2&#39;b01:data4=data16[7:4];
                2&#39;b10:data4=data16[11:8];
                2&#39;b11:data4=data16[15:12];
                default:data4=16&#39;b0;
            endcase
        end 
endmodule
</code></pre>
<h4 id="test-v"><a href="#test-v" class="headerlink" title="test.v"></a>test.v</h4><pre><code class="verilog">module test;
    // Inputs
    reg clk;
    reg rst;
    // Instantiate the Unit Under Test (UUT)
    top uut (
        .clk(clk), 
        .rst(rst),
    );
    
    initial begin
        // Initialize Inputs
        clk = 1;

        rst = 0;
        #100;
        
        rst = 1;
        
        // Wait 100 ns for global reset to finish
        #100;
        clk=~clk;
        #10;
        clk=~clk;
      rst = 0;
        
        forever begin
            #10;
            clk=~clk;
        end
        
        // Add stimulus here
    end
      
endmodule
</code></pre>

	</div>
</article>


	<div id="comment">
	<div id="SOHUCS" sid="p/9mnmo0/">

	</div>
</div>
<script charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js" ></script>
<script type="text/javascript">
	window.changyan.api.config({
		appid: 'cyw2kkJjE',
		conf: 'prod_2d974c914fc99dce7038d81f8b00102a'
	});
</script>
 

<div class="post-nav">
	 
		<a href="/p/9tlmo0/" class="prev">学习与遗忘</a>
	 

	 
		<a href="/p/9mls00/" class="next">Verilog中的有符号数与无符号数</a>
	 
</div>
</section>
<!-- <script src="/js/toc.js"></script> -->
<aside class="for-post">
<div id="toc">
	<div class="head"><div class="title">Catalogue</div></div>
	<div class="content">
		
	</div>	
</div>
<div id="similar-posts">
	<div class="head"><div class="title">Similar Posts</div></div>
	
		<a href="/p/btthcc/" class="similar-post-item">
			<div class="title">安全意识</div>
			<div class="date"><i class="fa fa-calendar"></i> 2022-08-30</div>
		</a>
	
		<a href="/p/bmnwen/" class="similar-post-item">
			<div class="title">LeetCode刷题笔记——理解二叉树的非递归遍历II</div>
			<div class="date"><i class="fa fa-calendar"></i> 2022-04-13</div>
		</a>
	
		<a href="/p/bm4vhj/" class="similar-post-item">
			<div class="title">LeetCode刷题笔记——背包问题汇总</div>
			<div class="date"><i class="fa fa-calendar"></i> 2022-04-03</div>
		</a>
	
		<a href="/p/bki8wr/" class="similar-post-item">
			<div class="title">C++学习笔记</div>
			<div class="date"><i class="fa fa-calendar"></i> 2022-03-02</div>
		</a>
	
		<a href="/p/bk6szr/" class="similar-post-item">
			<div class="title">LeetCode刷题笔记——二分查找</div>
			<div class="date"><i class="fa fa-calendar"></i> 2022-02-24</div>
		</a>
	 
</div>
</aside>
		</div>
	</main>
	<footer>
		<div id="footer-inner" class="horizental-inner text-center">
			© 2017-2022 Lyncien | Powered by <a href="//hexo.io" target="_blank">&nbsp;Hexo&nbsp;</a> | Theme <a href="//github.com/Lyncien/hexo-theme-serendipity" target="_blank">&nbsp;Serendipity&nbsp;</a> by Lyncien
		</div>
	</footer>
	<a id="bottom"></a>
	<div id="tool-bar">
		<a href="#top" id="go-to-top"><i class="fa fa-arrow-up fa-fw"></i></a>
		<a href="javascript:;" id="setting"><i class="fa fa-cog fa-fw"></i></a>
		<a href="#bottom" id="go-to-bottom"><i class="fa fa-arrow-down fa-fw"></i></a>
	</div>
	<div id='search-msg-box' class="msg-box">
		<div class="msg-box-body">
			<div class="msg-box-close-button"></div>
			<div class="msg-box-title">搜索</div>
			<div class="msg-box-content">
				<div class="input-group">
					<input type="text" id="search-input">
					<button id="search-button"><i class="fa fa-search"></i></button>
				</div>
				<div id="search-result">

				</div>
			</div>
		</div>
	</div>
	<div id='setting-msg-box' class="msg-box">
		<div class="msg-box-body">
			<div class="msg-box-close-button"></div>
			<div class="msg-box-title">背景设置</div>
			<div class="msg-box-content">
				<div id="background-auto">
					<input id="background-auto-checkbox" type="checkbox" checked />
					<label for="background-auto-checkbox">自动切换背景</label>
				</div>
				<button data-idx='1'><img src="/img/bg1.webp" alt="1" loading="lazy"/></button>
				<button data-idx='2'><img src="/img/bg2.webp" alt="2" loading="lazy"/></button>
				<button data-idx='3'><img src="/img/bg3.webp" alt="3" loading="lazy"/></button>
				<button data-idx='4'><img src="/img/bg4.webp" alt="4" loading="lazy"/></button>
			</div>
		</div>
	</div>
	
<script src="/js/main.js"></script>

</body>
</html>